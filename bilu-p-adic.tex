\documentclass{article}

\usepackage[utf8]{inputenc}

\usepackage[sc]{mathpazo}
\linespread{1.05}
\usepackage[T1]{fontenc}

\usepackage[leqno]{amsmath}
\usepackage{amssymb}
\usepackage{fullpage}
\usepackage{graphicx}

\usepackage[all,color]{xypic}

\usepackage{perpage}
\MakePerPage{footnote}

\newcommand{\term}{\textbf}

\newcommand{\legendre}[2]{\left(\frac{#1}{#2}\right)}

\newcommand{\isom}{\cong}

\newcommand{\dfn}{\mathrel{\mathop:}=}
\newcommand{\rdfn}{=\mathrel{\mathop:}}

\renewcommand{\AA}{\mathbb{A}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\HH}{\mathbb{H}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\QQ}{\mathbb{Q}}

\DeclareMathOperator{\fchar}{char}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\ord}{ord}
\DeclareMathOperator{\tr}{tr}

\renewcommand{\mod}{\mathop{\,\mathrm{mod}\,}}
\newcommand{\badH}{\mathrel{\reflectbox{\rotatebox[origin=c]{180}{$H$}}}}

\usepackage{xcolor}
\definecolor{mylinkcolor}{rgb}{0.0,0.4,1.0}
\definecolor{mycitecolor}{rgb}{0.0,0.4,1.0}
\definecolor{shadecolor}{rgb}{0.89,0.88,0.80}
\definecolor{gray}{rgb}{0.7,0.7,0.7}

\usepackage[unicode,colorlinks=true,linkcolor=mylinkcolor,citecolor=mycitecolor]{hyperref}
\newcommand{\refref}[2]{\hyperref[#2]{#1~\ref*{#2}}}

\usepackage{array}
\newcolumntype{x}[1]{>{\centering\hspace{0pt}}p{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsthm}

\newcommand{\examplesymbol}{$\blacktriangle$}
\renewcommand{\qedsymbol}{$\blacksquare$}

\newtheoremstyle{myplain}
  {\topsep}   % ABOVESPACE
  {\topsep}   % BELOWSPACE
  {\itshape}  % BODYFONT
  {0pt}       % INDENT (empty value is the same as 0pt)
  {\bfseries} % HEADFONT
  {.}         % HEADPUNCT
  {5pt plus 1pt minus 1pt} % HEADSPACE
  {\thmnumber{#2}. \thmname{#1}\thmnote{ (#3)}}   % CUSTOM-HEAD-SPEC 

\newtheoremstyle{mydefinition}
  {\topsep}   % ABOVESPACE
  {\topsep}   % BELOWSPACE
  {\normalfont}  % BODYFONT
  {0pt}       % INDENT (empty value is the same as 0pt)
  {\bfseries} % HEADFONT
  {.}         % HEADPUNCT
  {5pt plus 1pt minus 1pt} % HEADSPACE
  {\thmnumber{#2}. \thmname{#1}\thmnote{ (#3)}}   % CUSTOM-HEAD-SPEC

\theoremstyle{myplain}

\newtheorem{proposition}{Proposition}[section]
\newtheorem{lemma}[proposition]{Lemma}
\newtheorem{theorem}[proposition]{Theorem}
\newtheorem{corollary}[proposition]{Corollary}

\newtheorem*{claim}{Claim}

\theoremstyle{mydefinition}

\newtheorem{definition}[proposition]{Definition}
\newtheorem{remark}[proposition]{Remark}

\newtheorem{examplex}[proposition]{Example}
\newenvironment{example}
  {\pushQED{\qed}\renewcommand{\qedsymbol}{\examplesymbol}\examplex}
  {\popQED\endexamplex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\title{$p$-adic numbers and Diophantine equations}
\author{Yuri Bilu}
\date{Fall semester 2013}

\begin{document}

\maketitle

\noindent These are notes from a class given by Yuri Bilu at Universi\'e
de Bordeaux in Fall semester 2013, \TeX'ed by Alexey Beshenov.

Version 2014-09-29. Corrections and remarks from
Gabriel Chicas Reyes,
Pietro Gatti,
Roberto Gualdi,
Jos\'e Ibrahim Villanueva Guti\'errez.
I'll try to keep this text updated. Please write about misprints and mistakes to
\texttt{cadadr@gmail.com}. The last version is available at
\url{https://cadadr.org/}

\tableofcontents

\pagebreak

\part{Hasse--Minkowski theorem}

\section{Introduction to the $p$-adic integers $\ZZ_p$}
\label{section:Zp-intro}

Our motivation is the \emph{local study of Diophantine equations}.
A \term{Diophantine equation} has form $F (X_1,\ldots,X_n) = 0$ for some
$F (X_1,\ldots,X_n) \in \ZZ [X_1,\ldots,X_n]$, and we are interested in its
integral solutions $(x_1,\ldots,x_n) \in \ZZ^n$. Assume we have such a
solution. Then trivially the following holds:

\begin{enumerate}
\item The equation $F (X_1,\ldots,X_n) = 0$ has a real solution
  $\underline{x} \in \mathbb{R}^n$.

\item For each $m = 1, 2, 3, \ldots$ the congruence
  $F (X_1,\ldots,X_n) \equiv 0 \pmod{m}$ has a solution.
\end{enumerate}

The question is whether the converse is true, i.e. do the two conditions above
imply existence of a solution in $\ZZ^n$? In general the answer is \textbf{no},
even for equations in one variable.

\begin{example}
  Consider an equation $(X^2 - 13) \, (X^2 - 17) \, (X^2 - 13\cdot 17) = 0$.
  It obviously has a real root; further one can check that it has solutions
  modulo $m$ for each $m$ (\emph{exercise}). As we see, there are still no
  integer solutions.
\end{example}

Our goal is to show the following result.

\begin{theorem}[Hasse, Minkowski]\label{theorem:Hasse-Minkowski-1}
  Let $F (X_1,\ldots,X_n) \in \ZZ [X_1,\ldots,X_n]$ be a quadratic form
  (i.e. a homogeneous polynomial of degree two). Assume that
  \begin{enumerate}
  \item The equation $F (X_1,\ldots,X_n) = 0$ has a nontrivial solution
    $\underline{x} \in \mathbb{R}^n$.

  \item For each $m = 1, 2, 3, \ldots$ the equation
    $F (X_1,\ldots,X_n) \equiv 0 \pmod{m}$ has a nontrivial solution.
  \end{enumerate}

  Then $F (X_1,\ldots,X_n) = 0$ has a nontrivial solution
  $\underline{x} \in \ZZ^n$.
\end{theorem}

Our proof of this result will be conceptual and elaborate. We start from
recalling some basic facts and introducing the $p$-adic numbers.

\begin{proposition}[Chinese remainder theorem]
  Let $m = m_1 m_2$ with $m_1$ and $m_2$ relatively prime integers. A congruence
  $F (X) \equiv 0 \pmod{m}$ has a solution iff both congruences
  $F (X) \equiv 0 \pmod{m_1}$ and $F (X) \equiv 0 \pmod{m_2}$ have solutions.
\end{proposition}

Recall that the statement above comes from a ring isomorphism
\begin{align*}
  \ZZ/m\ZZ & \isom \ZZ/m_1\ZZ \times \ZZ/m_2\ZZ,\\
  x & \mapsto (x \mod m_1, ~ x \mod m_2).
\end{align*}

So since every $m$ is a product $p_1^{k_1}\cdots p_s^{k_s}$ of prime powers, it
is enough to consider only congruences modulo $p^k$. And this is where the
$p$-adic numbers come into play.

\begin{example}\label{example:sqrt-2}
  Consider a congruence $X^2 \equiv 2 \pmod{7^k}$ for $k = 1, 2, 3, \ldots$

  \begin{itemize}
  \item If \underline{$k = 1$}, then the solutions are $x = \pm 3 \pmod{7}$.

  \item If \underline{$k = 2$}, then the equation is $X^2 \equiv 2 \pmod{7^2}$,
    so that $x^2 = 7^2\cdot u + 2$, and $x$ should be also a solution of
    $X^2 \equiv 2 \pmod{7}$, that is $x \equiv \pm 3 \pmod{7}$.

    Suppose $x \equiv x_0 = 3 \pmod{7}$, so $x = 7\,u + 3$. We have

    \begin{align*}
      (7\,u + 3)^2 & \equiv 2 \pmod{7^2},\\
      2\cdot 3\cdot 7\, u + 9 & \equiv 2 \pmod{7^2},\\
      2\cdot 3\cdot 7\, u + 7 & \equiv 0 \pmod{7^2},\\
      6\,u + 1 & \equiv 0 \pmod{7}.
    \end{align*}

    So we conclude $u = 1 \pmod{7}$, and the corresponding solution of
    $X^2 \equiv 2 \pmod{7^2}$ is $x_1 = 7\cdot 1 + 3 = 10$.

  \item Proceeding as above for \underline{$k = 3$}, we look for
    $x_2 = 7^2\cdot u + x_1$ such that $x_2^2 \equiv 2 \pmod{7^3}$.

    \begin{align*}
      (7^2\cdot u + x_1)^2 & \equiv 2 \pmod{7^3},\\
      2\cdot 7^2 \cdot u\cdot x_1 + x_1^2 & \equiv 2 \pmod{7^3},\\
      2\cdot 7^2 \cdot u\cdot 10 + 2\cdot 7^2 & \equiv 0 \pmod{7^3},\\
      20 \, u + 2 & \equiv 0 \pmod{7}.
    \end{align*}

    So we conclude $u = 2$ and $x_2 = 7^2\cdot 2 + 10 = 108$.
  \end{itemize}

  Continuing in this manner, we have a sequence of numbers $x_k$ (with
  $k = 0,1,2,\ldots$) such that $x_k^2 \equiv 2 \pmod{7^{k+1}}$ and
  $x_k \equiv x_{k-1} \pmod{7^k}$. The sequence starts with $x_0 = 3$,
  $x_1 = 10$, $x_2 = 108$, $\ldots$ It looks like an approximation to $\sqrt{2}$
  digit by digit, but it is not decimal, it is $7$-adic!
\end{example}

\begin{definition}
  Let $p$ be a prime number. We say that a sequence of integers
  $(x_0, x_1, x_2, \ldots)$ gives a \term{$p$-adic integer} if

  \[ \tag{*} x_n \equiv x_{n-1} \pmod{p^n}\text{ for every }n = 1, 2, 3, \ldots \]

  Further we say that two sequences $(x_0, x_1, x_2, \ldots)$ and
  $(x_0^\prime, x_1^\prime, x_2^\prime, \ldots)$ define the same $p$-adic
  integer if $x_n \equiv x_n^\prime \pmod{p^{n+1}}$ for all
  $n = 0, 1, 2, \ldots$ We write $(x_n) \sim (x_n^\prime)$ in this case.

  This is an equivalence relation, and the set of $p$-adic integers $\ZZ_p$ is
  defined to be the set of all integer sequences $(x_0,x_1,x_2,\ldots)$
  satisfying (*), modulo this equivalence.
\end{definition}

To each integer $x\in \ZZ$ corresponds a $p$-adic integer given by the sequence
$(x,x,x,\ldots)$ (modulo the equivalence). This gives an embedding
$\ZZ \hookrightarrow \ZZ_p$.

Of course every $p$-adic integer can be defined by a sequence $(x_n)$ where
$x_n \in \{ 0, 1, \ldots, p^{n+1} - 1 \}$. We call it a
\term{canonical sequence}.

Now consider a sequence $(x_0,x_1,x_2,\ldots)$. We have
$x_1 \equiv x_0 \pmod p$, so that $x_1 = x_0 + a_1\,p$. If we assume that
$0 \le x_0 < p$, then we have $0 \le a_1 \le p-1$. Proceeding in this manner,

\begin{align*}
x_1 & = a_0 + a_1\,p,\\
x_2 & = a_0 + a_1\,p + a_2\,p^2,\\
 & \cdots\\
x_n & = a_0 + a_1\,p + a_2\,p^2 + \cdots + a_n\,p^n,\\
 & \cdots
\end{align*}
where $a_i \in \{ 0, 1, \ldots, p-1 \}$. This is called the
\term{$p$-adic expansion} of $(x_0,x_1,x_2,\ldots)$, and it is unique.

\begin{remark}
  Here is how one can calculate $p$-adic expansions in PARI/GP
  (\url{http://pari.math.u-bordeaux.fr/}):

\begin{verbatim}
? -1 + O(7^10)
%1 = 6 + 6*7 + 6*7^2 + 6*7^3 + 6*7^4 + 6*7^5 + 6*7^6 + 6*7^7 + 6*7^8 + 6*7^9 + O(7^10)

? sqrt(2+O(7^10))
%2 = 3 + 7 + 2*7^2 + 6*7^3 + 7^4 + 2*7^5 + 7^6 + 2*7^7 + 4*7^8 + 6*7^9 + O(7^10)
\end{verbatim}
\end{remark}

So every element of $\ZZ_p$ corresponds bijectively to a sequence
$(a_0,a_1,a_2,\ldots)$ with $a_i \in \{ 0, 1, \ldots, p-1 \}$. This set is
really big, it has cardinality of the continuum.

The $p$-adic integers $\ZZ_p$ form a commutative ring. For two numbers
$x = (x_n) \in \ZZ_p$ and $y = (y_n) \in \ZZ_p$ we define the sum and product by
$$x+y \dfn (x_n + y_n), \quad x\cdot y \dfn (x_n\,y_n).$$

One checks that this does not depend on the choice of sequences representing $x$
and $y$.

\vspace{1em}

Note that we define addition and multiplication for sequences and not for
$p$-adic expansions. Adding and multiplying $p$-adic expansions is tricky: one
should think about carrying digits, just like for the long multiplication of the
usual integers written in, say, base ten.

\vspace{2em}

Finally, we note that all the definitions above can be summarized as follows:
$\ZZ_p$ is the inverse limit of rings $\ZZ/p^n\ZZ$:
$$\ZZ_p = \varprojlim_n \ZZ/p^n\ZZ.$$

\begin{remark}
  The construction of $p$-adic integers can be generalized to the so-called
  \term{ring of Witt vectors}. For instance, $\ZZ_p$ is the ring of Witt vectors
  $W (\FF_p)$ of the finite field $\FF_p$. See
  \emph{J.-P. Serre, Corps locaux, \S II.6}.
\end{remark}

\begin{theorem}
  A $p$-adic integer $x = (x_n)$ is invertible in $\ZZ_p$ iff $x_0$ is
  invertible modulo $p$, i.e. whenever $x_0 \not\equiv 0 \pmod{p}$.

\begin{proof}
  Assume $x$ is invertible, so that $x\,y = 1$ for some $y \in \ZZ_p$. Then they
  are represented by sequences $x = (x_0,x_1,x_2,\ldots)$ and
  $y = (y_0,y_1,y_2,\ldots)$ such that $x_n\,y_n \equiv 1 \pmod{p^{n+1}}$.
  In particular, this means that $x_0 \not\equiv 0 \pmod{p}$.

  In the opposite direction, assume that $x_0 \not\equiv 0 \pmod{p}$. We have
  $x_n \equiv x_{n-1} \pmod{p^n}$, and thus $x_n \equiv x_{n-1} \pmod{p}$,
  \[ x_n \equiv x_{n-1} \equiv x_{n-2} \equiv \cdots \equiv x_0 \not\equiv 0 \pmod{p}. \]

  $x_n \not\equiv 0 \pmod{p}$ means that $x_n$ is invertible $\pmod{p^{n+1}}$,
  so there exists $y_n$ such that $x_n\,y_n \equiv 1 \pmod{p^{n+1}}$, meaning
  that $(x_n) \cdot (y_n) \sim 1$. We have to check that $(y_n)$ gives a
  $p$-adic integer. Indeed,

  \begin{gather*}
    x_n\,y_n \equiv 1 \pmod{p^{n+1}},\\
    x_{n-1}\,y_{n-1} \equiv 1 \pmod{p^n},\\
    x_n \equiv x_{n-1} \pmod{p^n},\\
    x_{n-1}\,y_n \equiv x_{n-1}\,y_{n-1} \equiv 1 \pmod{p^n},\\
    y_n \equiv y_{n-1} \pmod{p^n}. \qedhere
  \end{gather*}
\end{proof}
\end{theorem}

\begin{corollary}
  Every $x \in \ZZ$ is invertible in $\ZZ_p$ iff $x \not\equiv 0 \pmod{p}$.
\end{corollary}

\begin{example}
  $2$ is invertible in $\ZZ_3$, so let us compute $\frac{1}{2} \in \ZZ_3$ as a
  sequence $(x_0, x_1, x_2, \ldots)$.

  We should have $2\,x_0 \equiv 1 \pmod{3}$, so $x_0 = 2$.

  Then $2\,x_1 \equiv 1 \pmod{3^2}$. Since $x_1 = x_0 + 3\,u = 2 + 3\,u$, we get
  $$2 \cdot (2 + 3\,u) \equiv 1 \pmod{3^2},$$
  so $u = 1$ and $x_1 = 2 + 1\cdot 3 = 5$. Proceeding in this manner,
  $$x = 2 + 1\cdot 3 + 1\cdot 3^2 + \cdots$$
  That is, $x_0 = 2$, $x_1 = 2 + 1\cdot 3 = 5$,
  $x_2 = 2 + 1\cdot 3 + 1\cdot 3^2 = 14$, and so on. We have indeed
  $$2\,x = 2 + 2\,(\underbrace{1 + 3 + 3^2 + \cdots}_{-1/2}) = 2-1 = 1.$$
  Where we compute the infinite sum using the ``geometric progression formula''
  $$1 + 3 + 3^2 + \cdots = \frac{1}{1-3} = -\frac{1}{2}$$
  (formulas as $\sum\limits_{0 \le k} x^k = \frac{1}{1-x}$ make sense for
  $p$-adic numbers when $p \mid x$; more precisely, when $|x|_p < 1$---see below
  the discussion of absolute values and convergence).
\end{example}

In general, $\ZZ_p$ contains the set of ``$p$-integral numbers''
$$\QQ \cap \ZZ_p = \{ \frac{a}{b} \mid a,b \in \ZZ, ~ p \nmid b \}.$$

\begin{theorem}
  Every number $\alpha \in \ZZ_p$, $\alpha\ne 0$, can be uniquely represented as
  $p^n \epsilon$ where $n = 0,1,2,\ldots$ and $\epsilon \in \ZZ_p^\times$.
\end{theorem}

\begin{proof}[Proof of the theorem]
  Look at the $p$-adic expansion of $\alpha$:
  $$\alpha = a_0 + a_1\,p + a_2\,p^2 + \cdots$$

  Let $n$ be the smallest index $i$ such that $a_i \ne 0$. Then we have
  \[ \alpha = a_n\,p^n + a_{n+1}\,p^{n+1} + a_{n+2}\,p^{n+2} + \cdots =
    p^n\,(a_n + a_{n+1}\,p + a_{n+2}\,p^2 + \cdots). \]

  The number $\epsilon \dfn a_n + a_{n+1}\,p + a_{n+2}\,p^2 + \cdots$ is a unit
  since $a_n \ne 0$.

  \vspace{1em}

  Now we need to show that the presentation $p^n\,\epsilon$ is unique. Assume
  $\alpha = p^n\,\epsilon = p^s\,\eta$ for some integers $n$ and $s$ and some
  units $\epsilon$ and $\eta$.

  \[ p^n\,(\underbrace{a_n + a_{n+1}\,p + a_{n+2}\,p^2 + \cdots}_\epsilon) =
    p^s\,(\underbrace{a_s^\prime + a_{s+1}^\prime\,p + a_{s+2}^\prime\,p^2 + \cdots}_\eta). \]

  By uniqueness of $p$-adic expansions, we should have $n = s$ and
  $a_i = a_i^\prime$ for all $i$.
\end{proof}

\begin{corollary}
  $\ZZ_p$ is an integral domain, i.e. for $\alpha,\beta \in \ZZ_p$ if
  $\alpha\,\beta = 0$ then $\alpha = 0$ or $\beta = 0$.

  \begin{proof}
    Assume $\alpha \ne 0$ and $\beta \ne 0$. We have $\alpha = p^m\,\epsilon$,
    $\beta = p^s\,\eta$, and
    $\alpha\,\beta = p^{m+s}\,\epsilon\,\eta = p^{m+s}\,\theta$ for some unit
    $\theta \dfn \epsilon\,\eta$.

    \[ \alpha\,\beta = p^{m+s} \, (\underbrace{a_{m+s} + a_{m+s+1}\,p + a_{m+s+2}\,p^2 + \cdots}_\theta). \]

    We have $a_{m+s} \ne 0$ and so $\alpha\,\beta \ne 0$.
  \end{proof}
\end{corollary}

If $\alpha = p^n\,\epsilon$ is the representation of a $p$-adic number as above,
then we define the \term{$p$-adic order} of $\alpha$ to be
$\nu_p (\alpha) \dfn n$. We also put $\nu_p (0) \dfn \infty$. It satisfies the
following properties:

\begin{itemize}
\item $\nu_p (\alpha) = \infty$ iff $\alpha = 0$.

\item $\nu_p (\alpha\,\beta) = \nu_p (\alpha) + \nu_p (\beta)$.

\item $ \nu_p (\alpha + \beta) \ge \min \{ \nu_p (\alpha), \nu_p (\beta) \}$,
  with equality when $\nu_p (\alpha) \ne \nu_p (\beta)$.
\end{itemize}

Indeed, let $\alpha = p^n\,\epsilon$ and $\beta = p^s\,\eta$. Suppose
$n > s$. Then
\[ \alpha+\beta = p^s \, (p^{n-s} \, \epsilon + \eta). \]

We claim that $p^{n-s} \, \epsilon + \eta$ is a unit. Indeed,
$p^{n-s}\,\epsilon \equiv 0 \pmod{p}$ and $\eta \not\equiv 0 \pmod{p}$,
so $p^{n-s}\,\epsilon + \eta \not\equiv 0 \pmod{p}$.
Now $\nu_p (\alpha + \beta) = s = \min \{\nu_p (\alpha), \nu_p (\beta) \}$.

For $n = s$ in general we have only $\nu_p (\alpha + \beta) \ge s$---it can be
the case that $\epsilon + \eta$ is not a unit.

\begin{proposition}
  Let $\alpha, \beta \in \ZZ_p$. Then $\alpha \mid \beta$ in $\ZZ_p$ iff
  $ \nu_p (\alpha) \le \nu_p (\beta)$.

  \begin{proof}
    If $\alpha \mid \beta$ then $\beta = \alpha\,\gamma$, so
    $ \nu_p (\beta) = \nu_p (\alpha) + \nu_p (\gamma) \ge \nu_p (\alpha)$.

    In the other direction, if $ \nu_p (\alpha) \le \nu_p (\beta)$, then we have
    $\alpha = p^n\,\epsilon$ and $\beta = p^s\,\eta$ with $s \ge n$.

    \[ \beta = p^n\,\epsilon\,\underbrace{p^{s-n}\,\eta\,\epsilon^{-1}}_{\rdfn \gamma} =
      \alpha\,\gamma. \qedhere \]
  \end{proof}
\end{proposition}

Recall that if $R$ is an integral domain, then we say that an element
$\alpha \ne 0$ is \term{irreducible} if $\alpha \notin R^\times$ and
$\alpha = \beta\gamma$ implies $\beta \in R^\times$ or $\gamma \in
R^\times$. That is, $\alpha$ is not a product of two non-units. We see that the
only irreducible element in $\ZZ_p$ is $p$ (up to multiplication by a unit).

\begin{proposition}
  The only maximal ideal in $\ZZ_p$ is $p \ZZ_p$, and all ideals in $\ZZ_p$ are
  powers of the maximal ideal.

  \begin{proof}
    Let $I$ be an ideal in $\ZZ_p$. Consider
    $n \dfn \min \{ \nu_p (\alpha) \mid \alpha \in I \}$. We claim that
    $I = p^n \ZZ_p$.

    There exists $\alpha \in I$ such that $ \nu_p (\alpha) = n$, namely
    $\alpha = p^n\,\epsilon$ for some $\epsilon \in \ZZ_p^\times$. Now
    $p^n = \alpha\,\epsilon^{-1} \in I$, thus $I \supseteq p^n \ZZ_p$.

    If $\beta \in I$, then $\beta = p^s \eta$, with $s = \nu_p (\beta) \ge n$.
    So $\beta = p^n \, \gamma$ with $\gamma = p^{n-s}\,\eta$ and
    $\beta \in p^n \ZZ_p$. Hence $I \subseteq p^n \ZZ_p$.

    In particular, the only maximal ideal is $p \ZZ_p$.
  \end{proof}
\end{proposition}

This means that $\ZZ_p$ is a \term{discrete valuation ring}. Knowing that all
ideals in $\ZZ_p$ have form $(p^n)$, it is natural to ask what are the quotient
rings $\ZZ_p/(p^n)$.

First we see that there is a surjective map

\[ \xymatrix@R=0.2em{
\ZZ\ar@{^(->}[r] & \ZZ_p \ar@{->>}[r] & \ZZ_p/(p^n),\\
x \ar@{|->}[r] & (x,x,\ldots)\ar@{|->}[r] & (x,x,\ldots) \mod p^n
} \]

Here we take an integer $x$ and then look at it as a $p$-adic number
(represented by a sequence $(x,x,x,\ldots)$), modulo $p^n$. The surjectivity is
clear: any $p$-adic number
$$\alpha = a_0 + a_1\,p + a_2\,p^2 + \cdots + a_{n-1}\,p^{n-1} + a_n\,p^n + \cdots$$
modulo $p^n$ is equivalent to $a_0 + a_1\,p + \cdots + a_{n-1}\,p^{n-1}$, which
is an ordinary integer. On the other hand, it is clear that the map sends $x$ to
$0 \in \ZZ_p/(p^n)$ iff $x$ is divisible by $p^n$. Thus the kernel is $p^n \ZZ$,
and
$$\ZZ_p / (p^n) \isom \ZZ / p^n \ZZ.$$

\section{Field of $p$-adic numbers $\QQ_p$}

\begin{definition}
  The field of \term{$p$-adic numbers} $\QQ_p$ is the fraction field of $\ZZ_p$.
\end{definition}

\begin{proposition}
  Every $\alpha \in \QQ_p^\times$ is represented in a unique way as
  $p^n\,\epsilon$ where $n \in \ZZ$ and $\epsilon \in \ZZ_p^\times$ is
  a $p$-adic unit.

  \begin{proof}
    We have $\alpha = \frac{p^r\,\epsilon}{p^s\,\zeta}$ for some units
    $\epsilon, \zeta \in \ZZ_p^\times$ and so $\alpha = p^{r-s}\,\theta$, where
    $\theta \dfn \epsilon\,\zeta^{-1}$.

    For the uniqueness assume $\alpha = p^n \, \theta = p^s \, \eta$. Take $r$
    big enough such that $r+n$ and $r+s$ are both nonnegative. Then

    \[ p^r \alpha = p^{r+n} \theta = p^{r+s} \eta \in \ZZ_p. \]

    By uniqueness of the corresponding representation for the $p$-adic integers,
    we conclude $n = s$ and $\theta = \eta$.
  \end{proof}
\end{proposition}

The $p$-adic order $ \nu_p (\cdot)$ extends to $\QQ_p$, and we have a map
$\nu_p\colon \QQ_p \to \ZZ \cup \{ \infty \}$. It satisfies the following
properties:

\begin{enumerate}
\item $\nu_p (\alpha) = \infty$ iff $\alpha = 0$.

\item $\nu_p (\alpha\,\beta) =  \nu_p (\alpha) +  \nu_p (\beta)$.

\item $\nu_p (\alpha + \beta) \ge \min \{ \nu_p (\alpha), \nu_p (\beta) \}$,
  with equality if $\nu_p (\alpha) \ne \nu_p (\beta)$.
\end{enumerate}

This means that we have a \term{discrete valuation} on $\QQ_p$. With respect to
this valuation,
\[ \ZZ_p = \{ \alpha \in \QQ_p \mid  \nu_p (\alpha) \ge 0 \}. \]

\section{Topology and convergence on $\QQ_p$}

Intuitively, a $p$-adic number $\alpha \in \QQ_p$ is ``small'' if it is
divisible by a high power of $p$. That is, if $ \nu_p (\alpha)$ is large. So to
define the \term{$p$-adic absolute value} on $\QQ_p$, we pick $\rho \in (0,1)$
and put $|\alpha|_p \dfn \rho^{ \nu_p (\alpha)}$. This satisfies the following
properties:

\begin{itemize}
\item $|\alpha|_p = 0$ iff $\alpha = 0$.

\item $|\alpha\,\beta|_p = |\alpha|_p \cdot |\beta|_p$.

\item $|\alpha+\beta|_p \le \max \{ |\alpha|_p, |\beta|_p \}$ with equality if
  $|\alpha|_p \ne |\beta|_p$.
\end{itemize}

This defines a \term{metric} on $\QQ_p$ with distance
$d (\alpha,\beta) \dfn |\alpha - \beta|_p$. That is, the following properties
are satisfied:

\begin{itemize}
\item $d (\alpha,\beta) = d (\beta,\alpha)$.

\item $d (\alpha,\beta) = 0$ iff $\alpha = \beta$.

\item $d (\alpha,\gamma) \le d (\alpha,\beta) + d (\beta,\gamma)$.
\end{itemize}

Actually, instead of the triangle inequality, a stronger
\term{ultrametric inequality}
$d (\alpha,\gamma) \le \max \{ d (\alpha, \beta), \, d (\beta,\gamma) \}$ holds.

\vspace{1em}

With respect to this metric, the subspace $\ZZ_p$ of $p$-adic integers is the
unit ball centered in $0$:
\[ \ZZ_p = \{ \alpha \in \QQ_p \,\mid\, |\alpha|_p \le 1 \}. \]

Note that the choice of $\rho \in (0,1)$ above does not affect the topological
properties of $\QQ_p$; for arithmetical reasons, later on we will fix
$\rho = 1/p$ (see p. \pageref{theorem:product-formula-Q}).

\begin{definition}
  A sequence of $p$-adic numbers $(\alpha_n)$ is said to \term{converge} to
  $\alpha\in \QQ_p$ if
  $$\lim_{n\to \infty}  \nu_p (\alpha_n - \alpha) = \infty;$$
  equivalently,
  $$\lim_{n\to \infty} |\alpha_n - \alpha|_p = 0.$$
\end{definition}

This is the same as convergence in the metric space $(\QQ_p, d)$.

\begin{example}
  The sequence $p, p^2, p^3, \ldots$ converges to $0$ in $\QQ_p$ since
  $ \nu_p (p^n) = n$ tends to $\infty$.
\end{example}

\begin{example}
  Let $\alpha \in \ZZ_p$ be a $p$-adic integer represented by a sequence
  $(x_0, x_1, x_2, \ldots)$ with $x_n \equiv x_{n-1} \pmod{p^n}$.
  So $x_n - x_{n-1} \equiv 0 \pmod{p^n}$, meaning
  $ \nu_p (x_n - x_{n-1}) \ge n$. Thus the sequence $(x_n - x_{n-1})$ converges
  to $0$ in $\ZZ_p$.
\end{example}

\begin{example}
  Let $\alpha \in \ZZ_p$ be a $p$-adic integer represented by a sequence
  $(x_0, x_1, x_2, \ldots)$ with $x_n \equiv x_{n-1} \pmod{p^n}$. Consider
  a sequence of $p$-adic numbers $(\alpha - x_n)$. One has
  $\nu_p (\alpha - x_n) \ge n+1$, which tends to $\infty$ as $n \to
  \infty$. This is clear if we look at $p$-adic expansions:
  \begin{align*}
    x_0 & = a_0, \\
    x_1 & = a_0 + a_1\,p,\\
    x_2 & = a_0 + a_1\,p + a_2\,p^2,\\
        & \cdots \\
    \alpha & = a_0 + a_1\,p + a_2\,p^2 + \cdots
  \end{align*}

  So if $\alpha \in \ZZ_p$ is represented by a sequence
  $(x_0, x_1, x_2, \ldots)$, then this sequence converges to $\alpha$.

  This also gives a precise sense to $p$-adic expansions
  $\alpha = \text{``}\sum_{n\ge 0} a_n \, p^n\text{''}$ that were introduced as
  formal expressions: the sum on the right hand side indeed converges to
  $\alpha$, treated as a limit of partial sums
  $x_n = (\sum_{0 \le i \le n} a_i \, p^i)_n$.
\end{example}

From this example we see that each $\alpha$ is a limit of a sequence of
integers. Thus $\ZZ$ is dense in $\ZZ_p$, and similarly $\QQ$ is dense in
$\QQ_p$. Now we investigate other topological properties of $\QQ_p$, and $\ZZ_p$
as its subspace.

\begin{theorem}
  $\ZZ_p$ is \term{sequentially compact}. That is, every infinite sequence in
  $\ZZ_p$ contains a convergent subsequence.

  \begin{proof}
    Let $(\alpha_n)$ be an infinite sequence in $\ZZ_p$ with terms

    \[ \alpha_n = a_{n,0} + a_{n,1}\,p + a_{n,2}\,p^2 + \cdots \]

    There exists an infinite number of $n$ such that the $0$-th $p$-adic digit
    of $\alpha_n$ is some $a_{n,0} = a_0$. We take the subsequence
    $(\alpha_n^{(0)})$ of such numbers. Similarly, there should be a subsequence
    $(\alpha_n^{(1)})$ with $1$-st $p$-adic digit being equal to some $a_1$, and
    so on. So there is a chain of such subsequences
    $(\alpha_n^{(0)}), (\alpha_n^{(1)}), (\alpha_n^{(2)}), \ldots$. One can take
    the ``diagonal sequence'' $(\beta_k)$ with $\beta_k \dfn \alpha_k^{(k)}$,
    which is a subsequence of $(\alpha_n)$ by construction. Also by
    the construction, it converges to the $p$-adic number
    \[ \beta = a_0 + a_1\,p + a_2\,p^2 + \cdots \qedhere \]
  \end{proof}
\end{theorem}

\begin{corollary}
  $\QQ_p$ is \term{locally compact}. That is, every bounded sequence in $\QQ_p$
  has a convergent subsequence.

  \begin{proof}
    Let $(\alpha_n)$ be a bounded sequence in $\QQ_p$. This means that
    $|\alpha_n|_p = \rho^{ \nu_p (\alpha_n)} \le A$ for some
    $A \in \mathbb{R}_{\ge 0}$.

    Take some $s$ big enough such that $|p^s|_p \le \frac{1}{A}$. Consider the
    sequence $(p^s \, \alpha_n)_n$. Then
    $|p^s \, \alpha_n|_p = |p^s|_p \cdot |\alpha_n|_p \le \frac{1}{A}\,A = 1$,
    thus $p^s \, \alpha_n \in \ZZ_p$. By the previous theorem, the sequence
    $(\beta_n) = (p^s \, \alpha_n)_n$ has a convergent subsequence
    $(\beta_{n_k})_k$. That is, there is some $\beta \in \ZZ_p$ such that
    $ \nu_p (\beta - \beta_{n_k}) \to \infty$ as $k \to \infty$. The sequence
    $(\alpha_{n_k})_k$ is a subsequence of $(\alpha_n)_n$, and it converges to
    the $p$-adic number $\beta / p^s$ since
    $\nu_p (\beta/p^s - \alpha_{n_k}) = \nu_p (\beta/p^s - \beta_{n_k}/p^s) =
    \nu_p (1/p^s \cdot (\beta - \beta_{n_k})) =
    \nu_p (1/p^s) + \nu_p (\beta - \beta_{n_k})$,
    which tends to $\infty$ as $k \to \infty$.
  \end{proof}
\end{corollary}

\begin{theorem}
  A sequence $(\alpha_n)$ in $\QQ_p$ converges iff $(\alpha_n - \alpha_{n-1})_n$
  converges to zero.

  \begin{proof}
    Assume $(\alpha_n)$ converges to some $\alpha \in \QQ_p$. Then
    $|\alpha_n - \alpha|_p \to 0$. That is, for each $\epsilon > 0$ there exists
    $N$ such that $|\alpha_n - \alpha|_p \le \epsilon$ for all $n \ge N$.
    But now
    \[ |\alpha_{n+1} - \alpha_n|_p =
      |(\alpha_{n+1} - \alpha) + (\alpha - \alpha_n)|_p \le
      \max \{ |\alpha_{n+1} - \alpha|_p, \, |\alpha - \alpha_n|_p \} \le \epsilon, \]
    so $\alpha_n - \alpha_{n-1} \to 0$.

    \vspace{1em}

    Assume now that $(\alpha_n - \alpha_{n-1})_n$ converges to zero. This means
    that the sequence $(\alpha_n - \alpha_{n-1})_n$ is bounded. We can choose
    $A$ such that $|\alpha_0|_p \le A$ and $|\alpha_n - \alpha_{n-1}|_p \le A$
    for all $n \ge 1$. So this means
    \begin{align*}
      |\alpha_n|_p & = |\alpha_n - \alpha_{n-1} \,+\, \alpha_{n-1} - \alpha_{n-1} \,+\, \cdots \,+\, \alpha_1 - \alpha_0 + \alpha_0|_p\\
                   & = |(\alpha_n - \alpha_{n-1}) + (\alpha_{n-1} - \alpha_{n-1}) + \cdots + (\alpha_1 - \alpha_0) + \alpha_0|_p\\
                   & \le \max (|\alpha_n - \alpha_{n-1}|_p, \ldots, |\alpha_1 - \alpha_0|_p, |\alpha_0|_p) \le A,
    \end{align*}
    and $(\alpha_n)$ is a bounded sequence in $\QQ_p$. It has a
    subsequence $(\alpha_{n_k})_k$ converging to some $\alpha$, because $\QQ_p$
    is locally compact. So for each $\epsilon > 0$ there exists $K$ such that
    $|\alpha - \alpha_k|_p < \epsilon$ for all $k \ge K$. But
    $\alpha_n - \alpha_{n-1}$ converges to zero, so there exists $N$ such that
    $|\alpha_n - \alpha_{n-1}|_p < \epsilon$ for all $n \ge N$. Thus for
    $n \ge N$ and $n \ge n_K$ we have
    \begin{align*}
      |\alpha_n - \alpha|_p & = |\alpha_n - \alpha_{n-1} + \alpha_{n-1} + \cdots + \alpha_{n_K + 1} - \alpha_{n_K} + \alpha_{n_K} - \alpha|_p\\
                            & \le \max \{ |\alpha_n - \alpha_{n-1}|_p, \ldots, |\alpha_{n_K + 1} - \alpha_{n_K}|_p, |\alpha_{n_K} - \alpha|_p \} < \epsilon.
    \end{align*}
    So $|\alpha_n - \alpha|_p < \epsilon$ for $n$ big enough, and $(\alpha_n)$
    converges to $\alpha$.
  \end{proof}
\end{theorem}

\begin{remark}
  The last theorem actually means that $\QQ_p$ is a
  \term{complete metric space}, that is, a sequence converges in $\QQ_p$ iff it
  is \term{Cauchy}, meaning that for each $\epsilon > 0$ there exists $N$ such
  that $|\alpha_n - \alpha_m| < \epsilon$ for all $n,m \ge N$.

  The Cauchy condition of course always implies that
  $\alpha_n - \alpha_{n-1} \to 0$, but actually for $\QQ_p$ the latter is
  \emph{equivalent} to the Cauchy condition, since

  \[ |\alpha_n - \alpha_m|_p =
    |\alpha_n - \alpha_{n-1} + \alpha_{n-1} - \alpha_{n-2} + \cdots + \alpha_{m+1} - \alpha_m|_p \le
    \max \{ |\alpha_n - \alpha_{n-1}|_p, \ldots, |\alpha_{m+1} - \alpha_m|_p \}. \]

  Note that this depends strongly on the ultrametric inequality
  $|x + y|_p \le \max \{ |x|_p, |y|_p \}$, and in the proof of the theorem above
  we use the same trick.

  The last theorem is \emph{not} true for all complete metric spaces.
  For example, in $\mathbb{R}$ with the usual Euclidean metric the sequence
  $(\sum_{1 \le i \le n} \frac{1}{i})_n$ satisfies the condition from the
  theorem, but it is not Cauchy, and indeed the harmonic series
  $\sum_{n\ge 1} \frac{1}{n}$ diverges.
\end{remark}

\begin{corollary}
  The series $\sum_{n \ge 0} \alpha_n$ converges in $\QQ_p$ iff the sequence
  $(\alpha_n)$ converges to zero.

  \begin{proof}
    The series is by definition given by the sequence
    $(\sum_{0 \le i \le n} \alpha_i)_n$, so it converges iff
    $(\sum_{0 \le i \le n} \alpha_i - \sum_{0 \le i \le n-1} \alpha_i)_n = (\alpha_n)_n$
    converges to zero.
  \end{proof}
\end{corollary}

\section{Fields with absolute values}

\begin{definition}
  Let $K$ be a field. An \term{absolute value} is a function
  $|\cdot|\colon K\to \mathbb{R}_{\ge 0}$ satisfying the following properties:

  \begin{enumerate}
  \item $|\alpha| = 0$ iff $\alpha = 0$.

  \item Multiplicativity: $|\alpha\,\beta| = |\alpha|\cdot |\beta|$ for all
    $\alpha,\beta\in K$.

  \item Triangle inequality: $|\alpha + \beta| \le |\alpha| + |\beta|$ for all
    $\alpha,\beta\in K$.
  \end{enumerate}
\end{definition}

In particular, multiplicativity implies that $|1| = 1$.

\begin{example}
  \begin{itemize}
  \item The usual absolute values on $\QQ, \mathbb{R}, \mathbb{C}$ give examples
    of absolute values in the sense of the definition above.

  \item The $p$-adic absolute value $|\cdot|_p$ on $\QQ_p$ is an absolute
    value. It is also an absolute value on the subfield $\QQ \subset \QQ_p$.

  \item There is always the trivial absolute value given by $|\alpha| \dfn 1$
    for all $\alpha \ne 0$.

  \item If $K = F(t)$ where $F$ is another field, then for $x \in F(t)$ the
    \term{order of vanishing} at $\alpha \in F$ is given by
    $\ord_\alpha x \dfn m$ such that $(t-\alpha)^{-m}$ has no zeroes and no
    poles at $\alpha$.

    So $\ord_\alpha x > 0$ if $x$ has a zero at $\alpha$ and $\ord_\alpha x < 0$
    if $x$ has a pole at $\alpha$.

    $|\cdot|_\alpha \dfn \ord_\alpha (\cdot)$ is an absolute value on
    $F(t)$. \qedhere
  \end{itemize}
\end{example}

A field $K$ with an absolute value $|\cdot|$ is a metric space with respect to
the distance $d (\alpha,\beta) \dfn |\alpha - \beta|$. We call $K$ a
\term{complete field} if it is complete as a metric space (i.e. every Cauchy
sequence converges).

\begin{example}
  \begin{itemize}
  \item $\QQ$ is not complete. The completion of $\QQ$ with respect to the usual
    absolute value $|\cdot|$ is $\mathbb{R}$. The completion of $\QQ$ with
    respect to a $p$-adic absolute value $|\cdot|_p$ is $\QQ_p$.

  \item For $\mathbb{R}$ we can take $\mathbb{C}$, its algebraic closure. It is
    again complete with respect to the usual absolute value on $\mathbb{C}$.

  \item $\QQ_p$ is not algebraically closed. If we take the algebraic closure
    $(\QQ_p)^\mathrm{alg}$, then is not complete, but its completion is
    algebraically closed; it is usually denoted by $\mathbb{C}_p$.

  \item The completion of $F (t)$ with respect to
    $|\cdot|_0 \dfn \ord_0 (\cdot)$ is the field of Laurent series
    $F (\!(t)\!)$. \qedhere
  \end{itemize}
\end{example}

For every field $K$ we can consider the subring $\ZZ_K$ generated by $1$ (the
smallest subring). It is isomorphic either to $\ZZ$ if $\fchar K = 0$ or to
$\FF_p$ if $\fchar K = p > 0$.

\begin{definition}
  We say that the absolute value $|\cdot|$ on $K$ is \term{archimedian} if it is
  not bounded on $\ZZ_K$, and \term{nonarchimedian} otherwise.
\end{definition}

Trivially, a field of characteristic $p > 0$ has only nonarchimedian absolute
values.

Observe that a nonarchimedian absolute value should satisfy $|x| \le 1$ for all
$x \in \ZZ_K$, otherwise the absolute value of $|x^n|$ is not bounded.

\begin{example}
  The usual absolute value is archimedian.

  The $p$-adic absolute value $|\cdot|_p$, the trivial absolute value, the
  absolute value $|\cdot|_\alpha$ on $F (t)$ are all nonarchimedian.
\end{example}

\begin{theorem}
  Let $K$ be a field with an absolute value $|\cdot|$. The following are
  equivalent:

  \begin{enumerate}
  \item $|\cdot|$ is nonarchimedian.

  \item $|\alpha+\beta| \le \max \{ |\alpha|, |\beta| \}$.
  \end{enumerate}

  \begin{proof}
    Clearly (2) implies (1): for $n = 1 + 1 + \cdots + 1 \in \ZZ_K$ one has
    \[ |n| \le \max \{ |1|, |1|, \ldots, |1| \} = 1. \]
    The other direction $(1) \Rightarrow (2)$ is left as an exercise.
  \end{proof}
\end{theorem}

\begin{remark}
  For a nonarchimedian absolute value $|\cdot|$ one has
  \[ |\alpha+\beta| = \max \{|\alpha|, |\beta| \} \quad\text{for}\quad |\alpha| \ne |\beta|. \]

  Indeed, assume $|\alpha| > |\beta|$. Then $|\alpha+\beta| \le |\alpha|$, but
  also
  $|\alpha| = |(\alpha+\beta)-\beta| \le \max \{ |\alpha+\beta|, |\beta| \} =
  |\alpha+\beta|$. Thus $|\alpha+\beta| = |\alpha|$.
\end{remark}

\begin{definition}
  Let $|\cdot|_1$ and $|\cdot|_2$ be absolute values on $K$. Then we say that
  they are \term{equivalent}, $|\cdot|_1 \sim |\cdot|_2$, if they define the
  same topology on $K$ (that is, every sequence $(\alpha_n)$ converges to
  $\alpha$ with respect to $|\cdot|_1$ iff it converges to $\alpha$ with respect
  to $|\cdot|_2$).
\end{definition}

\begin{example}
  Consider the absolute value $|\cdot|_{1/2}$ on $\mathbb{R}$ or $\QQ$ given by
  $|\alpha|_{1/2} \dfn |\alpha|^{1/2}$. It is equivalent to the usual absolute
  value.

  Define a $p$-adic absolute value on $\QQ$ by
  $|\cdot|_p \dfn \rho^{ \nu_p (\alpha)}$ for $\rho \in (0,1)$. Different
  choices of $\rho$ lead to different but equivalent absolute values.
\end{example}

In general, if $|\cdot|$ is an absolute value, then $|\cdot|^\lambda$ is an
absolute value equivalent to $|\cdot|$, if holds

\begin{itemize}
\item $\lambda \in (0,1]$ when $|\cdot|$ is archimedian,

\item $\lambda \in (0,+\infty)$ when $|\cdot|$ is nonarchimedian.
\end{itemize}

\begin{theorem}
  Let $|\cdot|_1$ and $|\cdot|_2$ be absolute values on $K$. The following are
  equivalent:
  \begin{enumerate}
  \item $|\cdot|_1 \sim |\cdot|_2$.

  \item There exists $\lambda \in \mathbb{R}_{\ge 0}$ such that
    $|\cdot|_2 = |\cdot|_1^\lambda$.
  \end{enumerate}

  \begin{proof}
    $(2) \Rightarrow (1)$ is clear, $(1) \Rightarrow (2)$ is an exercise.
  \end{proof}
\end{theorem}

\begin{theorem}[Weak approximation theorem]
  Let $K$ be a field. Let $|\cdot|_1, \ldots, |\cdot|_m$ be pairwise
  nonequivalent absolute values (finitely many). Let
  $\alpha_1,\ldots,\alpha_m \in K$ and let $\epsilon > 0$. Then there exists
  $\alpha \in K$ such that

  \[ |\alpha-\alpha_1|_1, \ldots, |\alpha-\alpha_m|_m < \epsilon. \]
\end{theorem}

Proof is left as an exercise (rather tricky).

\begin{example}
  Let $K = \QQ$ and let $p_1,\ldots, p_m$ be distinct primes and
  $s_1, \ldots, s_m$ be natural numbers. For $\alpha_1,\ldots,\alpha_m \in \ZZ$
  there exists $\alpha \in \ZZ$ such that
  \begin{align*}
    \alpha & \equiv \alpha_1 \pmod{p_1^{s_1}},\\
           & \cdots \\
    \alpha & \equiv \alpha_m \pmod{p_m^{s_m}}.
  \end{align*}

  So the weak approximation theorem generalizes the Chinese remainder theorem.
\end{example}

Let $K_i$ be the completions of $K$ with respect to the absolute values
$|\cdot|_i$. We may consider the diagonal embedding
\begin{align*}
  K & \hookrightarrow K_1 \times \cdots \times K_m,\\
  \alpha & \mapsto (\alpha, \ldots, \alpha).
\end{align*}

The weak approximation theorem is equivalent to saying that the image of this
map is dense.

We know the following examples of absolute values on $\QQ$: the usual $|\cdot|$,
the $p$-adic $|\cdot|_p$ for each prime $p$, and the trivial one. In fact, that
is all.

\begin{theorem}[Ostrowski]
  Every nontrivial absolute value on $\QQ$ is equivalent either to $|\cdot|$, or
  to $|\cdot|_p$ for some $p$.
\end{theorem}

Proof is left as an exercise (easy for nonarchimedian absolute values; a bit
harder to show that there is only the usual archimedian absolute value).

\vspace{1em}

We denote by $M_\QQ$ the set of all absolute values on $\QQ$ up to
equivalence. We want to pick convenient representatives in every equivalence
class:
\begin{itemize}
\item $|\cdot|$ is the usual archimedian absolute value.

\item For every prime $p$ take $|\alpha|_p \dfn \rho^{ \nu_p (\alpha)}$ with
  $\rho = 1/p$. That is, $|\alpha|_p \dfn p^{-\nu_p(\alpha)}$.
\end{itemize}

Now by $M_\QQ = \{ 2, 3, 5, 7, 11, \ldots \} \cup \{\infty\}$ we denote the set
of ``normalized'' absolute values. We treat $|\cdot|$ as an absolute value
$|\cdot|_\infty$ coming from an ``infinite prime''.

\begin{theorem}[Product formula]\label{theorem:product-formula-Q}
  Let $\alpha \in \QQ^\times$. Then
  $$\prod_{p \in M_\QQ} |\alpha|_p = 1.$$

  \begin{proof}
    Consider a function $\phi (\alpha) \dfn \prod_{p\in M_\QQ} |\alpha|_p$.
    It is multiplicative, so it is enough to verify the statement for the
    generators of $\QQ^\times$, that is for prime numbers.

    \[ |q|_p = \left\{\begin{array}{ll}
                        q^{-1}, & p = q,\\
                        q, & p = \infty,\\
                        1, & \text{otherwise}.
                      \end{array}\right. \]

    \[ \prod_{p\in M_\QQ} |q|_p = q^{-1}\,q = 1. \qedhere \]
  \end{proof}
\end{theorem}

\begin{example}
  Let $\alpha = - 12/5$. Then we have
  \[ |\alpha|_2 = \frac{1}{4}, ~
    |\alpha|_3 = \frac{1}{3}, ~
    |\alpha|_5 = 5, ~
    |\alpha|_\infty = \frac{12}{5}, \]

  \[ |\alpha|_p = 1 \quad\text{for } p \ne 2,3,5. \]

  Hence indeed,
  \[ \prod_{p\in M_\QQ} |\alpha|_p =
    \frac{1}{4}\cdot \frac{1}{3}\cdot 5\cdot \frac{12}{5} = 1. \qedhere \]
\end{example}

The product formula can be generalized to any number field $K/\QQ$---see
p. \pageref{product-formula-K}.

\section{Equations over $p$-adic numbers}

We relate equations over $p$-adic numbers to congruences modulo $p^k$.

\begin{theorem}
  Let $F (X_1, \ldots, X_n) \in \ZZ [X_1,\ldots, X_n]$ be a polynomial with
  integer coefficients. Let $p$ be a prime number. The following are equivalent:
  \begin{enumerate}
  \item For all $k = 1,2,3,\ldots$ the congruence
    $F (X_1,\ldots,X_n) \equiv 0 \pmod{p^k}$ has a solution.

  \item The equation $F (X_1,\ldots,X_n) = 0$ has a solution in $\ZZ_p$.
  \end{enumerate}

  \begin{proof}
    Suppose $\underline{\alpha} = (\alpha_1,\ldots,\alpha_n) \in \ZZ_p^n$ is a
    solution of an equation $F (\underline{X}) = 0$. Then looking at the
    identity $F (\underline{\alpha}) = 0$ modulo $p^k$, we have a congruence
    $F (\underline{a}) \equiv 0 \pmod{p^k}$ with some $\underline{a} \in \ZZ^n$
    (recall that $\ZZ_p/(p^k) \isom \ZZ/p^k\ZZ$).

    Now suppose that for $k = 1,2,3,\ldots$ there exists a sequence of integers
    $\underline{a}^{(k)} = (a_1^{(k)}, \ldots, a_n^{(k)})$ such that
    $F (\underline{a}^{(k)}) \equiv 0 \pmod{p^k}$. Since $\ZZ_p$ is sequentially
    compact, we may assume that this sequence is convergent to some
    $\underline{\alpha} \in \ZZ_p^n$ (by replacing it with some
    subsequence). Now
    $F (\underline{\alpha}) = \lim_{k\to \infty} F (\underline{a}^{(k)}) = 0$,
    because $|F (\underline{a}^{(k)})| \le p^{-k}$.
  \end{proof}
\end{theorem}

Moreover, if $F$ is, say, a quadratic form, then \emph{nontrivial} solutions of
$F (\underline{X}) = 0$ correspond to \emph{nontrivial} solutions of
$F (\underline{X}) \equiv 0 \pmod{p^k}$. Now we can restate our goal, the
Hasse--Minkowski theorem (\ref{theorem:Hasse-Minkowski-1}), in the following
way.

\begin{theorem}[Local--global principle; Hasse, Minkowski]\label{theorem:Hasse-Minkowski-2}
  Let $F (X_1,\ldots,X_n) \in \ZZ [X_1,\ldots,X_n]$ be a quadratic form. The
  following conditions are equivalent:
  \begin{enumerate}
  \item \underline{Local}: $F (\underline{X}) = 0$ has a nontrivial solution in
    $\QQ_p^n$ for each $2 \le p \le \infty$.

  \item \underline{Global}: $F (\underline{X}) = 0$ has a nontrivial solution in
    $\QQ^n$.
  \end{enumerate}
\end{theorem}

\section{Hensel's lemma}

Here we will establish Hensel's lemma, a vital tool which will be used in many
subsequent proofs.

\begin{theorem}[Hensel's Lemma, first form]\label{theorem:Hensel-first}
  Let $f (X) \in \ZZ_p [X]$ be a $p$-adic polynomial and assume there exists
  $\alpha_0 \in \ZZ_p$ such that $f (\alpha_0) \equiv 0 \pmod{p}$ but
  $f^\prime (\alpha_0) \not\equiv 0 \pmod{p}$. Then there exists a unique
  $\alpha \in \ZZ_p$ such that $f (\alpha) = 0$ and
  $\alpha \equiv \alpha_0 \pmod{p}$.
\end{theorem}

\begin{example}
  \emph{There exists $\alpha \in \ZZ_7$ such that $\alpha^2 \equiv 2 \pmod{7}$
    and $\alpha \equiv 3 \pmod{7}$.}

  For this apply the Hensel's lemma to $f (X) = X^2 - 2$ and $\alpha_0 = 3$.
  We have $f (\alpha_0) = 7 \equiv 0 \pmod{7}$ and
  $f^\prime (\alpha_0) = 6 \not\equiv 0 \pmod{7}$.

  This is the $7$-adic square root of $2$:
  $$\sqrt{2} = 3 + 7 + 2\cdot 7^2 + 6\cdot 7^3 + 7^4 + 2\cdot 7^5 + 7^6 + 2\cdot 7^7 + 4\cdot 7^8 + 6\cdot 7^9 + \cdots$$

  We already saw this in \refref{example}{example:sqrt-2}.
\end{example}

Sometimes the stated Hensel's lemma is not enough and one should use its
generalization.

\begin{theorem}[Hensel's Lemma, strong form]\label{theorem:Hensel-strong}
  Let $f (X) \in \ZZ_p [X]$ be a $p$-adic polynomial and assume there exists
  $\alpha_0 \in \ZZ_p$ such that $f (\alpha_0) \equiv 0 \pmod{p^{2k+1}}$ but
  $f^\prime (\alpha_0) \not\equiv 0 \pmod{p^{k+1}}$. Then there exists a unique
  $\alpha \in \ZZ_p$ such that $f (\alpha) = 0$ and
  $\alpha \equiv \alpha_0 \pmod{p^{k+1}}$.
\end{theorem}

\noindent (Usually $k = 1$ is enough.)

\vspace{1em}

Actually Hensel's lemma is valid for any complete nonarchimedian field. Suppose
$K$ is complete with respect to a nonarchimedian absolute value
$|\cdot|$. Consider its \term{ring of integers}
$$\mathcal{O}_K \dfn \{ x \in K \,\mid\, |x| \le 1 \}.$$

\begin{theorem}[General Hensel]
  Suppose $f (X) \in \mathcal{O}_K [X]$ is a polynomial, and $\alpha_0 \in \mathcal{O}_K$ is such
  that $|f (\alpha_0)| < 1$ and $|f^\prime (\alpha_0)| = 1$. Then there exists a
  unique $\alpha \in \mathcal{O}_K$ such that $f (\alpha) = 0$ and
  $|\alpha - \alpha_0| < 1$.
\end{theorem}

\begin{theorem}[General Hensel, strong form]\label{theorem:general-hensel-strong}
  Suppose $f (X) \in \mathcal{O}_K [X]$ is a polynomial, and $\alpha_0 \in \mathcal{O}_K$ is such
  that $|f (\alpha_0)| < |f^\prime (\alpha_0)|^2$. Then there exists a unique
  $\alpha \in \mathcal{O}_K$ such that $f (\alpha) = 0$ and
  $|\alpha - \alpha_0| \le \frac{|f(\alpha_0)|}{|f^\prime (\alpha_0)|}$.
\end{theorem}

\begin{remark}
  In fact Hensel's lemma is about complete \emph{rings}:

  \noindent\emph{Let $R$ be a ring that is complete with respect to the ideal
    $\mathfrak{m}$. Suppose $f (X) \in R [X]$ is a polynomial, and
    $\alpha_0 \in R$ is such that
    $f (\alpha_0) \equiv 0 \pmod{f^\prime (\alpha_0)^2\,\mathfrak{m}}$. Then
    there exists $\alpha \in R$ such that $f (\alpha) = 0$ and
    $\alpha \equiv \alpha_0 \pmod{f^\prime (\alpha_0)\,\mathfrak{m}}$. Further,
    if $\alpha_0$ is not a zero divisor in $R$, then $\alpha$ is unique.}

  See \emph{Eisenbud, Commutative Algebra with a View Toward Algebraic Geometry,
    Chapter 7} and \emph{Atiyah, Macdonald, Introduction to Commutative Algebra,
    Exercises 10.9, 10.10}.

  We are interested only in the case $R = \mathcal{O}_K$, where $K$ is a complete
  nonarchimedian field.
\end{remark}

\begin{proof}[Proof of the first statement (\refref{theorem}{theorem:Hensel-first})]
  So we suppose we have a polynomial $f (X) \in \ZZ_p [X]$ and
  $\alpha_0 \in \ZZ_p$ such that $f (\alpha_0) \equiv 0 \pmod{p}$ and
  $f^\prime (\alpha_0) \not\equiv 0 \pmod{p}$. We want to find
  $\alpha \in \ZZ_p$ such that $f (\alpha) = 0$ and
  $\alpha \equiv \alpha_0 \pmod{p}$. Moreover, we want to show that such
  $\alpha$ is unique.

  We construct a sequence $(\alpha_n)_{n \ge 0}$ such that
  $\alpha_n \equiv \alpha_{n-1} \pmod{p^n}$ and
  $f (\alpha_n) \equiv 0 \pmod{p^{n+1}}$. All terms in our sequence will satisfy
  $\alpha_n \equiv \alpha_0 \pmod{p}$. In particular,
  $f^\prime (\alpha_n) \equiv f^\prime (\alpha_0) \not\equiv 0 \pmod{p}$.

  Assume $\alpha_{n-1}$ is defined and $f (\alpha_{n-1}) \equiv 0 \pmod{p^n}$
  and $f^\prime (\alpha_{n-1}) \not\equiv 0 \pmod{p}$. We need to define
  $\alpha_n$ of the form $\alpha_{n-1} + p^n\,u$ for some $u$. Look at the
  ``Taylor expansion'' around $\alpha_{n-1}$:
  $$f(\alpha_n) = f (\alpha_{n-1}) + f^\prime (\alpha_{n-1}) \, (\alpha_n - \alpha_{n-1}) + (\alpha_n - \alpha_{n-1})^2 \, g (\alpha_n,\alpha_{n-1}).$$

  Here $g (X,Y) \in \ZZ_p [X,Y]$ gives the rest of the expansion.

  We should have $\alpha_n - \alpha_{n-1} = p^n\,u$ for some $u$, so
  $$f(\alpha_n) = f (\alpha_{n-1}) + p^n\,u\,f^\prime (\alpha_{n-1}) + p^{2n}\,u^2 \, g (\alpha_n,\alpha_{n-1}) \equiv f (\alpha_{n-1}) + p^n\,u\,f^\prime (\alpha_{n-1}) \pmod{p^{2n}}.$$

  As required, $f (\alpha_n) \equiv f (\alpha_{n-1}) \equiv 0 \pmod{p}$.

  Since $f (\alpha_{n-1}) \equiv 0 \pmod{p^n}$, we have
  $f (\alpha_{n-1}) = v\,p^n$, and in $\alpha_n = \alpha_{n-1} + p^n\,u$ we can
  substitute $u \dfn -v/f^\prime (\alpha_{n-1})$, that is take

  \[ \tag{*} \alpha_n \dfn \alpha_{n-1} - \frac{f(\alpha_{n-1})}{f^\prime (\alpha_{n-1})}. \]

  Now $|\alpha_n - \alpha_{n-1}|_p \to 0$ as $n\to \infty$, so our sequence
  converges to some $\alpha \in \ZZ_p$. For this $\alpha$ we have
  $f (\alpha) = \lim_{n\to \infty} f (\alpha_n) = 0$. Since
  $\alpha_n \equiv \alpha_0 \pmod{p}$, we have
  $\alpha \equiv \alpha_0 \pmod{p}$.

  \vspace{1em}

  Now we found the requested $\alpha$, and it remains to show its
  uniqueness. Assume we have also $\beta$ such that $f (\alpha) = f (\beta) = 0$
  and $\alpha \equiv \beta \equiv \alpha_0 \pmod{p}$. Since
  $f^\prime (\alpha_0) \not\equiv 0 \pmod{p}$, we have
  $f^\prime (\alpha) \not\equiv 0 \pmod{p}$. As before, we look at a ``Taylor
  expansion''. We have an identity in $\ZZ_p$
  $$\underbrace{f (\beta)}_{= 0} = \underbrace{f (\alpha)}_{= 0} + f^\prime (\alpha) \, (\beta-\alpha) + (\beta - \alpha)^2 \, g (\alpha,\beta).$$

  Since $f^\prime (\alpha)$ is a unit, we have
  $$\beta - \alpha = -(\beta-\alpha)^2 \, g(\alpha,\beta) \, f^\prime (\alpha)^{-1}.$$

  We compute $p$-adic norms of both sides: the term
  $g(\alpha,\beta) \, f^\prime (\alpha)^{-1}$ gives some norm
  $|g(\alpha,\beta) \, f^\prime (\alpha)^{-1}|_p \le 1$, so we have a bound
  $$|\beta-\alpha|_p \le |\beta - \alpha|_p^2.$$

  Since $|\beta-\alpha|_p < 1$, this inequality means
  $|\beta-\alpha|_p = 0$, and so $\beta = \alpha$.
\end{proof}

Observe that in the proof above we used the formula (*), which is the same as in
the Newton's method for finding a root of $f$ in $\mathbb{R}$. So we see that in
the nonarchimedian case Newton's method always converges.

\vspace{1em}

\begin{proof}[Proof of the general Hensel (\refref{theorem}{theorem:general-hensel-strong})]
  We have a polynomial $f (X) \in \mathcal{O}_K [X]$ and $\alpha_0 \in \mathcal{O}_K$ is such that
  $|f (\alpha_0)| < |f^\prime (\alpha_0)|^2$. We look for $\alpha \in \mathcal{O}_K$ such
  that $f (\alpha) = 0$ and
  $|\alpha - \alpha_0| \le \frac{|f(\alpha_0)|}{|f^\prime (\alpha_0)|}$. We will
  show that such $\alpha$ exists and we omit the proof of its uniqueness.

  Denote
  $$\delta \dfn \frac{|f (\alpha_0)|}{|f^\prime (\alpha_0)|^2} < 1.$$
  We recursively define a sequence $(\alpha_n)_{n \ge 0}$ such that the
  following formulas hold:
  \begin{gather*}
    \tag*{$(1)_n$} |f (\alpha_n)| \le \delta^{2^n} \, |f^\prime (\alpha_0)|^2,\\
    \tag*{$(2)_n$} |\alpha_n - \alpha_{n-1}| \le \delta^{2^{n-1}} \, |f^\prime (\alpha_0)|,\\
    \tag*{$(3)_n$} |f^\prime (\alpha_n)| = |f^\prime (\alpha_0)|.
  \end{gather*}

  Assume we have $\alpha_{n-1}$. We define the next term again by the Newton's
  formula
  $$\alpha_n \dfn \alpha_{n-1} - \frac{f (\alpha_{n-1})}{f^\prime (\alpha_{n-1})}.$$

  We should show that $(1)_n,(2)_n,(3)_n$ follow from
  $(1)_{n-1},(2)_{n-1},(3)_{n-1}$. With this definition of $\alpha_n$ we deduce
  \[ |\alpha_n - \alpha_{n-1}| =
    \frac{|f (\alpha_{n-1})|}{|f^\prime (\alpha_{n-1})|} \le
    \frac{\delta^{2^{n-1}}\,|f^\prime (\alpha_0)|^2}{|f^\prime (\alpha_0)|} =
    \delta^{2^{n-1}} \, |f^\prime (\alpha_0)|. \]

  Next we have
  \[ f (\alpha_n) = \underbrace{f (\alpha_{n-1}) + (\alpha_n - \alpha_{n-1}) \, f^\prime (\alpha_{n-1})}_{=0} +
    (\alpha_n - \alpha_{n-1})^2 \, g (\alpha_n,\alpha_{n-1}), \]
  and this gives an estimate
  $$|f (\alpha_n)| \le |\alpha_n - \alpha_{n-1}|^2 \le \delta^{2^n} \, |f^\prime (\alpha_0)|^2.$$

  We have another estimate
  $$|\alpha_n - \alpha_{n-1}| \le \delta^{2^{n-1}}\,|f^\prime (\alpha_0)| < |f^\prime (\alpha_0)|.$$

  We apply this to the formula
  $$f^\prime (\alpha_n) = f^\prime (\alpha_0) + (\alpha_n - \alpha_0) \, h (\alpha_n,\alpha_0)$$
  and get
  $$|f^\prime (\alpha_n) - f^\prime (\alpha_0)| =
  |\alpha_n - \alpha_0| \cdot |h (\alpha_n,\alpha_0)| < |f^\prime (\alpha_0)|.$$

  Now $|f^\prime (\alpha_n)| = |f^\prime (\alpha_0)|$, since otherwise the last
  bound becomes
  \[ \max \{ |f^\prime (\alpha_n)|, |f^\prime (\alpha_0)| \} =
    |f^\prime (\alpha_0)| < |f^\prime (\alpha_0)|. \qedhere \]
\end{proof}

\vspace{1em}

The Hensel's lemma can be generalized to multivariate polynomials.

\begin{theorem}\label{theorem:multivariate-hensel}
  Let $F (X_1,\ldots,X_n) \in \ZZ_p [X_1,\ldots,X_n]$ be a polynomial in $n$
  variables and let
  $\underline{\gamma} = (\gamma_1, \ldots, \gamma_n) \in \ZZ_p^n$ be such that
  $F (\underline{\gamma}) \equiv 0 \pmod{p^{2k+1}}$ and there is some
  $i = 1,\ldots,n$ such that
  $F^\prime_{X_i} (\underline{\gamma}) \ne 0 \pmod{p^{k+1}}$. Then there exists
  $\underline{\alpha} \in \ZZ_p^n$ such that
  $\underline{\alpha} = \underline{\gamma} \pmod{p^{k+1}}$ and
  $F (\underline{\alpha}) = 0$.
\end{theorem}

This reduces to the usual Hensel's lemma. We may assume $i = 1$. Consider
$f (X) \dfn F (X, \gamma_2, \ldots, \gamma_n)$ and take $\beta_0 \dfn
\gamma_1$. Then $f^\prime (\beta_0) = F^\prime_{X_1} (\underline{\gamma})$ and
we can conclude that there exists a unique $\beta$ such that
$\beta \equiv \beta_0 \pmod{p^{k+1}}$ and $f (\beta) = 0$. Take
$\underline{\alpha} \dfn (\beta, \gamma_2, \ldots, \gamma_n)$, and we are done.

\section{Squares in $\QQ_p^\times$}

As an application of Hensel's lemma, we investigate the squares in
$\QQ_p^\times$. In the group of units $\QQ_p^\times$ there is a subgroup, which
we denote by $(\QQ_p^\times)^2$, formed by squares:
\[ (\QQ_p^\times)^2 \dfn \{ \alpha^2 \mid \alpha \in \QQ_p^\times \}. \]

We would like to determine the subgroup index
$[\QQ_p^\times : (\QQ_p^\times)^2]$.

\vspace{1em}

The easiest case is $p = \infty$. The subgroup of squares
$(\mathbb{R}^\times)^2$ is the multiplicative group of positive numbers, and
$[\mathbb{R}^\times : (\mathbb{R}^\times)^2] = 2$.

\vspace{1em}

Assume that $2 < p < \infty$. Consider a unit $\epsilon \in \ZZ_p^\times$. When
is it a square?

\begin{proposition}
  Assume $p \ne 2$. Then $\epsilon$ is a square in $\ZZ_p$ if $\epsilon \mod p$
  is a square in $\FF_p$.

  \begin{proof}
    We apply Hensel's lemma (\ref{theorem:Hensel-first}) to a polynomial
    $f (X) = X^2 - \epsilon$. Its derivative is $f^\prime (X) = 2\,X$. If there
    exists $\eta_0$ such that $\eta_0^2 \equiv \epsilon \pmod{p}$, then
    automatically $f^\prime (\eta_0) = 2\,\eta_0 \not \equiv 0 \pmod{p}$, and by
    Hensel there exists $\eta \in \ZZ_p$ such that $\eta^2 = \epsilon$.

    (Note that the derivative is $2\,X$, so our argument depends on the
    assumption $p \ne 2$!)
  \end{proof}
\end{proposition}

We have $\ZZ_p/(p) \isom \FF_p$, and $\FF_p^\times$ is a cyclic group of order
$p-1$. The subgroup of squares $(\FF_p^\times)^2$ has index $2$. Now
$\epsilon \in \ZZ_p^\times$ is a square iff the image of $\epsilon$ in
$\FF_p^\times$ is a square. Hence $[\ZZ_p^\times : (\ZZ_p^\times)^2] = 2$.

An element $\alpha \in \QQ_p^\times$ has form $\alpha = p^m \epsilon$ for
$\epsilon \in \ZZ_p^\times$. It is a square iff $m$ is even and $\epsilon$ is a
square. Hence $[\QQ_p^\times : (\QQ_p^\times)^2] = 4$.

\vspace{1em}

The situation becomes most complicated for $p = 2$, because of the well-known
principle:
\[ \text{\it all primes are odd and }2\text{\it{} is the oddest}. \]

\begin{proposition}
  A unit $\epsilon \in \ZZ_2^\times$ is a square in $\ZZ_2^\times$ iff
  $\epsilon \equiv 1 \pmod{8}$.

  \begin{proof}
    Assume $\epsilon \equiv 1 \pmod{8}$. Apply the Hensel's lemma (the strong
    form, \refref{theorem}{theorem:Hensel-strong}) for $f (X) = X^2 - \epsilon$
    and $\eta_0 = 1$. We have $F (\eta_0) \equiv 0 \pmod{8}$ and
    $f^\prime (\eta_0) = 2 \not\equiv 0 \pmod{4}$. So there exists $\eta$ such
    that $\eta^2 - \epsilon = 0$ and $\eta \equiv \eta_0 \pmod{8}$.
  \end{proof}
\end{proposition}

Now we have $\ZZ_2 / (8) \isom \ZZ/8\ZZ$ and
$(\ZZ/8\ZZ)^\times \isom C_2 \times C_2$. So
$[\ZZ_2^\times : (\ZZ_2^\times)^2] = 4$ and
$[\QQ_2^\times : (\QQ_2^\times)^2] = 8$.

\vspace{1em}

To sum up our calculation,

\[ [\QQ_p^\times : (\QQ_p^\times)^2] =
  \left\{\begin{array}{ll}
           2, & p = \infty,\\
           4, & 2 < p < \infty,\\
           8, & p = 2.
         \end{array}\right. \]

\section{Quadratic forms and quadratic spaces}

Now we are going to develop some basic theory of quadratic forms that we will
need later.

\vspace{1em}

Let $K$ be a field and let $U$ be a vector space over $K$. Consider a symmetric
bilinear form $\psi\colon U\times U\to K$ (recall that this means that
$\psi (u,v) = \psi (v,u)$, and $\psi (-,v), \psi (u,-)\colon U\to K$ are both
linear maps).

We can define a quadratic form $\phi (u) \dfn \psi (u,u)$; if $\fchar K \ne 2$,
then this in turn defines $\psi$, e.g. via the \term{polarization identity}

\[ \psi (u,v) = \frac{1}{4} (\phi (u+v) + \phi (u-v)). \]

Indeed,
\begin{align*}
  \psi (u,u) & \rdfn \phi (u),\\
  2 \, \psi (u,v) & = \phi (u+v) - \phi (u) - \phi (v),\\
  2 \, \psi (u,v) & = \phi (u) + \phi (v) - \phi (u-v),\\
  4 \, \psi (u,v) & = \phi (u+v) - \phi (u-v).
\end{align*}

So from now on we impose the restriction $\fchar K \ne 2$ and we will use
$\psi\colon U\times U\to K$ and $\phi\colon U\to K$ interchangeably for a
bilinear form and the corresponding quadratic form.

\begin{proposition}
  Assume $\psi$ is not identically zero. Then neither is $\phi$ identically
  zero.

  \begin{proof}
    This is immediate from the polarization identity: if $\psi (u,v) \ne 0$,
    then either $\phi (u+v) \ne 0$ or $\psi (u-v) \ne 0$.
  \end{proof}
\end{proposition}

\begin{definition}
  A pair $(U,\psi)$ consisting of a $K$-vector space $U$ and a symmetric
  bilinear map $\psi\colon U\times U\to K$ is called a \term{quadratic
    space}. We say that a quadratic space is \term{regular} if $\psi$ is
  nondegenerate; that is, if for each $u \ne 0$ the linear map
  $v \mapsto \psi (u,v)$ is nonzero.

  \begin{align*}
    U & \to U^\vee \dfn \Hom (U,K),\\
    u & \mapsto (v \mapsto \psi (u,v)).
  \end{align*}
\end{definition}

We will work with finite dimensional vector spaces. We will also treat both
$(U,\psi)$ and $(U,\phi)$ as the same quadratic space.

\begin{proposition}
  The following are equivalent:
  \begin{enumerate}
  \item $(U,\psi)$ is regular.

  \item If $u_1, \ldots, u_n$ is a basis of $U$, then
    $\det [\psi (u_i, u_j)] \ne 0$.
  \end{enumerate}
\end{proposition}

\noindent (A proof can be found in any linear algebra textbook.)

\vspace{1em}

We call the number $\delta (\phi) = \delta (\psi) \dfn \det [\psi (u_i, u_j)]$
the \term{discriminant} of the quadratic form. It is not well-defined since
there is no canonical basis for $U$. We consider it modulo squares, i.e. as an
element of $K^\times / (K^\times)^2$.

\begin{example}\label{example:hyperbolic-plane}
  Let $\dim U = 2$ and $u,v$ be some basis of $U$. Define in this basis
  $\psi\colon U\times U\to K$ as follows:
  \begin{gather*}
    \psi (u,v) = \psi (v,u) = 1,\\
    \psi (u,u) = \psi (v,v) = 0.
  \end{gather*}

  \[ \begin{pmatrix}
      0 & 1 \\
      1 & 0
    \end{pmatrix} \]

  The quadratic space $(U, \psi)$ is regular, but the subspaces $\left<u\right>$
  and $\left<v\right>$ are not regular, since $\psi$ restricted on them is
  identically zero.
\end{example}

\begin{definition}
  Let $(U,\psi)$ be a quadratic space. For a subspace $V \subseteq U$ the
  \term{orthogonal complement} (with respect to $\psi$) is defined to be

  \[ V^\perp \dfn \{ u\in U \mid \psi (u,v) = 0 \text{ for all } v\in V \}. \]
\end{definition}

\begin{proposition}
  If $(U,\psi)$ is regular, then $\dim V + \dim V^\perp = \dim U$.

  \begin{proof}
    Consider a basis $v_1, \ldots, v_m$ of $V$ and define a map
    \begin{align*}
      U & \to V,\\
      u & \mapsto (\psi (u,v_1), \ldots, \psi (u,v_m)).
    \end{align*}

    Since $\psi$ is regular, this is a surjection. The kernel is $V^\perp$.
  \end{proof}
\end{proposition}

It is not always the case that $V \cap V^\perp = \{ 0 \}$, however we always
have the following.

\begin{proposition}
  Assume $U$ is regular and $V$ is its subspace. Then $(V^\perp)^\perp = V$.

  \begin{proof}
    It is clear that $V \subseteq (V^\perp)^\perp$.

    On the other hand, we have
    \begin{align*}
      \dim V + \dim V^\perp & = \dim U,\\
      \dim V^\perp + \dim (V^\perp)^\perp & = \dim U.
    \end{align*}

    Thus $\dim V = \dim (V^\perp)^\perp$.
  \end{proof}
\end{proposition}

\begin{proposition}
  Assume $V$ is a regular subspace of $(U,\psi)$. Then $U = V \oplus V^\perp$.
\end{proposition}

\noindent (We do not assume that $U$ itself is regular.)

\begin{proof}
  Take $u\in U$ and consider the map
  \begin{align*}
    f\colon V & \to K,\\
    v & \mapsto \psi (u,v).
  \end{align*}

  Since $V$ is regular, there exists $w\in V$ such that $f (v) = \psi (w,v)$ for
  all $v \in V$.

  We have a decomposition $u = w + (u-w)$, and $u-w \in V^\perp$ since
  $\psi (u-w, v) = \psi (u,v) - \psi (w,v) = 0$ for all $v\in V$.
  So $U = V + V^\perp$.

  Since $V$ is regular, $V\cap V^\perp = \{ 0 \}$, and hence
  $U = V \oplus V^\perp$.
\end{proof}

\begin{proposition}
  Assume $U$ is regular and $V$ is its subspace. The following are equivalent:
  \begin{enumerate}
  \item $V$ is regular.

  \item $V \cap V^\perp = \{ 0 \}$.

  \item $V^\perp$ is regular.
  \end{enumerate}
\end{proposition}

\begin{definition}
  A basis $u_1, \ldots, u_n$ for $U$ is called \term{orthogonal} (with respect
  to $\psi$) if $\psi (u_i, u_j) = 0$ for $i \ne j$.
\end{definition}

\noindent (N.B. we do not talk about an ortho\emph{normal} basis, just
orthogonal.)

\begin{proposition}
  Every quadratic space admits an orthogonal basis.

  \begin{proof}
    If $\psi$ is identically zero, then any basis will do. If not, there is a
    vector $u_1$ such that $\phi (u_1) \ne 0$. Consider a subspace
    $V \dfn \left<u_1\right>$; it is regular, $U = V \oplus V^\perp$, and
    $\dim V^\perp < \dim U$. By induction on $\dim V^\perp$, the whole $U$
    admits an orthogonal basis $u_1, \ldots, u_n$.
  \end{proof}
\end{proposition}

If $(U,\psi)$ is a regular quadratic space and $u_1, \ldots, u_n$ is an
orthogonal basis, then $\phi (u_i) \ne 0$.

\subsection*{Isotropy}

\begin{definition}
  A nonzero vector $u$ such that $\psi (u,u) = 0$ is called \term{isotropic}
  (with respect to $\psi$).

  We say that a quadratic space $(U,\psi)$ is \term{isotropic} (or that $\psi$
  is isotropic) if there exists an isotropic vector $u\in U$.
\end{definition}

\begin{example}
  If $(U,\psi)$ is not regular, then it is isotropic.
\end{example}

In \refref{example}{example:hyperbolic-plane} we saw isotropic space with $\psi$
given by a matrix $\begin{pmatrix}
  0 & 1 \\
  1 & 0
\end{pmatrix}$, that is, in a basis $u,v$ we have
$\phi (x\,u + y\,v) = 2\,x\,y$. This space is called the \term{hyperbolic plane}
and it plays a special role:

\begin{proposition}
  Let $(U,\phi)$ be a regular isotropic space. Then $U = V \oplus V^\perp$ where
  $V$ is the hyperbolic plane.

  \begin{proof}
    Since $\psi$ is isotropic, there exists a nonzero vector $u \in U$ such that
    $\psi (u,u) = 0$. Since $\psi$ is regular, there exists $w$ such that
    $\psi (u,w) \ne 0$. We may assume $\psi (u,w) = 1$. Consider a vector
    $v = \lambda u + w$ where $\lambda \in K$.

    \[ \psi (u,v) = \psi (u, \lambda u + w) = \lambda \psi (u,u) + \psi (u,w) = 1. \]

    Now
    \[ \psi (v,v) = \psi (\lambda u + w, \lambda u + w) =
      \lambda^2 \underbrace{\psi (u,u)}_{=0} +
      2\,\lambda \underbrace{\psi (u, w)}_{=1} +
      \psi (w, w) = 2\,\lambda + \psi (w,w). \]

    So we take $\lambda = -\frac{1}{2} \, \psi (w,w)$ and now $\psi (v,v) = 0$
    (we use our usual assumption $\fchar K \ne 2$).

    Thus $V = \left<u,v\right>$ is the hyperbolic plane. Since $V$ is regular,
    $U = V \oplus V^\perp$.
  \end{proof}
\end{proposition}

\begin{definition}
  We call a quadratic space $(U,\psi)$ \term{universal} if for any
  $\alpha\in K^\times$ there exists $u\in U$ such that $\psi (u,u) = \alpha$.

  We say in this case that $\psi$ \term{represents} $\alpha$.
\end{definition}

\begin{example}
  For $K = \mathbb{R}$ it is well-known that any quadratic form is equivalent to
  \[ X_1^2 + \cdots + X_r^2 - (X_{r+1}^2 + \cdots + X_n^2). \]

  It is isotropic iff $0 < r < n$ and it is also universal iff $0 < r < n$.
  Is it always the case and being universal corresponds to being isotropic?
\end{example}

\begin{proposition}
  Any regular isotropic space is universal.

  \begin{proof}
    This follows from the fact that the hyperbolic plane is universal.
  \end{proof}
\end{proposition}

The converse is not true: in general universality does \emph{not} imply
isotropy.

\begin{theorem}
  Let $K$ be a finite field with $\fchar K \ne 2$. Then any regular quadratic
  space over $K$ of dimension $\ge 2$ is universal.

  \begin{proof}
    It is sufficient to consider $\dim U = 2$. Let $u,v$ be an orthogonal basis
    for $U$. We have
    \[ \phi (x\,u + y\,v) = x^2 \, \phi (u) + y^2 \, \phi (v). \]

    Here $\phi (u), \phi (v) \ne 0$.

    Now if $K = \FF_q$, then $K^\times$ is a cyclic group of order $q-1$, and
    the subgroup of squares in $K^\times$ has order
    \[ \# (\FF_q^\times)^2 = \frac{q-1}{2}. \]

    So there are totally $\frac{q+1}{2}$ squares in $\FF_q$, taking into account
    also $0$. We count the number of elements of the form $x^2 \, \phi (u)$:
    \[ \# \{ x^2 \, \phi (u) \mid x\in \FF_q \} = \frac{q+1}{2}. \]

    Now for some $\alpha \in \FF_q^\times$ count the elements of the form
    $\alpha - y^2 \, \phi (v)$:
    \[ \# \{ \alpha - y^2 \, \phi (v) \mid y \in \FF_q \} = \frac{q+1}{2}. \]

    The number of elements sum up to $q+1$, meaning that the sets are not
    disjoint. So there exist some $x, y\in \FF_q$ such that
    \[ x^2 \, \phi (u) = \alpha - y^2 \, \phi (v). \]

    Thus for any $\alpha \in \FF_q^\times$ we have
    $\alpha = x^2 \, \phi (u) + y^2 \, \phi (v) = \phi (x\,y + y\,v)$ for some
    $x,y \in \FF_q$.
  \end{proof}
\end{theorem}

On the other hand, not every two-dimensional space over a finite field is
isotropic. To see it consider $\beta \in \FF_q^\times$ which is not a
square. Fix an orthogonal basis $u,v$ with $\phi (u) = 1$ and
$\phi (v) = -\beta$; that is $\phi (X,Y) = X^2 - \beta\,Y^2$. Then
\[ \phi (x\,u + y\,v) = x^2 - \beta \, y^2 \ne 0 \quad \text{for } (x,y) \ne (0,0). \]

\begin{proposition}
  Let $\phi (X_1,\ldots,X_n)$ be a regular quadratic form over $K$ and
  $\alpha \in K^\times$. The following are equivalent:
  \begin{enumerate}
  \item $\phi$ represents $\alpha$.

  \item $\phi (X_1,\ldots,X_n) - \alpha \, Y^2$ is isotropic.
  \end{enumerate}

  \begin{proof}
    (1) implies (2) obviously without assumption that $\phi$ is regular.

    Now assume $\phi (\underline{X}) - \alpha \, Y^2$ is isotropic, meaning that
    there exist $(\underline{x}, y) \in K^{n+1}$ such that
    $\phi (\underline{x}) - \alpha \, y^2 = 0$.

    If $y \ne 0$, then
    $y^{-2}\,\phi (\underline{x}) = \phi (y^{-1}\,\underline{x}) = \alpha$.

    If $y = 0$, then $\underline{x} \ne 0$ and $\phi$ is isotropic (and
    regular), and thus universal.
  \end{proof}
\end{proposition}

\begin{corollary}
  Any quadratic form in $\ge 3$ variables over a finite field is isotropic.

  \begin{proof}
    We may assume that $\phi$ is diagonal and regular:
    $$\phi (X_1,X_2,X_3) = \alpha_1\,X_1^2 + \alpha_2\,X_2^2 + \alpha_3\,X_3^2,$$
    where $\alpha_1,\alpha_2,\alpha_3 \ne 0$.

    Now $\alpha_1\,X_1^2 + \alpha_2\,X_2^2$ is universal. In particular, it
    represents $-\alpha_3$.
  \end{proof}
\end{corollary}

\begin{proposition}\label{proposition:form-difference-isotropic}
  Let $f (\underline{X})$ and $g (\underline{Y})$ be regular quadratic forms
  over $K$. Suppose $f (\underline{X}) - g (\underline{Y})$ is isotropic. Then
  there exists $\alpha \in K^\times$ represented by both $f$ and $g$.

  \begin{proof}
    By assumption we have
    $(\underline{x},\underline{y}) \ne (\underline{0},\underline{0})$ such that
    $f (\underline{x}) = g (\underline{y}) = \beta$. Without loss of generality
    assume $\underline{x} \ne 0$. If $\beta \ne 0$, then we are done.

    If $\beta = 0$, then $f (\underline{x}) = 0$, so $f$ is isotropic, and thus
    universal, representing any element. We can take any element
    $\alpha \in K^\times$ represented by $g$.
  \end{proof}
\end{proposition}

\subsection*{Transforming orthogonal bases}

Here we will show a technical result that will be used later in
\refref{\S}{section:hasse-invariant}.

\begin{proposition}\label{proposition:transforming-orthogonal-bases}
  Let $(U,\phi)$ be a quadratic space with two orthogonal bases
  $\widetilde{u} = (u_1,\ldots,u_n)$ and
  $\widetilde{v} = (v_1,\ldots,v_n)$. There exists a sequence of orthogonal
  bases
  \[ \widetilde{u} = \widetilde{u}^{(0)},
    \widetilde{u}^{(1)},
    \widetilde{u}^{(2)},
    \ldots,
    \widetilde{u}^{(\ell)} = \widetilde{v}, \]
  where $\widetilde{u}^{(i)}$ and $\widetilde{u}^{(i+1)}$ differ by at most two
  vectors.

\begin{proof}
  For an induction step it is enough to transform
  $\widetilde{u} = (u_1,\ldots,u_n)$ into some basis of the form
  $(v_1, v_2^*, \ldots, v_n^*)$.

  Write $v_1 = \alpha_1 \, u_1 + \cdots + \alpha_n \, u_n$. Without loss of
  generality (after changing the order) we can assume
  $\alpha_1, \ldots, \alpha_s \ne 0$ and $\alpha_{s+1}, \ldots, \alpha_n = 0$,
  so that $v_1 = \alpha_1 \, u_1 + \cdots + \alpha_s \, u_s$. We should have
  $\underline{\alpha} \ne \underline{0}$.

  \begin{itemize}
  \item If $s = 1$, then $v_1 = \alpha_1\,u_1$, and we take
    $v_2^* = u_2, \ldots, v_n^* = u_n$.

  \item If $s \ge 2$ and $\phi (\alpha_1 \, u_1 + \alpha_2 \, u_2) \ne 0$,
    consider $u_1^\prime = \alpha_1 \, u_1 + \alpha_2 \, u_2$. Find $u_2^\prime$
    of the form $\beta_1 \, u_1 + \beta_2 \, u_2$ such that
    $\psi (u_1^\prime, u_2^\prime) = 0$.

    \begin{align*}
      \psi (u_1^\prime, u_2^\prime) & = \psi (\alpha_1\,u_1 + \alpha_2\,u_2, \, \beta_1\,u_1 + \beta_2\,u_2) \\
                                    & = \alpha_1\,\beta_1\,\psi (u_1,u_1) +
                                      \alpha_1\,\beta_2\,\underbrace{\psi (u_1,u_2)}_{= 0} +
                                      \alpha_2\,\beta_1\,\underbrace{\psi (u_2,u_1)}_{= 0} +
                                      \alpha_2\,\beta_2\,\psi (u_2,u_2) \\
                                    & = \alpha_1 \, \beta_1 \, \phi (u_1) + \alpha_2 \, \beta_2 \, \phi (u_2).
    \end{align*}

    So we take $\beta_1 = \alpha_2 \, \phi (u_2)$ and
    $\beta_2 = -\alpha_1 \, \phi (u_1)$. We have $(\beta_1, \beta_2) \ne (0,0)$
    since
    $\phi (\alpha_1\,u_1 + \alpha_2\,u_2) = \alpha_1^2 \, \phi (u_1) + \alpha_2^2 \, \phi (u_2) \ne 0$.

    Consider a new basis $u_1^\prime, u_2^\prime, u_3, \ldots, u_n$. We have
    $v_1 = u_1^\prime + \alpha_3 \, u_3 + \cdots + \alpha_s \, u_s$, a linear
    combination of $s-1$ vectors. So we reduced $s$ to $s-1$, and we can use
    induction.

  \item If $s \ge 2$ and $\phi (\alpha_1 \, u_1 + \alpha_2 \, u_2) = 0$, then it
    is not possible for $s = 2$ (since $v_1 = \alpha_1 \, u_1 + \alpha_2 \, u_2$
    is not isotropic), and we should have $s \ge 3$. Consider the following
    three vectors:

    \begin{gather*}
      \alpha_1 \, u_1 + \alpha_2 \, u_2,\\
      \alpha_1 \, u_1 + \alpha_3 \, u_3,\\
      \alpha_2 \, u_2 + \alpha_3 \, u_3.
    \end{gather*}

    We claim that at least one of them is not isotropic. Indeed, assume it is
    not the case. Then

    \begin{gather*}
      \alpha_1^2 \, \phi (u_1) + \alpha_2^2 \, \phi (u_2) = 0,\\
      \alpha_1^2 \, \phi (u_1) + \alpha_3^2 \, \phi (u_3) = 0,\\
      \alpha_2^2 \, \phi (u_2) + \alpha_3^2 \, \phi (u_3) = 0.
    \end{gather*}

    But this implies $\alpha_1^2 = \alpha_2^2 = \alpha_3^2 = 0$, contradicting
    $\underline{\alpha} \ne \underline{0}$. \qedhere
  \end{itemize}
\end{proof}
\end{proposition}

\subsection*{Witt's lemma}

\begin{definition}
  An \term{isometry} of quadratic spaces $(U_1,\phi_1)$ and $(U_2,\phi_2)$ is a
  linear map $\rho\colon U_1 \to U_2$ such that the following diagram commutes:
  \[ \xymatrix{
      U_1\ar[r]^\rho\ar[d]_{\phi_1} & U_2\ar[dl]^{\phi_2} \\
      K
    } \]

  If there is an invertible isometry $\rho\colon U_1\to U_2$, then we say that
  the quadratic spaces $(U_1,\phi_1)$ and $(U_2,\phi_2)$ are \term{isometric}
  and the corresponding quadratic forms $\phi_1$ and $\phi_2$ are
  \term{equivalent}.
\end{definition}

For equivalent quadratic forms the discriminant is the same: if
$\phi_1 \sim \phi_2$, then $\delta (\phi_1) = \delta (\phi_2)$ (as elements of
$K^\times/(K^\times)^2$). Obviously the dimension of isometric quadratic spaces
must be the same.

\vspace{1em}

We will need the following important result:

\begin{theorem}[Witt's lemma]\label{theorem:witt-lemma}
  Let $f_1 (X_1,\ldots,X_m)$, $f_2 (X_1,\ldots,X_m)$, $g_1 (Y_1,\ldots,Y_n)$,
  $g_2 (Y_1,\ldots,Y_n)$ be quadratic forms with $f_1$ and $f_2$ regular. Assume
  $f_1 (\underline{X}) \sim f_2 (\underline{X})$ and
  $f_1 (\underline{X}) + g_1 (\underline{Y}) \sim f_2 (\underline{X}) + g_2 (\underline{Y})$.
  Then $g_1 (\underline{Y}) \sim g_2 (\underline{Y})$.
\end{theorem}

This essentially says that one has the ``cancellation property''
$f + g_1 = f + g_2 \Rightarrow g_1 = g_2$ for equivalence classes of quadratic
forms. To prove this we need to discuss isometries of quadratic spaces.

\vspace{1em}

An isometry $(U,\phi)$ to itself is called an \term{autoisometry}. That is, it
is a map $\rho\colon U\to U$ such that $\phi\circ \rho = \phi$.

Suppose $(U,\phi)$ is regular. Then the autoisometries of $(U,\phi)$ are all
invertible and they form a subgroup of $\GL (U)$, denoted by $O_\phi (U)$.

\begin{proposition}
  For $\rho \in O_\phi (U)$ one has $\det \rho = \pm 1$.

  \begin{proof}
    Let $u_1, \ldots, u_n$ be a basis of $U$. Consider the matrix
    $S = (\psi (u_i, u_j))_{i,j}$. If $T$ is the matrix of $\rho$ in this basis,
    then the matrix of $\phi\circ \rho$ is given by ${}^t T \, S \, T = S$, and
    \[ \det ({}^t T \, S \, T) = (\det T)^2 \, \det S = \det S. \]
    Since $\det S \ne 0$, we conclude $\det T = \pm 1$.
  \end{proof}
\end{proposition}

Consider a subgroup of $O_\phi (U)$ given by

\[ O_\phi^+ (U) \dfn \{ \rho \in O_\phi (U) \mid \det \rho = +1 \}. \]

We have $[O_\phi (U) : O_\phi^+ (U)] = 2$. Indeed, the index is either $1$ or
$2$, and we can find an element $\rho \in O_\phi (U)$ with $\det \rho = -1$.
(As before, we assume $\fchar K \ne 2$, otherwise $+1 = -1$.)

\begin{example}
  Take $u$ such that $\phi (u) \ne 0$. We have
  $U = \left<u\right> + \left<u\right>^\perp$. Define a map
  \begin{align*}
    \rho_u\colon U & \to U,\\
    u & \mapsto -u,\\
    v & \mapsto 1 \quad\text{for } v \in \left<u\right>^\perp.
  \end{align*}

  We have $\det \rho_u = -1$.

  In general, the reflection through the hyperplane orthogonal to $u$ is given
  by
  $$\rho_u (v) = v - 2\,\frac{\psi (u,v)}{\psi (u,u)}\,u.$$
  (``Reflection'' is understood with respect to the bilinear form $\psi$.)

  In particular, if $\phi (u) = \phi (v)$ and $\phi (u-v) \ne 0$, then
  $$\rho_{u-v} (u) = v, \quad \rho_{u-v} (v) = u.$$

  Indeed, by the definition of reflection
  $$\rho_{u-v} (u) \dfn u - 2\,\frac{\psi (u-v,u)}{\psi (u-v,u-v)}\,(u-v).$$

  By bilinearity,
  $$\psi (u - v, u) = \psi (u,u) - \psi (v,u).$$

  By bilinearity together with the assumption $\phi (u) = \phi (v)$,
  $$\psi (u-v, u-v) = \psi (u,u) - 2\,\psi (v,u) + \psi (v,v) = 2\,(\psi (u,u) - \psi (v,u)),$$
  hence
  \[ \rho_{u-v} (u) \dfn u - 2\,\frac{\psi (u-v,u)}{\psi (u-v,u-v)}\,(u-v) = u - (u-v) = v. \qedhere \]
\end{example}

\begin{proposition}\label{proposition:rho-u-v}
  Suppose $u,v \in U$ are such that $\phi (u) = \phi (v) \ne 0$. Then there
  exists $\rho \in O_\phi (U)$ such that $\rho (u) = v$.

  \begin{proof}
    \begin{itemize}
    \item If $\phi (u-v) \ne 0$, then take a reflection $\rho_{u-v} (u) = v$.

    \item If $\phi (u+v) \ne 0$, then we have a reflection $\rho_{u+v} (u) = -v$
      and we take its composition with another reflection:
      $\rho_v \, \rho_{u+v} (u) = v$.

    \item We claim that both $\phi (u-v)$ and $\phi (u+v)$ cannot be zero under
      our assumptions. Indeed,
      \[ \phi (u+v) + \phi (u-v) = 2\,\phi(u) + 2\,\phi(v) = 4\,\phi (v) \ne 0. \qedhere \]
    \end{itemize}
  \end{proof}
\end{proposition}

If $\dim U > 1$, then in the proposition above we may actually take $\rho$ to be
a product of two reflections, so that $\rho \in O_\phi^+ (U)$. Indeed, in this
case there exists $w \perp u$ such that $\phi (w) \ne 0$, and
\begin{itemize}
\item $\rho_{u-v} \, \rho_w (u) = v$ if $\phi (u-v) \ne 0$---this is because
  $\rho_w (u) = u$, since we reflect $u$ with respect to the hyperplane
  orthogonal to $w$, but $u$ is in that hyperplane;

\item $\rho_v \, \phi_{u+v} (u) = v$ as before if $\phi (u+v) \ne 0$.
\end{itemize}

\begin{theorem}
  Assume $V_1, V_2 \subseteq U$ are two regular quadratic subspaces of $U$ and
  they are isometric via some $\rho\colon V_1 \to V_2$. Then this $\rho$ can be
  extended to an autoisometry of $U$.

  \begin{proof}
    Since $V_1$ is regular, there exists $v_1 \in V_1$ such that
    $\phi (v_1) \ne 0$. By \refref{proposition}{proposition:rho-u-v} there
    exists $\sigma \in O_\phi (U)$ such that $\sigma (\rho(v_1)) = v_1$. We may
    replace $V_2$ with $\sigma V_2$ and $\rho$ with $\sigma \rho$, so that
    $v_1 \in V_1 \cap V_2$ and $\rho (v_1) = v_1$.

    For $\dim V_1 = 1$ we are done. Otherwise we use induction on $\dim
    V_1$. Consider

    \[ U^\prime \dfn \left<v\right>^\perp, \quad
      V_1^\prime = U^\prime \cap V_1, \quad
      V_2^\prime = U^\prime \cap V_2. \]

    We have $\dim V_1^\prime = \dim V_1 - 1$ and
    $\dim V_2^\prime = \dim V_2 - 1$ and $\rho V_1^\prime = V_2^\prime$. By
    induction hypothesis, there is an autoisometry $\rho^\prime$ of $U^\prime$
    such that $\left.\rho^\prime\right|_{V_1} = \rho$. From this we can define
    an autoisometry on the whole $U$ by
    \begin{align*}
      \sigma\colon U & \to U,\\
      v & \mapsto v,\\
      u & \mapsto \rho^\prime (u) \quad \text{for } u\in U^\prime. \qedhere
    \end{align*}
  \end{proof}
\end{theorem}

\begin{corollary}
  Assume $U_1$ and $U_2$ are isometric quadratic spaces and $V_1 \subseteq U_1$,
  $V_2 \subseteq U_2$, with $V_1,V_2$ regular and isometric subspaces. Then
  $V_1^\perp$ is isometric to $V_2^\perp$.

  \begin{proof}
    By assumption there is an isometry $\rho\colon U_1\to U_2$ is an
    isometry. We can replace $U_1$ with $\rho U_1$ and $V_1$ with $\rho V_1$,
    and assume that $(U_1,\phi_1) = (U_2,\phi_2) = (U,\phi)$ is a single
    quadratic space and $V_1$ and $V_2$ are its regular subspaces isometric via
    some $\rho\colon V_1\to V_2$. Then we know by the previous theorem that the
    is an autoisometry $\sigma$ extending $\rho$. But then $\sigma V_1 = V_2$
    and $\sigma V_1^\perp = V_2^\perp$.
  \end{proof}
\end{corollary}

This corollary proves the Witt's lemma
(\refref{theorem}{theorem:witt-lemma}). Indeed, assume we have equivalent
quadratic forms
$$f_1 (X_1, \ldots, X_m) + g_1 (Y_1,\ldots,Y_n) \sim f_2 (X_1, \ldots, X_m) + g_2 (Y_1,\ldots,Y_n),$$
with $f_1$ and $f_2$ regular and equivalent. Consider a quadratic space $U_1$
having quadratic form $f_1 (\underline{X}) + g_1 (\underline{Y})$ and a
quadratic space $U_2$ having quadratic form
$f_2 (\underline{X}) + g_2 (\underline{Y})$. Then $f_1$ and $f_2$ correspond to
regular isometric subspaces $V_1 \subset U_1$ and $V_2 \subset U_2$. The
quadratic forms $g_1$ and $g_2$ correspond to subspaces $V_1^\perp$ and
$V_2^\perp$ that should be isometric as well. \qed

\section{Quadratic forms over $\QQ_p$}

\begin{proposition}\label{proposition:units-isotropic}
  Suppose $p > 2$ is a finite prime and $\phi$ is a regular quadratic form over
  $\QQ_p$.

  \begin{enumerate}
  \item Suppose the dimension is $\ge 3$. If $\phi$ has a diagonal form
    $$\phi = \alpha_1\,X_1^2 + \alpha_2\,X_2^2 + \alpha_3\,X_3 + \cdots$$
    with $\alpha_1, \alpha_2, \alpha_3$ being units (equivalently,
    $ \nu_p (\alpha_i) = 0$), then $\phi$ is isotropic.

  \item Any quadratic form over $\QQ_p$ of dimension $\ge 5$ is isotropic.
  \end{enumerate}
\end{proposition}

We note now that the first assertion is false for $p = 2$ (a counterexample will
follow, see p. \pageref{x2y2z2-anisotropic-over-q2}). The second assertion is
still true for $p = 2$, and we will see a proof of this later
(\refref{theorem}{theorem:dimension-isotropic}).

\begin{proof}
  \begin{enumerate}
  \item It is a typical application of Hensel. There exists
    $\underline{a} = (a_1,a_2,a_3)$ such that $\underline{a} \ne 0$ and
    $\phi (\underline{a}) \equiv 0 \pmod{p}$, because over $\FF_p$ any quadratic
    form of dimension $\ge 3$ is isotropic. Without loss of generality assume
    $a_1 \ne 0$. Then
    $\phi^\prime_{X_1} (\underline{a}) = 2\,a_1 \not\equiv 0 \pmod{p}$ (and here
    we use the assumption $p \ne 2$). Now by the Hensel's lemma
    (\refref{theorem}{theorem:multivariate-hensel}) there exists
    $\underline{b} \in \ZZ_p^3$ such that
    $\underline{b} \equiv \underline{a} \not \equiv 0 \pmod{p}$ and
    $\phi (\underline{b}) = 0$.

  \item We may assume $n = 5$ and that
    $\phi = \alpha_1\,X_1^2 + \cdots + \alpha_5\,X_5^2$. Also without loss of
    generality (by multiplying by $p^k$ and applying a variable change)
    $ \nu_p (\alpha_i) \in \{ 0,1 \}$. Thus $\phi = \phi_1 + p\,\phi_2$, where
    the coefficients of $\phi_1$ and $\phi_2$ are units. Now $\dim \phi_1 \ge 3$
    or $\dim \phi_2 \ge 3$, so we have isotropy by the previous proposition
    (that is why we ask that $p \ne 2$, but this restriction can be removed).
  \end{enumerate}
\end{proof}

\section{Hilbert symbol}

From now on $p$ denotes a prime, possibly $2$ or infinite.

\begin{definition}
  Let $\alpha,\beta \in \QQ_p^\times$. The \term{Hilbert symbol}
  $(\alpha,\beta)_p$ is defined as follows:
  \[ (\alpha,\beta)_p \dfn
    \left\{\begin{array}{ll}
             +1, & \alpha\,X^2 + \beta\,Y^2 - Z^2 \text{ is isotropic},\\
             -1, & \alpha\,X^2 + \beta\,Y^2 - Z^2 \text{ is anisotropic}.
           \end{array}\right. \]
\end{definition}

In the definition above ``$\alpha\,X^2 + \beta\,Y^2 - Z^2$ is isotropic'' can be
replaced with ``$Z^2 - \alpha\,X^2$ represents $\beta$''. Indeed, suppose
$\alpha\,x^2 + \beta\,y^2 - z^2 = 0$ for some $(x,y,z) \ne (0,0,0)$. If $y = 0$
then $Z^2 - \alpha\,X^2$ is isotropic, and thus universal, so it represents
$\beta$. If $y \ne 0$, then we get
$$(z/y)^2 - \alpha\,(x/y)^2 = \beta,$$
so the form $Z^2 - \alpha\,X^2$ indeed represents $\beta$.

\vspace{1em}

Here are some immediate properties of the Hilbert symbol:
\begin{enumerate}
\item $(\alpha,\beta)_p = (\beta,\alpha)_p$.

\item $(\alpha,-\alpha)_p = 1$ (for this observe that
  $\alpha\,X^2 - \alpha\,Y^2 - Z^2$ is isotropic; take $X = Y = 1$ and $Z = 0$).

\item $(\alpha, 1)_p = 1$ (since $\alpha\,X^2 + Y^2 - Z^2$ is isotropic; take
  $X = 0$, $Y = Z = 1$).

\item $(\alpha, \, \gamma^2 \beta)_p = (\alpha, \beta)_p$ (one can make a
  variable change $Y^\prime \dfn Y/\gamma$).

\item $(\alpha, \gamma^2)_p = (\alpha, 1)_p = 1$.
\end{enumerate}

There is one more equivalent definition of the Hilbert symbol:
\[ (\alpha,\beta)_p = 1 \iff \beta \text{ is a norm of some element in } \QQ_p (\sqrt{\alpha})/\QQ_p. \]

Indeed, if $\alpha \in (\QQ_p^\times)^2$, then this is trivial and the symbol
$(\alpha,\beta)_p$ is always $1$, just as for the definition above. Now if
$\alpha \notin (\QQ_p^\times)^2$, then for an arbitrary element
$z + x\,\sqrt{\alpha} \in \QQ_p (\alpha)^\times$ we compute its norm
\[ N_{\QQ_p (\sqrt{\alpha})/\QQ_p} (z + x\,\sqrt{\alpha}) = \det \begin{pmatrix}
    z & \alpha\,x \\
    x & z \\
\end{pmatrix} = z^2 - \alpha\,x^2. \]

So it is the same as asking $\beta$ to be represented by $Z^2 - \alpha\,X^2$
(even though the symmetry between $\alpha$ and $\beta$ becomes less evident this
way).

\begin{proposition}\label{proposition:hilb-multiplicativity-1}
  Hilbert symbol is multiplicative with respect to each variable:

  \begin{gather*}
    (\alpha_1 \alpha_2,\, \beta)_p = (\alpha_1, \beta)_p \cdot (\alpha_2, \beta)_p,\\
    (\alpha,\, \beta_1 \beta_2)_p = (\alpha, \beta_1)_p \cdot (\alpha, \beta_2)_p.
  \end{gather*}
\end{proposition}

We will first show the following.

\begin{proposition}\label{proposition:hilb-multiplicativity-2}
  Fix $\alpha$. Then $G_\alpha \dfn \{ \beta \mid (\alpha,\beta)_p = 1 \}$ is a
  subgroup of $\QQ_p^\times$ of index $1$ or $2$.
\end{proposition}

The \refref{proposition}{proposition:hilb-multiplicativity-1} follows easily
from the \refref{proposition}{proposition:hilb-multiplicativity-2}. Suppose
$G_\alpha$ is a group of index one or two. For $\beta_1, \beta_2 \in \QQ_p$ we
have the following three cases.

\begin{enumerate}
\item \underline{$\beta_1, \beta_2 \in G_\alpha$}. Then
  $(\alpha,\beta_1)_p \cdot (\alpha,\beta_2)_p = (\alpha,\, \beta_1 \beta_2)_p = 1$.

\item \underline{$\beta_1 \in G_\alpha$, $\beta_2 \notin G_\alpha$}. Then
  $(\alpha,\beta_1)_p = 1$ and
  $(\alpha,\beta_2)_p = (\alpha,\, \beta_1 \beta_2)_p = -1$.

\item \underline{$\beta_1, \beta_2 \notin G_\alpha$}. Then since
  $[\QQ_p^\times : G_\alpha] \le 2$, one must have
  $\beta_1\beta_2 \in G_\alpha$. So
  $(\alpha,\beta_1)_p = (\alpha,\beta_2)_p = -1$ and
  $(\alpha,\, \beta_1 \beta_2)_p = 1$. \qed
\end{enumerate}

\begin{proof}[Proof of the \refref{proposition}{proposition:hilb-multiplicativity-2}]
  If $\alpha \in (\QQ_p^\times)^2$ then $(\alpha,\beta)_p = 1$ for all
  $\beta \in \QQ_p^\times$, and we have nothing to prove (in this case
  $G_\alpha = \QQ_p^\times$).

  So we may assume $\alpha \notin (\QQ_p^\times)^2$, in which case
  $[\QQ_p (\sqrt{\alpha}) : \QQ_p] = 2$. The norm
  $N_{\QQ_p (\sqrt{\alpha}) / \QQ_p}$ is a homomorphism
  $\QQ_p (\sqrt{\alpha})^\times \to \QQ_p^\times$, so it is clear that its
  image, which is $G_\alpha$, is a subgroup in $\QQ_p^\times$. Our goal is to
  show that the index of this subgroup is $1$ or $2$.

  From the properties above we see that $(\QQ_p^\times)^2 \subseteq G_\alpha$,
  where $(\QQ_p^\times)^2$ is the group of squares in $\QQ_p^\times$. So the
  index $[\QQ_p^\times : G_\alpha]$ should divide the index
  $[\QQ_p^\times : (\QQ_p^\times)^2]$, and the latter is
  \begin{itemize}
  \item $2$ for $p = \infty$;
  \item $4$ for $2 < p < \infty$;
  \item $8$ for $p = 2$.
  \end{itemize}

  In case $p = \infty$ we are done. The index is
  \[ [\QQ_\infty^\times : G_\alpha] = \left\{\begin{array}{ll}
                                               1, & \text{if }\alpha > 0,\\
                                               2, & \text{if } \alpha < 0.
                                             \end{array}\right. \]

  Now for $2 < p < \infty$ we show that $[\QQ_p^\times : G_\alpha] = 2$. It is
  enough to find an element $\beta \in G_\alpha$ such that
  $\beta \notin (\QQ_p^\times)^2$ (which would prove
  $[\QQ_p^\times : G_\alpha] \ne 4$) and another $\beta \in \QQ_p^\times$ such
  that $\beta \notin G_\alpha$ (which would prove
  $[\QQ_p^\times : G_\alpha] \ne 1$).

  Since we consider $\alpha$ modulo squares, we may assume that
  $ \nu_p (\alpha) = 0 \text{ or } 1$.

  \begin{itemize}
  \item In case $ \nu_p (\alpha) = 0$ for each $\beta$ with $ \nu_p (\beta) = 0$
    the form $\alpha\,X^2 + \beta\,Y^2 - Z^2$ is isotropic (all coefficients are
    units), so $\ZZ_p^\times \subseteq G_\alpha$. Now for $\alpha$ being a unit
    also $-\alpha$ is a unit, so $-\alpha \in G_\alpha$. On the other hand,
    $-\alpha \notin (\QQ_p^\times)^2$.

    If $ \nu_p (\alpha) = 0$, then the form $\alpha\,X^2 + p\,Y^2 - Z^2$ is
    anisotropic. Indeed, otherwise $\alpha X^2 - Z^2$ would be isotropic modulo
    $p$, but $\alpha$ is not a square modulo $p$. Thus $p \notin G_\alpha$.

  \item If $ \nu_p (\alpha) = 1$, then $\alpha = p \eta$ for some unit
    $\eta$. Take a unit $\gamma \in \ZZ_p^\times$ which is not a square in
    $\ZZ_p^\times$. We claim that the form $p\,\eta\,X^2 + \gamma\,Y^2 - Z^2$ is
    anisotropic and so $\gamma \notin G_\alpha$. Indeed, if it is isotropic,
    then $\gamma\,Y^2 - Z^2$ is isotropic modulo $p$, but $\gamma$ is not a
    square.
  \end{itemize}

  So we conclude that $[\QQ_p^\times : G_\alpha] = 2$ for $2 < p < \infty$.

  Finally, for $p = 2$ a similar analysis gives $[\QQ_p^\times : G_\alpha] = 2$.
\end{proof}

Now we can write down the values of the Hilbert symbol $(\cdot,\cdot)_p$ for
various $p$. In case $p = \infty$ the form (over the field $\mathbb{R}$ of real
numbers) $\alpha X^2 + \beta Y^2 - Z^2$ is anisotropic iff $\alpha < 0$ and
$\beta < 0$, so
\[ (\alpha,\beta)_\infty =
  \left\{\begin{array}{ll}
           +1, & \alpha > 0 \text{ or } \beta > 0,\\
           -1, & \alpha < 0 \text{ and } \beta < 0.
         \end{array}\right. \]

We summarize it in the following table:

\[ \begin{array}{c|cc}
     \mathbb{R} & +1 & -1 \\
     \hline
     +1 & +1 & +1 \\
     -1 & +1 & -1
   \end{array} \]

Now assume $2 < p < \infty$. The subgroup of squares $(\QQ_p^\times)^2$ in
$\QQ_p^\times$ has four cosets represented by $1, \epsilon, p, p\,\epsilon$,
where $\epsilon$ is some nonsquare unit in $\ZZ_p^\times$.

\begin{itemize}
\item If both $\alpha$ and $\beta$ are units then $\alpha X^2 + \beta Y^2 - Z^2$
  is isotropic, so $(\alpha,\beta)_p = 1$.

\item If $\alpha$ is a unit then $(\alpha, p)_p = \legendre{\alpha}{p}$, the
  \term{Legendre symbol}
  \[ \legendre{\alpha}{p} \dfn
    \left\{\begin{array}{rll}
             +1, & \text{if } \alpha \text{ is a square} & \text{mod }p, \\
             0, & \text{if } \alpha\equiv 0 & \text{mod }p, \\
             -1, & \text{if } \alpha \text{ is not a square} & \text{mod }p.
           \end{array}\right. \]

  This is because $\alpha X^2 + p Y^2 - Z^2$ is isotropic \emph{iff}
  $\alpha X^2 - Z^2$ is isotropic modulo $p$.

\item $(p,p)_p = (p, -p)_p \cdot (p, -1)_p = (p, -1)_p = \legendre{-1}{p}$.

\item By multiplicativity
  $(p\epsilon, \epsilon)_p = (p,\epsilon)_p \cdot (\epsilon, \epsilon)_p =
  (p,\epsilon)_p = \legendre{\epsilon}{p} = -1$, since $\epsilon$ is a nonsquare
  in $\ZZ_p^\times$.

\item Similarly
  $(p, p\epsilon)_p = (p,\epsilon)_p \cdot (p,p)_p = \legendre{\epsilon}{p}
  \cdot \legendre{-1}{p} = \legendre{-\epsilon}{p} = - \legendre{-1}{p}$.

\item Finally,
  $(p\epsilon, p\epsilon)_p = (p\epsilon, p)_p \cdot (p\epsilon, \epsilon)_p =
  \legendre{-\epsilon}{p} \cdot \legendre{\epsilon}{p} = \legendre{-1}{p}$.
\end{itemize}

We summarize our computations in the following table.

\[ \begin{array}{c|cccc}
     \QQ_p & 1 & \epsilon & p & p\,\epsilon \\
     \hline
     1 & +1 & +1 & +1 & +1 \\
     \epsilon & +1 & +1 & -1 & -1 \\
     p & +1 & -1 & +\legendre{-1}{p} & -\legendre{-1}{p} \\
     p\,\epsilon & +1 & -1 & -\legendre{-1}{p} & +\legendre{-1}{p}
   \end{array} \]

Recall that
\[ \legendre{-1}{p} = (-1)^{\frac{p-1}{2}} =
  \left\{\begin{array}{ll}
           +1, & p \equiv 1\pmod{4},\\
           -1, & p \equiv 3\pmod{4}.
         \end{array}\right. \]

\vspace{1em}

A similar table can be constructed for $p = 2$. Recall that
$\ZZ_2^\times / (\ZZ_2^\times)^2$ can be identified with $(\ZZ/8\ZZ)^\times$,
which is represented by residues
$\{ \overline{1}, \overline{3}, \overline{5}, \overline{7} \}$ modulo $8$
(multiplicatively these form a group isomorphic to $C_2\times C_2$). The group
$\QQ_2^\times / (\QQ_2^\times)^2$ is represented by numbers
$\{ 1, 3, 5, 7, 2, 6, 10, 14 \}$. Investigating the values $(\alpha,\beta)_2$
for all $\alpha,\beta \in \{ 1, 3, 5, 7, 2, 6, 10, 14 \}$, one can obtain
\[ \begin{array}{r|rrrrrrrr}
     \QQ_2  & 1 &  3 &  5 &  7 &  2 &  6 & 10 & 14 \\
     \hline
     1 &  +1 &  +1 &  +1 &  +1 &  +1 &  +1 &  +1 &  +1 \\
     3 &  +1 &  -1 &  +1 &  -1 &  -1 &  +1 &  -1 &  +1 \\
     5 &  +1 &  +1 &  +1 &  +1 &  -1 &  -1 &  -1 &  -1 \\
     7 &  +1 &  -1 &  +1 &  -1 &  +1 &  -1 &  +1 &  -1 \\
     2 &  +1 &  -1 &  -1 &  +1 &  +1 &  -1 &  -1 &  +1 \\
     6 &  +1 &  +1 &  -1 &  -1 &  -1 &  -1 &  +1 &  +1 \\
     10 &  +1 &  -1 &  -1 &  +1 &  -1 &  +1 &  +1 &  -1 \\
     14 &  +1 &  +1 &  -1 &  -1 &  +1 &  +1 &  -1 &  -1 \\
   \end{array} \]
To understand how one can compile such a table, see below the
characterization of isotropic ternary forms over $\QQ_2$.

\vspace{1em}

One could start with defining the Hilbert symbol as a function on
$\QQ_p^\times / (\QQ_p^\times)^2$ given by such tables and prove all its
properties by routine verifications. However, it would not be very instructive.

\subsection*{Product formula}

Fix $\alpha,\beta \in \QQ^\times$. Observe that $(\alpha,\beta)_p = 1$ for all
but finitely many $p$ because if $p$ is odd and $\alpha,\beta \in \ZZ_p^\times$,
then $(\alpha,\beta)_p = 1$. So the product $\prod_p (\alpha,\beta)_p$ is
well-defined.

\begin{theorem}[Product formula]\label{theorem:hilbert-prod-formula}
  \[ \prod_{2 \le p \le \infty} (\alpha,\beta)_p = 1. \]
  In other words, $(\alpha,\beta)_p = -1$ for even number of $p$'s.
\end{theorem}

\begin{example}
  Consider $(5,14)_p$. One has
  \begin{align*}
    (6,14)_2 & = 1,\\
    (6,14)_3 & = (2,2)_3 \cdot (2,7)_3 \cdot (3,2)_3 \cdot (3,7)_3 = 1\cdot 1\cdot (-1)\cdot 1 = -1,\\
    (6,14)_5 & = 1,\\
    (6,14)_7 & = (2,2)_7 \cdot (2,7)_7 \cdot (3,2)_7 \cdot (3,7)_7 = 1\cdot 1\cdot 1\cdot (-1) = -1,\\
    (6,14)_{11} & = 1,\\
             & \cdots \\
    (6,14)_\infty & = 1. \qedhere
  \end{align*}
\end{example}

An analogue of this product formula is the product formula for valuations on a
global field $K$ (generalizing \refref{theorem}{theorem:product-formula-Q});
see p. \pageref{product-formula-K}.

First we derive a corollary from \refref{theorem}{theorem:hilbert-prod-formula}:

\begin{corollary}\label{corollary:even-num-of-p-such-that-isotropic}
  Let $\phi$ be a ternary quadratic form over $\QQ$. Then the set
  $$\{ p \mid \phi \text{ is anisotropic over } \QQ_p \}$$
  is finite and has even cardinality.

  \begin{proof}
    If $\phi$ is not regular, then $\phi$ is always isotropic.

    If $\phi$ is regular, then it has form
    $\gamma \, (\alpha\,X^2 + \beta\,Y^2 - Z^2)$, and the latter is anisotropic
    iff $(\alpha,\beta)_p = -1$.
  \end{proof}
\end{corollary}

\begin{proof}[Proof of \refref{theorem}{theorem:hilbert-prod-formula}]
  Since the Hilbert symbol $(\alpha,\beta)_p$ is multiplicative in both
  variables, we may consider only the following cases:
  \begin{itemize}
  \item $\alpha = -1$, $\beta = -1$,
  \item $\alpha = -1$, $\beta = 2$,
  \item $\alpha = -1$, $\beta = q$ an odd prime,
  \item $\alpha = 2$, $\beta = 2$,
  \item $\alpha = 2$, $\beta = q$,
  \item $\alpha = q$, $\beta = q$,
  \item $\alpha = q$, $\beta = q^\prime$ with $q \ne q^\prime$.
  \end{itemize}

  Since $(\alpha,\alpha)_p = (\alpha,-1)_p$, the cases $(2,2)_p$ and $(q,q)_p$
  reduce to the other ones.

  \begin{enumerate}
  \item Let \underline{$\alpha = -1$, $\beta = -1$}. For $2 < p < \infty$ we
    have $(-1,-1)_p = 1$. For $p = \infty$ we have $(-1,-1)_\infty = -1$.

    \label{x2y2z2-anisotropic-over-q2} Finally, to compute $(-1,-1)_2$, observe
    that the quadratic form $-X^2 - Y^2 - Z^2$ is anisotropic over
    $\QQ_2$. Indeed, if it is isotropic, then we have a nonzero triple
    $x,y,z \in \ZZ_2$ such that $x^2 + y^2 + z^2 = 0$. We may assume
    $\gcd (x,y,z) = 1$, so, say, $x$ and $y$ are odd and $z$ is even. But now
    $x^2 + y^2 + z^2 \equiv 2 \pmod{4}$, which is a contradiction.

    \[ \prod_{2 \le p \le \infty} (-1,-1)_p = (-1,-1)_\infty \cdot (-1,-1)_2 = 1. \]

    \vspace{1em}

    Now let us make a little deviation to see when in general quadratic forms
    over $\QQ_2$ are isotropic. We just seen that $X^2 + Y^2 + Z^2$ is
    anisotropic over $\QQ_2$, which shows that the first assertion of
    \refref{proposition}{proposition:units-isotropic} is wrong for $p = 2$.

    \vspace{1em}

    \label{isotropic-over-Q2}
    Let $\phi = \alpha X^2 + \beta Y^2 + \gamma Z^2$ be a quadratic form. We may
    assume $\nu_2 (\alpha), \nu_2 (\beta), \nu_2 (\gamma) \in \{ 0,1 \}$. We
    have two cases: either $\alpha,\beta,\gamma \in \ZZ_2^\times$ or
    $\alpha,\beta \in \ZZ_2^\times$, $\gamma \in 2 \ZZ_2^\times$.

    \begin{itemize}
    \item If \underline{$\alpha,\beta,\gamma$ are all units}, then assume there
      is $(x,y,z) \in \ZZ^3_2$, $(x,y,z) \ne \underline{0}$ such that
      $\alpha x^2 + \beta y^2 + \gamma z^2 = 0$. Two of $x,y,z$ are odd and one
      is even, e.g. $x$ and $y$ are odd and $z$ is even. Then
      $\alpha + \beta \equiv 0 \pmod{4}$. Similarly for the other combinations
      $x,z$ and $y,z$, we get

      \[ \phi \text{ isotropic} \iff
        \left\{\begin{array}{c}
                 \alpha + \beta \equiv 0 \pmod{4} \\
                 \text{or} \\
                 \alpha + \gamma \equiv 0 \pmod{4} \\
                 \text{or} \\
                 \beta + \gamma \equiv 0 \pmod{4}
               \end{array}\right\} \]

    We would like to show the opposite implication ``$\Leftarrow$''. Assume,
    say, $\alpha + \beta \equiv 0 \pmod{4}$. Then either
    $\alpha + \beta \equiv 0 \pmod{8}$ or $\alpha + \beta \equiv 4 \pmod{8}$.

    If $\alpha + \beta \equiv 0 \pmod{8}$, take $x_0 = 1, y_0 = 1, z_0 = 0$. We
    have $\phi (x_0,y_0,z_0) \equiv 0 \pmod{8}$ and
    $\phi^\prime_X (x_0,y_0,z_0) \not\equiv 0 \pmod{4}$. So the Hensel's lemma
    (\refref{theorem}{theorem:multivariate-hensel}) provides us the desired
    $(x,y,z)$, and $\phi$ is isotropic.

    If $\alpha + \beta \equiv 4 \pmod{8}$, then similarly we can take
    $x_0 = 1, y_0 = 1, z_0 = 2$.

  \item Suppose \underline{$\alpha$ and $\beta$ are units and
      $\gamma \in 2 \ZZ_2^\times$}. By an argument similar to the one above we
    can show that

    \[ \phi \text{ isotropic} \iff
      \left\{\begin{array}{c}
               \alpha + \beta \equiv 0 \pmod{8} \\
               \text{or} \\
               \alpha + \beta + \gamma \equiv 0 \pmod{8}
             \end{array}\right\} \]
  \end{itemize}

  \item Let \underline{$\alpha = -1$, $\beta = 2$}.

    We compute $(-1,2)_\infty = 1$ and $(-1,2)_p = 1$ for $2 < p \le \infty$
    since $-X^2 + 2 Y^2 - Z^2$ is isotropic (has units as its coefficients). On
    the other hand, $-X^2 + 2 Y^2 - Z^2$ is also isotropic over $\QQ_2$. So
    $(-1,2)_p = 1$ for each prime $p$, and the product formula holds.

  \item Let \underline{$\alpha = -1$, $\beta = q$ an odd prime}.

    The form $-X^2 + q Y^2 - Z^2$ is isotropic for $2 < p < \infty$ and
    $p \ne q$, so $(-1,q)_p = 1$. For $p = q$ the form is isotropic iff
    $X^2 + Z^2$ is isotropic modulo $q$, which happens whenever $-1$ is a square
    modulo $q$. So $(-1,q)_q = \legendre{-1}{q}$.

    Over $\mathbb{R}$ the form $-X^2 + q Y^2 - Z^2$ is isotropic, and over
    $\QQ_2$ it is isotropic iff $q \equiv 1 \pmod{4}$, so
    $(-1,q)_2 = \legendre{-1}{q}$. Finally we have

    \[ \prod_p (-1,q)_p = \legendre{-1}{q} \cdot \legendre{-1}{q} = 1. \]

    The case \underline{$\alpha = 2$, $\beta = q$} can be checked similarly.

  \item Let \underline{$\alpha = q$, $\beta = q^\prime$ with $q \ne q^\prime$}.

    Consider the form $q\,X^2 + q^\prime\,Y^2 - Z^2$. It is isotropic over
    $\mathbb{R}$, and it is also isotropic over $\QQ_p$ whenever
    $p \ne q, q^\prime$ and $2 < p < \infty$.

    Now, as we seen above, $q\,X^2 + q^\prime\,Y^2 - Z^2$ is isotropic over
    $\QQ_2$ iff
    \[ q+q^\prime \equiv 0 \pmod{4} \quad\text{or}\quad q - 1 \equiv 0 \pmod{4}
      \quad\text{or}\quad q^\prime - 1 \equiv 0 \pmod{4}. \]

    The first congruence is not the case for $q$ and $q^\prime$ being distinct
    primes; so $q\,X^2 + q^\prime\,Y^2 - Z^2$ is isotropic over $\QQ_2$ iff $q$
    or $q^\prime$ is $1$ modulo $4$, giving
    \[ (q,q^\prime)_2 = (-1)^{\frac{q-1}{2} \, \frac{q^\prime - 1}{2}}. \]

    Further, $q\,X^2 + q^\prime\,Y^2 - Z^2$ is isotropic over $\QQ_q$ if
    $q^\prime\,Y^2 - Z^2$ is isotropic over $\FF_q$, so
    \[ (q,q^\prime)_q = \legendre{q^\prime}{q}, \quad (q,q^\prime)_{q^\prime} = \legendre{q}{q^\prime}. \]

    Finally the product formula becomes
    \[ \prod_{2 \le p \le \infty} (q,q^\prime)_p =
      (-1)^{\frac{q-1}{2} \, \frac{q^\prime-1}{2}} \, \legendre{q^\prime}{q} \cdot \legendre{q}{q^\prime}. \]
    The latter expression is $1$ by the
    \term{quadratic reciprocity law}. \qedhere
  \end{enumerate}
\end{proof}

The most interesting case in the proof above is of $(q,q^\prime)_p$ with
$q \ne q^\prime$, and we see that the product formula for the Hilbert symbol is
equivalent in a certain sense to the quadratic reciprocity law.

\section{Hasse invariant}
\label{section:hasse-invariant}

Let $\phi$ be a regular quadratic form over $\QQ_p$. We know two of its
invariants: the dimension $\dim \phi$ (the number of variables) and the
discriminant $\delta (\phi) \in \QQ_p^\times / (\QQ_p^\times)^2$. We are going
to define the third invariant of $\phi$.

Write $\phi$ in a diagonal form
\[ \phi = \alpha_1\,X_1^2 + \alpha_2\,X_2^2 + \cdots + \alpha_n\,X_n^2. \]

Define the \term{Hasse invariant} of $\phi$ to be
\[ c(\phi) \dfn \prod_{1\le i < j \le n} (\alpha_i,\alpha_j)_p. \]

We claim that it is indeed an invariant.

\begin{theorem}\label{theorem:hasse-is-invariant}
  $c (\phi)$ does not depend on diagonalization of $\phi$.
\end{theorem}

Further, the Hasse invariant reflects the property of a quadratic form to be
isotropic.

\begin{theorem}\label{theorem:dimension-isotropic}
  Let $p$ be a finite prime (possibly $2$). Let $\phi$ be a regular quadratic
  form over $\QQ_p$ in $n$ variables.

  \begin{enumerate}
  \item If $n = 2$, then $\phi$ is isotropic iff $\delta (\phi) = -1$ in
    $\QQ_p^\times / (\QQ_p^\times)^2$, i.e. whenever $-\delta (\phi)$ is a
    square.

  \item If $n = 3$, then $\phi$ is isotropic iff
    $c (\phi) = (-1, -\delta (\phi))_p$.

  \item If $n = 4$, then $\phi$ is anisotropic iff $c (\phi) = (-1,-1)_p$ and
    $\delta (\phi) \in (\QQ_p^\times)^2$, i.e. is a square.

  \item If $n \ge 5$, then $\phi$ is always isotropic.
  \end{enumerate}
\end{theorem}

Finally, we will not prove it in these notes, but it is true that $\dim \phi$,
$\delta (\phi)$, and $c (\phi)$ together give a full system of invariants for
quadratic forms over $\QQ_p$ with $p$ being a finite prime.

\begin{lemma}\label{lemma:discr-of-isotropic-binary-form}
  Let $\phi$ be a regular binary form. Then $\phi$ is isotropic iff
  $\delta (\phi) = -1$ in $K^\times / (K^\times)^2$.

  \begin{proof}
    We may consider $\phi = \alpha\,X^2 + \beta\,Y^2$. Then
    $\delta (\phi) = \alpha\,\beta$. Now $\phi$ is isotropic iff $\alpha\,\phi$
    is isotropic, and $\alpha\,\phi$ is equivalent to
    $X^2 + \delta (\phi) \, Y^2$. The latter is isotropic iff $-\delta (\phi)$
    is a square.
  \end{proof}
\end{lemma}

\begin{lemma}\label{lemma:binary-hasse}
  Let $\phi$ be a binary form over $\QQ_p$. Then there exists
  $\epsilon = \epsilon (\phi) \in \{ \pm 1 \}$ such that

  \[ \beta \in \QQ_p^\times\text{ is represented by }\phi \iff (\beta, -\delta(\phi))_p = \epsilon. \]

  \begin{proof}
    We may assume that $\phi = \alpha_1\,X_1^2 + \alpha_2\,X_2^2$ is in diagonal
    form. Now $\beta$ is represented by $\phi$ iff $\phi - \beta Y^2$ is
    isotropic, which is the same as
    $\frac{\alpha_1}{\beta}\,X_1^2 + \frac{\alpha_2}{\beta}\,X_2^2 - Y^2$ being
    isotropic. We compute the corresponding Hilbert symbol:
    \[ \left(\frac{\alpha_1}{\beta}, \frac{\alpha_2}{\beta}\right)_p =
      \left(\alpha_1, \alpha_2\right)_p \cdot
      \left(\alpha_1, \frac{1}{\beta}\right)_p \cdot
      \left(\frac{1}{\beta}, \alpha_2\right)_p \cdot
      \left(\frac{1}{\beta}, \frac{1}{\beta}\right)_p. \]

    Since $(\beta, \gamma)_p \cdot (1/\beta, \gamma)_p = (1,\gamma)_p = 1$, we
    can replace $1/\beta$ with $\beta$:

    \[ \left(\frac{\alpha_1}{\beta}, \frac{\alpha_2}{\beta}\right)_p =
      \left(\alpha_1, \alpha_2\right)_p \cdot
      \left(\alpha_1, \beta\right)_p \cdot
      \left(\beta, \alpha_2\right)_p \cdot
      \left(\beta, \beta\right)_p. \]

    Now observing that
    $\left(\beta, \beta\right)_p = (\beta,-\beta)_p \cdot (\beta, -1)_p =
    \left(\beta, -1\right)_p$, we get

    \[ \left(\frac{\alpha_1}{\beta}, \frac{\alpha_2}{\beta}\right)_p =
      (\alpha_1, \alpha_2)_p \cdot (\beta, -\alpha_1\,\alpha_2)_p =
      (\alpha_1, \alpha_2)_p \cdot (\beta, -\delta (\phi))_p. \]

    So we see that $\beta$ is represented by $\phi$ iff
    $(\beta,-\delta(\phi))_p = (\alpha_1,\alpha_2)_p$.
  \end{proof}
\end{lemma}

\begin{itemize}
\item From the proof we see that $(\alpha_1,\alpha_2)_p$ is the same for any
  diagonalization of $\phi$. In particular, $c (\phi)$ is well-defined for
  binary forms.

\item The proof shows that the number $\epsilon$ in the lemma is actually
  $c (\phi)$.
\end{itemize}

\begin{proof}[Now we are ready to prove \refref{theorem}{theorem:hasse-is-invariant}]
  We have to show that if two forms
  $f \dfn \alpha_1\,X_1^2 + \cdots + \alpha_n\,X_n^2$ and
  $g \dfn \beta_1\,X_1^2 + \cdots + \beta_n\,X_n^2$ are equivalent, then
  \[ \prod_{i < j} (\alpha_i, \alpha_j)_p = \prod_{i < j} (\beta_i,\beta_j)_p. \]

  We may assume that $\alpha_i = \beta_i$ for all $i$, with at most two
  exceptions
  (cf. \refref{proposition}{proposition:transforming-orthogonal-bases}):

  \begin{align*}
    f & = \alpha_1\,X_1^2 + \alpha_2\,X_2^2 + \alpha_3\,X_3^2 + \cdots + \alpha_n\,X_n^2,\\
    g & = \beta_1\,X_1^2 + \beta_2\,X_2^2 + \alpha_3\,X_3^2 + \cdots + \alpha_n\,X_n^2.
  \end{align*}

  By Witt's lemma (\refref{theorem}{theorem:witt-lemma}), if $f \sim g$, then
  $\alpha_1\,X_1^2 + \alpha_2\,X_2^2 \sim \beta_1\,X_1^2 + \beta_2\,X_2^2$, and
  so from the proof of \refref{lemma}{lemma:binary-hasse} we know that
  $(\alpha_1,\alpha_2)_p = (\beta_1,\beta_2)_p$. Moreover,
  $\alpha_1\,\alpha_2 = \beta_1\,\beta_2$ modulo squares $(\QQ_p^\times)^2$.

  \[ \prod_{i < j} (\alpha_i,\alpha_j)_p =
    (\beta_1,\beta_2)_p \cdot
    \prod_{j\ge 3} (\alpha_1\alpha_2, \alpha_j)_p \cdot
    \prod_{3 \le i < j \le n} (\alpha_i,\alpha_j)_p =
    (\beta_1,\beta_2)_p \cdot
    \prod_{j\ge 3} (\beta_1\beta_2, \beta_j)_p \cdot
    \prod_{3 \le i < j \le n} (\beta_i,\beta_j)_p =
    \prod_{i < j} (\beta_i,\beta_j)_p. \qedhere \]
\end{proof}

So the Hasse invariant is indeed an invariant of a quadratic form.

\begin{lemma}
  Let $f (\underline{X}) = f (X_1,\ldots,X_m)$ and
  $g (\underline{Y})= g (Y_1,\ldots,Y_n)$ be two quadratic forms. Then for their
  sum $f (\underline{X}) + g (\underline{Y})$ (as a quadratic form in
  $X_1,\ldots,X_m,Y_1,\ldots,Y_n$) holds

  \begin{align*}
    \dim (f + g) & = \dim f + \dim g,\\
    \delta (f + g) & = \delta (f) \cdot \delta (g),\\
    c (f + g) & = c(f) \cdot c(g) \cdot (\delta (f), \delta (g))_p.
  \end{align*}

  \begin{proof}
    Only the last assertion is not completely obvious. Suppose the forms are in
    diagonal form $\alpha_1\,X_1^2 + \cdots + \alpha_m\,X_m^2$ and
    $\beta_1\,Y_1^2 + \cdots + \beta_n\,Y_n^2$. Then
    \[ c (f + g) =
      \prod_{1 \le i < j \le m} (\alpha_i, \alpha_j)_p \cdot
      \prod_{1 \le i < j \le n} (\beta_i, \beta_j)_p \cdot
      \prod_{\substack{1 \le i \le m \\ 1 \le j \le n}} (\alpha_i, \beta_j)_p =
      c (f) \cdot c (g) \cdot (\delta (f), \delta (g))_p. \qedhere \]
  \end{proof}
\end{lemma}

Now we go back to \refref{theorem}{theorem:dimension-isotropic}. We assume that
$p$ is a finite prime.

\begin{enumerate}
\item \emph{Let $\phi$ be a binary regular quadratic form. $\phi$ is isotropic
    iff $\delta (\phi) = -1$ in $\QQ_p^\times / (\QQ_p^\times)^2$.}

  We have seen this in \refref{lemma}{lemma:discr-of-isotropic-binary-form}.

\item \emph{Let $\phi$ be a ternary regular quadratic form. $\phi$ is isotropic
    iff $c (\phi) = (-1, -\delta (\phi))_p$.}

  We may assume that $\phi = \alpha_1\,X_1^2 + \alpha_2\,X_2^2 +
  \alpha_3\,X^3$. Now it is isotropic iff
  $\frac{\alpha_1}{-\alpha_3}\,X_1^2 + \frac{\alpha_2}{-\alpha_3}\,X_2^2 -
  X_3^2$ is isotropic. The corresponding Hilbert symbol is
  $\left(\frac{\alpha_1}{-\alpha_3}, \frac{\alpha_2}{-\alpha_3}\right)_p$, and
  the Hasse invariant is
  \[ c(\phi) =
    \left(\frac{\alpha_1}{-\alpha_3}, \frac{\alpha_2}{-\alpha_3}\right)_p \cdot
    \underbrace{\left(\frac{\alpha_1}{-\alpha_3}, -1\right)_p \cdot \left(\frac{\alpha_2}{-\alpha_3}, -1\right)_p} =
    \left(\frac{\alpha_1}{-\alpha_3}, \frac{\alpha_2}{-\alpha_3}\right)_p \cdot
    (-\delta(\phi), -1)_p. \]

\item \emph{Let $\phi$ be a quaternary regular form. $\phi$ is anisotropic iff
    $c (\phi) = -(-1,-1)_p$ and $\delta (\phi) \in (\QQ_p^\times)^2$.}

  We use the following nice trick: write $\phi = f (X_1,X_2) - g (Y_1,Y_2)$ for
  two binary forms $f (X_1,X_2) \dfn \alpha_1\,X_1^2 + \alpha_2\,X_2^2$ and
  $g (Y_1,Y_2) \dfn \beta_1\,Y_1^2 + \beta_2\,Y_2^2$.

  We want $\phi$ to be anisotropic, so this amounts to asking that $f$ and $g$
  are both anisotropic, and they do not represent simultaneously some
  $\gamma \in \QQ_p^\times$. By the previous points, this amounts to requiring
  that
  \begin{itemize}
  \item $-\alpha_1\alpha_2 \notin (\QQ_p^\times)^2$ and
    $-\beta_1\beta_2 \notin (\QQ_p^\times)^2$
    (\refref{lemma}{lemma:discr-of-isotropic-binary-form});

  \item rhere is no $\gamma \in \QQ_p^\times$ such that both
    \begin{gather*}
      \tag{*} c(f) = (\alpha_1,\alpha_2)_p = (\gamma, -\alpha_1\alpha_2)_p,\\
      \tag{**} c (g) = (\beta_1,\beta_2)_p = (\gamma, -\beta_1\beta_2)_p.
    \end{gather*}
    are satisfied (\refref{lemma}{lemma:binary-hasse}).
  \end{itemize}
  Since $-\alpha_1\alpha_2$ and $-\beta_1\beta_2$ are nonsquares, the symbols
  $(\gamma, -\alpha_1\alpha_2)_p$ and $(\gamma, -\beta_1\beta_2)_p$ are not
  identically $1$ as functions of $\gamma$. Precisely, for half of the classes
  of $\gamma \in \QQ_p^\times / (\QQ_p^\times)^2$ each symbol gives $+1$, and
  for the other half it gives $-1$. Thus these halves must be disjoint for (*)
  and (**). This is equivalent to
  \begin{gather*}
    \alpha_1\,\alpha_2 = \beta_1\,\beta_2 \pmod{(\QQ_p^\times)^2},\\
    (\alpha_1,\alpha_2)_p = -(\beta_1,\beta_2)_p.
  \end{gather*}

  These two conditions can be written as
  \begin{gather*}
    \delta (\phi) = \alpha_1\,\alpha_2\,\beta_1\,\beta_2 \in (\QQ_p^\times)^2,\\
    c (\phi) = -(-1,-1)_p.
  \end{gather*}

  The second identity is derived from multiplicativity of the Hilbert symbol:
  \begin{align*}
    c (\phi) & = (\alpha_1, \alpha_2)_p \cdot (-\beta_1, -\beta_2)_p \cdot
               \underbrace{(\alpha_1\alpha_2, \beta_1\beta_2)_p}_{= (\beta_1\beta_2, \beta_1\beta_2)_p} \\
             & = \underbrace{(\alpha_1, \alpha_2)_p \cdot (\beta_1,\beta_2)_p}_{-1} \cdot
               (\beta_1, -1)_p\cdot (-1, -\beta_2)_p \cdot (\beta_1\beta_2, \beta_1\beta_2)_p \\
             & = -(-1, -\beta_1\beta_2)_p \cdot (\beta_1\beta_2, \beta_1\beta_2)_p \\
             & = -(-1, \beta_1\beta_2)_p \cdot (-1, -1)_p \cdot (\beta_1\beta_2, \beta_1\beta_2)_p \\
             & = -(-\beta_1\beta_2, \beta_1\beta_2)_p \cdot (-1, -1)_p = -(-1, -1)_p.
  \end{align*}

  \begin{corollary}
    A regular ternary form represents all classes in
    $\QQ_p^\times / (\QQ_p^\times)^2$, except for perhaps one.

    \begin{proof}
      Let $\phi (X_1,X_2,X_3)$ be a ternary form. It does not represent some
      $\alpha \in \QQ_p^\times$ iff $\phi (X_1,X_2,X_3) - \alpha\,Y^2$ is
      anisotropic. The latter requires that
      $\delta (\phi - \alpha\,Y^2) = -\alpha\,\delta (\phi)$ is a square. So the
      only class in $\QQ_p^\times / (\QQ_p^\times)^2$ that is probably not
      represented is the inverse of $-\delta (\phi)$.
    \end{proof}
\end{corollary}

\item \emph{If $n \ge 5$, then a regular quadratic form $\phi (X_1,\ldots,X_n)$
    is always isotropic.}

  It is enough to consider the case $n = 5$. Write
  $\phi = f (X_1,X_2,X_3) - g (Y_1,Y_2)$ where $f (X_1,X_2,X_3)$ is a ternary
  form and $g (Y_1,Y_2)$ is a binary form. We know from the last corollary that
  $f$ represents all classes modulo squares, except for perhaps one.
  $g = \gamma \, (Y_1^2 - \alpha\,Y_2^2)$ represents at least half of the
  classes. If $p < \infty$, then there are at most four classes in
  $\QQ_p^\times / (\QQ_p^\times)^2$, so there must be some $\beta$ which is
  represented by both $f$ and $g$.
\end{enumerate}

\section{Geometry of numbers}

\begin{proposition}[Blichfeld's lemma]
  Let $S \subset \mathbb{R}^n$ be a set of Lebesgue measure $\mu (S) > 1$. Then
  there exist two distinct points $\underline{x}, \underline{y} \in S$ such that
  $\underline{x} \equiv \underline{y} \pmod{\ZZ^n}$.

  \begin{proof}
    Consider the ``reduction modulo $\ZZ^n$''. Namely, for each point
    $\underline{x} \in \mathbb{R}^n$ denote by
    $\lfloor\underline{x}\rfloor \in \ZZ^n$ its integral part
    $(\lfloor x_1\rfloor, \lfloor x_2\rfloor, \ldots, \lfloor x_n\rfloor)$. Then
    define a reduction map by
    \begin{align*}
      f\colon S & \to [0,1)^n,\\
      \underline{x} & \mapsto \underline{x} - \lfloor \underline{x} \rfloor.
    \end{align*}

    Since $\mu (S) > 1$ and $\mu ([0,1)^n) = 1$, there exist two points
    $\underline{x}, \underline{y} \in S$ such that
    $f (\underline{x}) = f (\underline{y})$.
  \end{proof}
\end{proposition}

\begin{center}
  \includegraphics{blichfeld.mps}
\end{center}

\begin{definition}
  A subset $S \subseteq \mathbb{R}^n$ is called \term{convex} if for each two
  points $\underline{x}, \underline{y} \in S$ the interval between
  $\underline{x}$ and $\underline{y}$ lies in $S$, that is,
  \[ (1-t) \, \underline{x} + t\,\underline{y} \in S \quad \text{for all }t\in [0,1]. \]

  $S$ is \term{symmetric} if for each point $\underline{x} \in S$ also
  $-\underline{x} \in S$.
\end{definition}

\begin{theorem}[Minkowski]
  Let $S \subseteq \mathbb{R}^n$ be a convex symmetric set of Lebesgue measure
  $\mu (S) > 2^n$. Then there exists a nonzero integral point
  $\underline{x} \in S \cap \ZZ^n$.

  \begin{proof}
    Consider the set $\frac{1}{2} S$. We have
    \[ \mu (T) = \frac{1}{2^n} \mu (S) > 1. \]

    By Blichfeld's lemma, there exist two distinct points
    $\underline{y}, \underline{z} \in T$ such that
    $\underline{y} \equiv \underline{z} \pmod{\ZZ^n}$. So
    $\underline{y} - \underline{z} = \underline{x}$ for some
    $\underline{x} \in \ZZ^n\setminus \{ \underline{0} \}$. We claim that
    $\underline{x} \in S$.

    Since $\underline{y} \in \frac{1}{2} S$, there exists
    $\underline{y^\prime} \in S$ such that
    $\underline{y} = \frac{1}{2} \underline{y^\prime}$. Similarly, also taking
    into account that $S$ is symmetric,
    $-\underline{z} = \frac{1}{2} \underline{z^\prime}$ for some
    $\underline{z^\prime} \in S$. By convexity
    \[ \underline{x} = \frac{1}{2} \underline{y^\prime} + \frac{1}{2} \underline{z^\prime} \in S. \qedhere \]
  \end{proof}
\end{theorem}

In the theorem above $2^n$ cannot be improved. To see this one can just take
$S = (-1,1)^n$, which has $\underline{0}$ as the only integral point and
$\mu (S) = 2^n$.

If $S$ is assumed to be closed, then a nonstrict inequality $\ge 2^n$ is
sufficient. For this consider the sets $S_\epsilon \dfn (1-\epsilon) \, S$. We
have $\mu (S_\epsilon) = (1+\epsilon)^n \, \mu (S) > 2^n$. Now for each
$\epsilon > 0$ there exists $\underline{x}_\epsilon \ne \underline{0}$ such that
$\underline{x}_\epsilon \in S_\epsilon \cap \ZZ^n$. Among such
$\underline{x}_\epsilon$ there is $\underline{x} \ne \underline{0}$ that belongs
to all $S_\epsilon$, and so
$\underline{x} \in \bigcap_{\epsilon > 0} S_\epsilon$, and the latter
intersection is $S$, by assumed compactness.

\vspace{1em}

Now we will derive some corollaries from the Minkowski theorem.

\begin{corollary}\label{corollary:linear-congruences}
  Let $L_1,\ldots,L_n$ be a system of linear forms on $\mathbb{R}^n$. Let
  $c_1,\ldots,c_n \in \mathbb{R}_{> 0}$. Assume that
  $|\det (L_1,\ldots,L_n)| < c_1 \cdots c_n$. Then there exists a nonzero
  integral point $\underline{x} \in \ZZ^n \setminus \{ \underline{0} \}$ such
  that $|L_i (\underline{x})| < c_i$ for $i = 1,\ldots,n$.

  \begin{proof}
    We apply Minkowski's theorem to a convex set
    \[ S \dfn \{ \underline{x} \in \mathbb{R}^n \,\mid\, |L_i (\underline{x})| < c_i, ~ 1 \le i \le n \}. \]

    The result is immediate after we compute the volume:
    \[ \mu (S) = 2^n \frac{c_1\cdots c_n}{|\det (L_1,\ldots,L_n)|}. \qedhere \]
  \end{proof}
\end{corollary}

If in the statement above we replace $|L_i (\underline{x})| < c_i$ with
$|L_i (\underline{x})| \le c_i$, then $|\det (L_1,\ldots,L_n)| < c_1 \cdots c_n$
can be also replaced with $|\det (L_1,\ldots,L_n)| \le c_1 \cdots c_n$. In fact,
it is sufficient to have only $|L_1 (\underline{x})| \le c_1$ and
$|L_i (\underline{x})| < c_i$ for $i = 2, \ldots, n$.

\begin{corollary}[Dirichlet approximation theorem]
  Let $\alpha\in\mathbb{R}$ and let $Q > 0$. Then there exist $x,y \in \ZZ$,
  $(x,y) \ne (0,0)$, such that $|x \alpha - y| < Q^{-1}$ and $|x| \le Q$.
\end{corollary}

Sometimes this statement is written in form
\[ \left| \alpha - \frac{y}{x} \right| < \frac{1}{Qx} \le \frac{1}{x^2}. \]

This means that one can approximate a real number with a rational fraction
$\frac{y}{x}$ with precision $\frac{1}{x^2}$.

\begin{proof}[Proof of the corollary]
  Consider linear forms $L_1 (x,y) = \alpha x - y$ and $L_2 (x,y) = x$. Apply
  the previous corollary for $c_1 = Q^{-1}$ and $c_2 = Q$.
\end{proof}

One can show that there exist infinitely many rational numbers
$\frac{y}{x} \in \QQ$ such that
$$\left| \alpha - \frac{y}{x} \right| < \frac{1}{x^2}.$$
(Such approximations come from continuous fraction expansions.)

\begin{proposition}
  Let $L_1,\ldots,L_s$ be linear forms on $\ZZ^n$ with coefficients in
  $\ZZ$. Let $m_1, \ldots, m_s \in \ZZ_{> 0}$. Let $S$ be a symmetric convex set
  in $\mathbb{R}^n$. Assume $\mu (S) > 2^n \, m_1\cdots m_s$. Then there exists
  $\underline{x} \in \ZZ^n \cap S$, $\underline{x} \ne \underline{0}$, such that
  \[ \tag{*} L_i (\underline{x}) \equiv 0 \pmod{m_i} \quad i = 1,\ldots,s. \]

  \begin{proof}
    Consider
    \[ \Lambda \dfn \{ \underline{x} \in \ZZ^n \mid \underline{x} \text{ satisfies (*)} \}. \]
    It is a subgroup of $\ZZ^n$ of index $m$.

    We want to apply a generalized Blichfeld's theorem (the proof goes the same
    way, so we omit it).

    \begin{claim}
      Let $S \subseteq \mathbb{R}^n$ be a symmetric convex set. Let
      $m \in \ZZ_{> 0}$. If $\mu (S) > m$, then there exist $m+1$ pairwise
      distinct points $\underline{y}_0, \ldots, \underline{y}_m \in S$ such that
      $\underline{y}_i - \underline{y}_j \in \ZZ^n$.
    \end{claim}

    We have $\mu (\frac{1}{2} S) > m$ for $m \dfn m_1\cdots m_s$, so in our case
    there are pairwise distinct points
    $\underline{y}_0, \ldots, \underline{y}_m \in \frac{1}{2} S$ such that
    $\underline{y}_i - \underline{y}_j \in \ZZ^n$. Among them there must be a
    pair $\underline{y}_i$, $\underline{y}_j$ such that
    $\underline{y}_i \equiv \underline{y}_j \pmod{\Lambda}$,
    i.e. $\underline{y}_i - \underline{y}_j \in \Lambda$.
  \end{proof}
\end{proposition}

In the proof above $\Lambda$ is a \term{lattice}, that is a discrete subgroup of
rank $n$ in $\mathbb{R}^n$. A lattice has form
$$\Lambda = \{ x_1 \underline{\omega}_1 + \cdots + x_n \underline{\omega}_n \mid x_i \in \ZZ \},$$
where $\underline{\omega}_1, \ldots, \underline{\omega}_n \in \ZZ^n$ are
linearly independent over $\mathbb{R}$.

The \term{determinant} of $\Lambda$ is the volume of its fundamental
parallelepiped. It coincides with the subgroup index $[\ZZ^n : \Lambda]$.

\begin{center}
  \includegraphics[width=6cm]{lattice.mps}
\end{center}

One can formulate Minkowski'a theorem for arbitrary lattices.

\begin{proposition}[Minkowski revised]
  Let $S$ be a symmetric convex set in $\mathbb{R}^n$ and let
  $\Lambda \subset \mathbb{R}^n$ be a lattice. If $\mu (S) > 2^n \det \Lambda$,
  then $S \cap \Lambda$ has a nonzero point.
\end{proposition}

\noindent (This easily reduces to the usual case $\Lambda = \ZZ^n$ by a variable
change.)

\section{Proof of the Hasse--Minkowski theorem}

With the developed tools we can finally prove the Hasse--Minkowski theorem.
It can be reformulated as follows in our new language.
\emph{Let $\phi (\underline{X})$ be a quadratic form over $\QQ$. Then}
\[ \phi \text{\it{} is isotropic over }\QQ
  \iff
  \phi\text{\it{} is isotropic over }\QQ_p \text{\it{} for }2 \le p \le \infty. \]

Let $n$ denote the dimension (the number of variables $X_1,\ldots,X_n$).

\vspace{1em}

For $n = 1$ there is nothing to prove---the form is not isotropic. \qed

\vspace{1em}

For $n = 2$, replacing $\phi$ with $\alpha \phi$ for some $\alpha\in\QQ^\times$,
we may assume $\phi (X,Y) = X^2 - \alpha Y^2$. Now $X^2 - \alpha Y^2$ is
isotropic over $K$ iff $\alpha$ is a square in $K$. So we have to show

\[ \alpha \in (\QQ^\times)^2 \iff \alpha \in (\QQ_p^\times)^2 \text{ for }2 \le p \le \infty. \]

In one direction this is obvious. In the other direction, suppose
$\alpha \in (\QQ_p^\times)^2$ for every prime $p$. Write
$\alpha = \epsilon \prod p^{ \nu_p (\alpha)}$ for $\epsilon = \pm 1$. Since
$\alpha \in (\mathbb{R}^\times)^2$, we have $\epsilon = +1$. Now since
$\alpha \in (\QQ_p^\times)^2$ for finite $p$, each $ \nu_p (\alpha)$ is
even. Thus $\alpha \in (\QQ^\times)^2$. \qed

\subsection*{Ternary forms case}

Things become really interesting starting from $n = 3$. The study of this
particular case (but of course not our proof with quadratic forms and geometry
of numbers) can be attributed to Legendre.

We may assume that the quadratic form is regular and has form
$$\phi (X_1,X_2,X_3) = a_1 X_1^2 + a_2 X_2^2 + a_3 X_3^2$$
with $a_i \in \ZZ$, $a_i \ne 0$, and $a_1\,a_2\,a_3$ square-free (if
$p^2 \mid a_i$ for some prime $p$, this can be ruled out by a variable change
$X^\prime_i \dfn p X_i$). We claim one can even assume that
$a_1,a_2,a_3 \in \ZZ$ with $a_1,a_2,a_3$ being \emph{pairwise} coprime.

Assume $p$ divides both $a_1$ and $a_2$. Consider a quadratic form

\[ p\phi \sim \frac{a_1}{p} X_1^2 + \frac{a_2}{p} X_2^2 + p\,a_3\,X_3^2. \]

Now the coefficients are $a_1^\prime = a_1/p$, $a_2^\prime = a_2/p$,
$a_3^\prime = p\,a_3$. We have
$|a_1^\prime\,a_2^\prime\,a_3^\prime| = \frac{|a_1\,a_2\,a_3|}{p}$, so after
finitely many steps like that we obtain $(a_i,a_j) = 1$ for $i \ne j$.

\vspace{1em}

It is clear that if $\phi$ is isotropic over $\QQ$, then it is isotropic over
$\QQ_p$. We want to show the opposite implication. Assume $\phi$ is isotropic
over $\QQ_p$ for all $p$.

\vspace{1em}

We look what does it mean that $\phi$ is isotropic over $\QQ_p$ with
$p < \infty$? If $p \ne 2$ and all $a_i$ are units, that is
$p \nmid a_1\,a_2\,a_3$, then $\phi$ is automatically isotropic over $\QQ_p$
(\refref{proposition}{proposition:units-isotropic}). We look at what happens
when $p \mid a_1\,a_2\,a_3$ or $p = 2$.

Suppose $p > 2$ and $p \mid a_1\,a_2\,a_3$. We may assume that $p \mid a_3$. The
form $\phi$ is isotropic if there exist $x_1,x_2,x_3 \in \QQ_p$,
$(x_1,x_2,x_3) \ne (0,0,0)$, such that
$a_1\,x_1^2 + a_2\,x_2^2 + a_3\,x_3^2 = 0$. We can clearly assume that one of
$x_i$'s is a unit. Actually, it must be the case that at least two $x_i$'s are
units, so that at least one of $ \nu_p (x_1)$ and $ \nu_p (x_2)$ is zero. If
not, then $ \nu_p (x_1) \ge 1$, $ \nu_p (x_2) \ge 1$, $ \nu_p (x_3) = 0$, and
$$\nu_p (a_1\,x_1^2 + a_2\,x_2^2) \ge 2, \quad \nu_p (a_3\,x_3^2) = 1,$$
contradicting $\nu_p (a_1\,x_1^2 + a_2\,x_2^2) = \nu_p (a_3\,x_3^2)$.

Now reducing modulo $p$, we get from our assumptions that
$a_1 X_1^2 + a_2 X_2^2$ is isotropic over $\FF_p$, and so
$a_1 (X_1^2 - b\,X_2^2)$ is isotropic for $b \dfn a_2\,a_1^{-1}$, meaning that
$b = c^2$ is a square. So we get
\[ \phi \equiv a_1 \, (X_1^2 - b\,X_2^2) = L_1 (X_1,X_2)\cdot L_2 (X_1,X_2) \pmod{p}, \quad
  L_1 \dfn a_1 (X_1 - c\,X_2), ~ L_2 \dfn X_1 + c\,X_2. \]

Thus far we have deduced the following:
\emph{if $\phi$ is isotropic over $\QQ_p$ for $p \mid a_1\,a_2\,a_3$, $p > 2$,
  then there exist linear forms $L_1^{(p)}, L_2^{(p)} \in \ZZ [\underline{X}]$
  such that $\phi \equiv L_1^{(p)}\cdot L_2^{(p)} \pmod{p}$}.
(These forms depend on $p$, as we have seen above.)

\vspace{1em}

Next we analyze the case $p = 2$ (see p. \pageref{isotropic-over-Q2}). If
$2 \nmid a_1\,a_2\,a_3$, then
\[ \phi \text{ is isotropic over }\QQ_2 \iff a_i + a_j \equiv 0 \pmod{4} \text{ for some }i \ne j. \]

If $2 \mid a_1\,a_2\,a_3$, e.g. $2 \mid a_3$, then
\[ \phi \text{ is isotropic over }\QQ_2 \iff \left\{\begin{array}{c}
                                                      a_1 + a_2 \equiv 0 \pmod{8} \\
                                                      \text{or} \\
                                                      a_1 + a_2 + a_3 \equiv 0 \pmod{8}
                                                    \end{array}\right\} \]

\vspace{1em}

\begin{itemize}
\item For every odd prime $p \mid a_1\,a_2\,a_3$ we consider congruences
  \[ L_1^{(p)} (\underline{X}) \equiv 0 \pmod{p} \quad
    \text{or} \quad
    L_2^{(p)} (\underline{X}) \equiv 0 \pmod{p}. \]

\item If $2 \nmid a_1\,a_2\,a_3$ and, say, $a_1 + a_2 \equiv 0 \pmod{4}$,
  consider congruences
  \[ X_1 \equiv X_2 \pmod{2}, \quad X_3 \equiv 0 \pmod{2}. \]

\item If $2 \mid a_1\,a_2\,a_3$, e.g. $2 \mid a_3$, consider congruences
  \[ X_1 \equiv X_2 \pmod{4}, \]

  \[ X_3 \equiv
    \left\{\begin{array}{ll}
             0 \pmod{2}, & \text{if } a_1 + a_2 \equiv 0 \pmod{8},\\
             X_2 \pmod{2}, & \text{if } a_1 + a_2 + a_3 \equiv 0 \pmod{8}.
           \end{array}\right. \]
\end{itemize}

In total, we have a linear congruence modulo $p$ for each odd
$p \mid a_1\,a_2\,a_3$. For $p = 2$ and $2 \nmid a_1\,a_2\,a_3$ we have two
congruences modulo $2$; for $p = 2$ and $2 \mid a_1\,a_2\,a_3$ we have one
congruence modulo $4$ and two congruences modulo $2$. In any case, the product
of moduli is
\[ (\prod_{\substack{p > 2 \\ p \mid a_1\,a_2\,a_3}} p) \cdot
  \left\{\begin{array}{ll}
           2\cdot 2, & \text{if } 2 \nmid a_1\,a_2\,a_3,\\
           2\cdot 4, & \text{if } 2 \mid a_1\,a_2\,a_3.
         \end{array}\right\} = 4\cdot|a_1\,a_2\,a_3|. \]

If $p$ is odd, then the congruence $L_i^{(p)} (\underline{X}) \equiv 0 \pmod{p}$
implies $\phi (\underline{X}) \equiv 0 \pmod{p}$.

If $a_1 + a_2 \equiv 0 \pmod{4}$ and $X_1 \equiv X_2 \pmod{2}$,
$X_3 \equiv 0 \pmod{2}$, then
$$\phi (\underline{X}) \equiv a_1 X_1^2 + a_2 X_2^2 \equiv 0 \pmod{4}$$

Similarly, if $2 \mid a_1\,a_2\,a_3$, then the congruences give
$\phi (\underline{X}) = 0 \pmod{8}$.

So our congruences mean that
\begin{align*}
  \phi (\underline{X}) & \equiv 0 \pmod{p} \quad \text{for } p > 2, ~ p \mid a_1\,a_2\,a_3,\\
  \phi (\underline{X}) & \equiv 0 \pmod{4} \quad \text{for } 2\nmid a_1\,a_2\,a_3,\\
  \phi (\underline{X}) & \equiv 0 \pmod{8} \quad \text{for } 2 \mid a_1\,a_2\,a_3,
\end{align*}
which implies
$\phi (\underline{X}) \equiv 0 \pmod{4\cdot |a_1\,a_2\,a_3|}$. However, we gave
this condition by \emph{linear} congruences, and not quadratic. This means that
we can apply \refref{corollary}{corollary:linear-congruences}.

Consider a convex set
\[ S \dfn \{ \underline{x} \in \mathbb{R} \,\mid\, |a_1| \cdot x_1^2 + |a_2| \cdot x_2^2 + |a_3| \cdot x_3^2 < 4\cdot |a_1\,a_2\,a_3| \}. \]

It is an ellipsoid, having volume
\[ \mu (S) = \cfrac{\frac{3}{4} \pi (\sqrt{4 \cdot |a_1\,a_2\,a_3|})^3}{\sqrt{|a_1|} \, \sqrt{|a_2|} \, \sqrt{|a_3|}} =
  8\cdot \frac{4}{3}\,\pi \cdot |a_1\,a_2\,a_3| >
  2^3 \cdot \underbrace{4\cdot |a_1\,a_2\,a_3|}_{m\text{ in \refref{corollary}{corollary:linear-congruences}}}. \]

So $S$ should have an integral point satisfying all the congruences. There is
$\underline{x}$ such that
$\phi (\underline{x}) \equiv 0 \pmod{4\cdot |a_1\,a_2\,a_3|}$. But since
$\underline{x} \in S$, that implies $\phi (\underline{x}) = 0$, and $\phi$ is
isotropic over $\QQ$. \qed

\vspace{1em}

Observe that in our argument we actually did not use the condition that $\phi$
is isotropic over $\QQ_\infty = \mathbb{R}$. There is no contradiction because,
as we saw in \refref{corollary}{corollary:even-num-of-p-such-that-isotropic},
there is always an even number of $p$'s such that a given ternary quadratic form
is anisotropic over $\QQ_p$. So disregarding one prime (in our proof
$p = \infty$) does not affect the result.

\begin{corollary}
  Let $f$ be a regular binary form. Let $a \in \QQ^\times$. Then $f$ represents
  $a$ over $\QQ$ iff $f$ represents $a$ over $\QQ_p$ for all primes
  $2 \le p \le \infty$.

  \begin{proof}
    Consider a ternary form $f (X,Y) - a\,Z^2$. It is isotropic iff $f$
    represents $a$.
  \end{proof}
\end{corollary}

\subsection*{Quaternary forms case}

We will need the following famous result about primes in arithmetic
progressions.

\begin{theorem}[Dirichlet]
  Let $m \in \ZZ$ be a nonzero integer and let $a \in \ZZ$ be such that
  $(m,a) = 1$. Then there are infinitely many primes $q$ such that
  $q \equiv a \pmod{m}$
\end{theorem}

For a proof see any textbook in analytic number theory.

\begin{example}
  There are infinitely many primes $q$ such that $q \equiv 1 \pmod{3}$,
  or $q \equiv 3 \pmod{4}$, etc.
\end{example}

\vspace{1em}

We proceed with the Hasse--Minkowski theorem for quaternary quadratic
forms. Consider a quadratic form
$f = a_1\,X_1^2 + a_2\,X_2^2 + a_3\,X_3^2 + a_4\,X_4^2$ with
$a_i \in \QQ^\times$. We want to show that if $f$ is isotropic over $\QQ_p$ for
all $2 \le p \le \infty$, then $f$ is isotropic over $\QQ$.

We may assume that $a_i \in \ZZ$ are squarefree integers. Since $f$ is isotropic
over $\mathbb{R}$, the coefficients are not of the same sign. We may assume
$a_1 > 0$ and $a_4 < 0$. Write the quadratic form as
$f = g (X_1,X_2) - h (X_3,X_4)$, where $g \dfn a_1 \, X_1^2 + a_2\,X_2^2$ and
$h \dfn -a_3\,X_3^2 - a_4\,X_4^2$. Consider the set of prime divisors of $a_i$,
together with $2$ (which is always a ``bad prime'' to be treated separately):
\[ S \dfn \{ p \,\mid\, p \mid a_1\,a_2\,a_3\,a_4 \} \cup \{ 2 \}. \]

Now if for $p \in S$ the form $f$ is isotropic over $\QQ_p$, then there exists
some $b_p \in \QQ_p^\times$ represented by both $g$ and $h$
(\refref{proposition}{proposition:form-difference-isotropic}). We may assume
$ \nu_p (b_p) = 0 \text{ or } 1$.

Now there exists $b \in \ZZ$ such that
\begin{align*}
  b & \equiv b_p \pmod{p^2} \quad \text{for } p\in S, p \ne 2,\\
  b & \equiv b_2 \pmod{16}.
\end{align*}

So $b\,b_p^{-1} \equiv 1 \pmod{p}$ for $p \in S$, $p \ne 2$ and
$b\,b_2 \equiv 1 \pmod{8}$. Now $b\,b_p \in (\QQ_p^\times)^2$, so $b$ itself is
represented by $g$ and $h$ over $\QQ_p$, $p \in S$.

We may assume $b > 0$. Then $b$ is represented by $g$ and $h$ over $\mathbb{R}$
(because $a_1 > 0$, $-a_4 > 0$).

Assume $q$ is an odd prime such that $q \notin S$, $q \nmid b$. Then $b$ is
represented by $g$ and by $h$ over $\QQ_q$, because the coefficients of
$g (X_1,X_2) - b\,Y^2$, $h (X_3,X_4) - b\,Y^2$ are $q$-adic units.

What if $q \notin S$ and $q \mid b$? We claim that there is at most one such
prime.

\begin{claim}
  $b$ satisfying the congruences $b \equiv b_p \pmod{p^2}$ and
  $b \equiv b_2 \pmod{16}$ above can be chosen to have at most one prime divisor
  $q \notin S$.
\end{claim}

Assuming this claim, we have that $b$ is represented over $\QQ_p$ for all primes
$2 \le p \le \infty$ by both $g$ and $h$, except for perhaps one prime. This
means that $b$ is represented over $\QQ$, and so $f = g - h$ is isotropic over
$\QQ$.

It remains to show the claim above.

\begin{proof}
  Consider the set
  \[ S^\prime \dfn \{ p \in S ~\mid~ p \mid b_p \}. \]

  Then we have
  \[ b = \left(\prod_{p\in S^\prime} p\right) \cdot b^\prime, \quad
    (b^\prime, p) = 1 \text{ for all } p\in S. \]

  Consider an integer
  \[ m \dfn \frac{16\cdot \prod_{p\in S} p^2}{\prod_{p\in S^\prime} p}. \]

  Now the congruences above are equivalent to $b^\prime \equiv c \pmod{m}$ for
  some $c \in \ZZ$, where $(c,m) = 1$. By Dirichlet's theorem, we can take a
  prime $b^\prime = q$.
\end{proof}

\subsection*{Forms of dimension $\ge 5$}

Consider a quadratic form in five variables
$f = a_1 \, X_1^2 + \cdots + a_5\,X_5^2$ with $a_i \in \ZZ$, which is isotropic
over $\QQ_p$ for all $p$. We can assume that $a_i$ are square-free, and, say,
$a_1 > 0$ and $a_5 < 0$ (since the form is isotropic over $\mathbb{R}$).

We have $f = g (X_1,X_2) - h (X_3,X_4,X_5)$ for $g \dfn a_1\,X_1^2 + a_2\,X_2^2$
and $h \dfn -a_3\,X_3^2 - a_4\,X_4^2 - a_5\,X_5^2$. Consider the set
\[ S \dfn \{ p ~ \mid ~ p \mid a_1 \, a_2 \, a_3 \, a_4 \, a_5 \} \cup \{ 2 \}. \]

There exists $b \in \ZZ$, $b \ne 0$, represented by both $g$ and $h$ over
$\QQ_p$ for all $p \in S$, $p \nmid b$ and also for $p = \infty$. Again, by
Dirichlet's theorem, we may assume that $b$ has at most one prime divisor
$q \notin S$.

Since $q \nmid a_3\,a_4\,a_5$, we have that $h$ is isotropic over $\QQ_q$, and
$g$ represents $b$ over $\QQ_q$.

Now $b$ is represented over $\QQ_p$ by both $g$ and $h$ for all primes
$2 \le p \le \infty$, so $b$ is represented over $\QQ$ by both $g$ and $h$,
meaning that $f = g - h$ is isotropic over $\QQ$. \qed

\vspace{1em}

For $n > 5$ one proceeds by induction. Consider a form
$f = a_1\,X_1^2 + \cdots + a_n\,X_n^2$. Assume it is isotropic over $\QQ_p$ for
all $2 \le p \le \infty$. In particular, it is isotropic over $\mathbb{R}$,
hence we can consider $f = g + h$, where $g$ is a form in $5$ variables
isotropic over $\mathbb{R}$ (we choose $g$ such that not all its coefficients
have the same sign). By the Hasse--Minkowski principle for $n = 5$ we have that
$g$ is isotropic over $\QQ$, and we are done by induction. \qed

\pagebreak

\part{Intermezzo: more on absolute values}

\section{Extensions of complete fields}

Let $K$ be a field complete with respect to an absolute value $|\cdot|$. Let $L$
be a finite extension of $K$. Then

\begin{itemize}
\item it is possible to extend $|\cdot|$ to $L$,

\item such extension is unique,

\item $L$ will be also complete with respect to the extended absolute value.
\end{itemize}

The extension of an absolute value $|\cdot|$ to $L$ is given
by \label{complete-abs-extension}
\begin{align*}
  L & \to \mathbb{R}_{\ge 0},\\
  \alpha & \mapsto |N_{L/K} (\alpha)|^{1/n}.
\end{align*}

Here $N_{L/K}$ is the norm map of the extension $L/K$ and $n = [L : K]$ is the
extension degree.

As a corollary, an absolute value extends uniquely to the algebraic closure
$\overline{K}$, but one should be careful because it is not complete
anymore. One can take completion of $\overline{K}$, and it will be an
algebraically closed field.

\begin{theorem}
  Completion of an algebraically closed field is algebraically closed.
\end{theorem}

\vspace{1em}

For archimedian fields the situation is simple, because of the following result,
named after Israel Gelfand and Stanis\l{}aw Mazur.

\begin{theorem}[Gelfand--Mazur]
  The only archimedian complete fields are $\mathbb{R}$ and $\mathbb{C}$.
\end{theorem}

So we will focus on the nonarchimedian complete fields.

\begin{example}
  There are two principally different situations.

  The ``equal characteristic case'' means that $F_K$ and $K$ have the same
  characteristic. The basic example is $K = F (\!(T)\!)$, $\mathcal{O}_K = F [\![T]\!]$,
  $F_K = F$.

  The ``distinct characteristic case'' means that $F_K$ has characteristic $> 0$
  and $K$ has characteristic $0$. The basic example of this is $K = \QQ_p$,
  $\mathcal{O}_K = \ZZ_p$, $F_K = \FF_p$.
\end{example}

We fix the following notation.

\begin{itemize}
\item $K$ is a nonarchimedian complete field with respect to an absolute value
  $|\cdot|$.

\item $\mathcal{O}_K \dfn \{ \alpha \in K \,\mid\, |\alpha| \le 1 \}$ is the
  \term{local ring} of $K$.

\item $I_K \dfn \{ \alpha \in K \,\mid\, |\alpha| < 1 \}$ is the maximal ideal
  in $\mathcal{O}_K$.

\item $F_K \dfn \mathcal{O}_K/I_K$ is the \term{residue field} of $K$.

\item $\Gamma_K \dfn \{ |\alpha| \,\mid\, \alpha \in K^\times \}$ is a
  multiplicative subgroup of $\mathbb{R}_{> 0}$.
\end{itemize}

An important case is that of \term{discrete absolute values}, when $\Gamma_K$ is
a discrete subgroup, as it happens for $\QQ_p$ and $F (\!(T)\!)$. In this case
it is convenient to consider not the absolute value $|\cdot|_v$ but the
corresponding discrete valuation $v (\cdot)$. In such situation we pass from a
multiplicative group to an additive group that normalizes to be $\ZZ$.

Let $K$ be a complete field and let $L/K$ be a finite extension. We have
\[ \xymatrix{
    I_L\ar@{^(->}[r] & \mathcal{O}_L\ar@{->>}[r] & F_L \\
    I_K\ar@{^(->}[r]\ar@{^(->}[u] & \mathcal{O}_K\ar@{->>}[r]\ar@{^(->}[u] & F_K\ar@{^(->}[u]
  } \]

\[ I_K = \mathcal{O}_K \cap I_L. \]

The image of $\mathcal{O}_K$ under the quotient map $\mathcal{O}_L \to F_L$ is the residue field
$F_K$.

\begin{proposition}
  $F_L/F_K$ is a finite field extension and $[F_L : F_K] \le [L : K]$.

  \begin{proof}
    Let $\overline{\alpha}_1, \ldots, \overline{\alpha}_n \in F_L$ be linearly
    independent over $F_K$. We claim that the lifts
    $\alpha_1, \ldots, \alpha_n \in \mathcal{O}_L$ are linearly independent over $K$.

    Assume $\lambda_1 \alpha_1 + \cdots + \lambda_n \alpha_n = 0$ for some
    $\lambda_1,\ldots,\lambda_n \in K$ and
    $(\lambda_1,\ldots,\lambda_n) \ne (0, \ldots, 0)$. We may assume
    (multiplying the identity by some number) that $|\lambda_i| \le 1$ and for
    some $i$ we have $|\lambda_i| = 1$. Then $\lambda_i \in \mathcal{O}_L$ and in $F_K$
    holds
    $\overline{\lambda}_1 \overline{\alpha}_1 + \cdots + \overline{\lambda}_n \overline{\alpha}_n = 0$
    for $(\overline{\lambda}_1, \ldots, \overline{\lambda}_n) \ne (0,\ldots,0)$.
    Contradiction.
  \end{proof}
\end{proposition}

For an extension $L/K$ the group $\Gamma_K$ is a subgroup of $\Gamma_L$.

\begin{proposition}
  $[\Gamma_L : \Gamma_K] \le [L:K]$.

  \begin{proof}
    Consider $\alpha_1, \ldots, \alpha_n \in L^\times$ such that
    $|\alpha_1|, \ldots, |\alpha_n|$ represent pairwise distinct cosets of
    $\Gamma_L / \Gamma_K$. We claim that $\alpha_1, \ldots, \alpha_n$ are
    linearly independent over $K$.

    Assume for the sake of contradiction that
    $\lambda_1\,\alpha_1 + \cdots + \lambda_n\,\alpha_n = 0$ for some
    $(\lambda_1,\ldots,\lambda_n) \ne (0,\ldots,0)$. We may assume that
    $\lambda_1, \ldots, \lambda_n \ne 0$ (by throwing away zero terms). Now each
    $|\lambda_i\,\alpha_i|$ belongs to the same coset in $\Gamma_L / \Gamma_K$
    as $|\alpha_i|$, so all $|\lambda_i\,\alpha_i|$ represent pairwise distinct
    cosets. Hence $\lambda_1\,\alpha_1 + \cdots + \lambda_n\,\alpha_n \ne 0$,
    since in the nonarchimedian setting $a_1 + \cdots + a_n = 0$ implies
    $|a_i| = |a_j|$ for some $i \ne j$. Contradiction.
  \end{proof}
\end{proposition}

\begin{definition}
  Let $L / K$ be a finite extension of complete local fields.

  The number $f_{L/K} \dfn [F_L : F_K]$ is called the \term{residue field
    degree} of the extension.

  The number $e_{L/K} \dfn [\Gamma_L : \Gamma_K]$ is called the
  \term{ramification index}.
\end{definition}

In case of discrete absolute values the group $\Gamma_K$ is discrete. We have
$\Gamma_K = \left< |\pi_K| \right>$ where $\pi_K$ is the primitive element
generating the maximal ideal $I_K \subset \mathcal{O}_K$.

\begin{example}
  For $\QQ_p$ we have $\pi = p$. For $F (\!(T)\!)$ we have $\pi = T$.
\end{example}

Every $\alpha \in K$ can be uniquely written as $\pi^m \eta$ for some unit
$\eta \in \mathcal{O}_K^\times$. Then we can define a valuation $\nu_\pi (\alpha) \dfn m$
and the corresponding absolute value $|\alpha| \dfn |\pi|^{-\nu_\pi
  (\alpha)}$. This is essentially what we did in \refref{\S}{section:Zp-intro}
for $p$-adic integers; the same works for an arbitrary discrete valuation ring.

The ramification index is $e_{L/K} = [|\pi_L|\,\ZZ : |\pi_K|\,\ZZ]$. We have
$|\pi_L|^\ell = |\pi_K|$ and $\pi_K = \pi_L^\ell \eta$ for
$\eta \in \mathcal{O}_L^\times$.

\vspace{1em}

We have seen that $e_{L/K} \le [L : K]$ and $f_{L/K} \le [L : K]$. In fact,
a stronger result holds.

\begin{proposition}
  $e_{L/K} \cdot f_{L/K} \le [L : K]$.
\end{proposition}

In the most interesting cases $e_{L/K} \cdot f_{L/K} = [L : K]$, e.g. in the
case when $F_L/F_K$ is a separable extension (for instance, when $F_K$ is a
perfect field).

\begin{proof}
  Let $\alpha_1, \ldots, \alpha_e$ be such that $|\alpha_1|, \ldots, |\alpha_e|$
  represent all residue classes of $\Gamma_L / \Gamma_K$. Let
  $\overline{\beta}_1, \ldots, \overline{\beta}_f \in \mathcal{O}_L/I_L$ be a basis of
  $F_L/F_K$ and $\beta_1, \ldots, \beta_f$ are some lifts to $\mathcal{O}_L$.

  We have $e f$ elements $\alpha_i \beta_j$ and we claim they are linearly
  independent over $K$. Assume it is not the case and
  $$\sum_{\substack{1 \le i \le e \\ 1 \le j \le f}} \lambda_{ij} \, \alpha_i \, \beta_j = 0$$
  for some $\lambda_{ij}$, not all equal to $0$.

  Consider the absolute values $|\lambda_{ij} \, \alpha_i \, \beta_j|$.
  Let $(i_1, j_1)$ be the index such that
  $\delta \dfn |\lambda_{i_1, j_1} \, \alpha_{i_1} \, \beta_{j_1}|$ is maximal
  among all. Consider all other indices giving the same value:
  $$S \dfn \{ (i,j) \,\mid\, |\lambda_{ij} \, \alpha_i \, \beta_j| = \delta \}.$$

  Now since $\beta_j \in \mathcal{O}_L^\times$, we have $|\beta_j| = 1$, and for all
  $(i,j) \in S$ the values $|\lambda_{ij} \, \alpha_i|$ are equal. In
  particular, they belong to the same class $\Gamma_L/\Gamma_K$, meaning that
  all $i$'s are the same.

  We may assume that $|\lambda_{i_1, j}| \le 1$ for all $j$ and
  $|\lambda_{i_1, j}| = 1$ for some $j$.

  We have
  $|\lambda_{i_1, j} \, \alpha_{i_1} \, \beta_j| = |\lambda_{i_1,j}| \cdot
  |\alpha_{i_1}|$.

  \[ \left| \sum_{(i_1, j) \in S} \lambda_{i_1, j} \, \beta_j \right| < 1. \]

  So reducing $\sum_{(i_1, j) \in S} \lambda_{i_1, j} \, \beta_j$ modulo $I_K$,
  we get
  $$\sum_{(i_1, j) \in S} \overline{\lambda}_{i_1, j} \, \overline{\beta}_j = 0,$$
  where not all $\lambda_{i_1, j}$ are $0$. Contradiction.
\end{proof}

\section{Discrete absolute values case}

Let $K$ be complete with respect to a discrete absolute value $|\cdot|$. We
claim that in this case $e_{L/K}\cdot f_{L/K} = [L:K]$.

\begin{lemma}
  Let $R$ be a principal ideal domain. Let $M$ be a free $R$-module. Then every
  $R$-submodule of $M$ is also free.
\end{lemma}

\noindent (If $M$ is finitely generated, this follows from the structure of
finitely generated modules over a PID. For the infinite version see
\emph{Lang, Algebra}, Appendix 2, \S 2, p. 880.)

\begin{lemma}
  Let $L/K$ be an extension of discrete complete local fields. Then $\mathcal{O}_L$ is a
  free $\mathcal{O}_K$-module of rank $[L:K]$.

  \begin{proof}
    Since $|\cdot|$ is discrete, every ideal of $\mathcal{O}_K$ is generated by $\pi_K^m$
    for $m = 0, 1, 2, \ldots$ In particular, $\mathcal{O}_K$ is a principal ideal domain,
    and we are going to use this fact.

    Let $\alpha_1, \ldots, \alpha_n$ be a $K$-basis of $L$. We may assume that
    these elements lie in $\mathcal{O}_L$. Consider the $\mathcal{O}_K$-module
    \[ M \dfn \mathcal{O}_K \alpha_1 \oplus \cdots \oplus \mathcal{O}_K \alpha_n. \]

    It is an $\mathcal{O}_K$-submodule of $\mathcal{O}_L$.

    For an element
    $\alpha = \lambda_1 \, \alpha_1 + \cdots + \lambda_n \, \alpha_n \in \mathcal{O}_L$
    the coefficients $\lambda_i \in K$ are given by the linear system of
    equations
    \[ \tr_{L/K} (\alpha_i\,\alpha) = \sum_j \tr_{L/K} (\alpha_i\,\alpha_j)\,\lambda_j. \]

    Now $\tr_{L/K} (\alpha_i\,\alpha) \in \mathcal{O}_L\cap K = \mathcal{O}_K$, so
    $d\,\lambda_j \in \mathcal{O}_K$, where
    $d = \det [\tr_{L/K} (\alpha_i\,\alpha_j)] \in \mathcal{O}_K$ is the determinant of
    the linear system.

    We have $d\,\mathcal{O}_L \subseteq M$. Now $M$ is a free $\mathcal{O}_K$-module, and so
    $d\,\mathcal{O}_L$ (since $\mathcal{O}_K$ is a principal ideal domain!) and $\mathcal{O}_L$. We must
    conclude that $\mathcal{O}_L = M$ is a free $\mathcal{O}_K$-module of rank $n = [L : K]$.
  \end{proof}
\end{lemma}

\begin{remark}
  Observe that we used above just that $\mathcal{O}_K$ is a principal ideal domain.
  If $K$ and $L$ are number fields, then $\mathcal{O}_L$ is also a free $\mathcal{O}_K$-module of
  rank $[L:K]$, but $\mathcal{O}_K$ may not be a PID.
\end{remark}

\begin{lemma}
  $\mathcal{O}_L / \pi_K \mathcal{O}_L$ is a $[L:K]$-dimensional vector space over $F_K$.

  \begin{proof}
    We have an isomorphism of $\mathcal{O}_K$-modules $\mathcal{O}_L \isom \mathcal{O}_K^n$, hence
    $\mathcal{O}_L/\pi_K \mathcal{O}_L \isom (\mathcal{O}_K/\pi_K \mathcal{O}_K)^n \isom F_K^n$.
  \end{proof}
\end{lemma}

$F_L \dfn \mathcal{O}_L / I_L$ is an $f_{L/K}$-dimensional $F_K$-vector space by the
definition of the residue field degree $f_{L/K}$. Moreover, the following is
true.

\begin{lemma}
  For each $m$ the quotient
  $I_L^m / I_L^{m+1} = \pi_L^m \mathcal{O}_L / \pi_L^{m+1} \mathcal{O}_L$ is an
  $f_{L/K}$-dimensional $F_K$-vector space isomorphic to $F_L$.

  \begin{proof}
    Consider a homomorphism of $\mathcal{O}_K$-modules

    \begin{align*}
      \mathcal{O}_L & \to \frac{\pi_L^m \mathcal{O}_L}{\pi_L^{m+1} \mathcal{O}_L},\\
      x & \mapsto \pi_L^m \cdot x.
    \end{align*}

    This is a surjection and the kernel is $\pi_L \mathcal{O}_L$, hence the isomorphism
    \[ F_L \dfn \frac{\mathcal{O}_L}{\pi_L \mathcal{O}_L} \isom \frac{\pi_L^m \mathcal{O}_L}{\pi_L^{m+1} \mathcal{O}_L}. \qedhere \]
  \end{proof}
\end{lemma}

\begin{example}
  For $p$-adic integers we have an isomorphism of $\FF_p$-vector spaces
  \[ \frac{p^m \, \ZZ_p}{p^{m+1} \, \ZZ_p} \isom \frac{\ZZ_p}{p \, \ZZ_p}. \qedhere \]
\end{example}

\begin{theorem}\label{theorem:efLK}
  Let $L/K$ be an extension of discrete complete local fields. Then
  $e_{L/K}\cdot f_{L/K} = [L:K]$.

  \begin{proof}
    $\mathcal{O}_L / \pi_K \mathcal{O}_L \isom F_K^n$ where $n \dfn [L:K]$, as an $F_K$-vector
    space.

    We have $\pi_L^e \equiv \pi_K$ by definition of $e = e_{L/K}$. Consider a
    filtration
    \[ \pi_K \mathcal{O}_L = \pi_L^e \mathcal{O}_L \subseteq \pi_L^{e-1} \mathcal{O}_L \subseteq \cdots \subseteq \pi_L \mathcal{O}_L \subseteq \mathcal{O}_L. \]
    Each quotient $\pi_L^m \mathcal{O}_L / \pi_L^{m+1} \mathcal{O}_L$ is an $f$-dimensional
    $F_K$-vector space, so we have a tower of such vector spaces
    \[ \mathcal{O}_L / \pi_K \mathcal{O}_L \ge \mathcal{O}_L / \pi_L^{e-1} \mathcal{O}_L \ge \cdots \ge \mathcal{O}_L / \pi_L \mathcal{O}_L \ge \{ 0 \}. \]
    There are $e$ vector spaces in this tower, and on each step the dimension
    increases by $f$, so
    \[ \dim_{F_K} \mathcal{O}_L / \pi_K \mathcal{O}_L = e\,f. \qedhere \]
  \end{proof}
\end{theorem}

Moreover, from the proof we see that if
$\overline{\theta}_1, \ldots, \overline{\theta}_f$ is a basis of $F_L/F_K$, then
for some lifts $\theta_1, \ldots, \theta_f$ to $\mathcal{O}_L$, a basis of $\mathcal{O}_L$ as an
$\mathcal{O}_K$-module is
\[ \theta_i \, \pi_L^j, \quad 1 \le i \le f_{L/K}, ~ 0 \le j \le e_{L/K}-1. \]

\begin{remark}\label{remark:local-degrees-global-degree-number-fields}
  For local fields there is only one prime $\pi_K \in \mathcal{O}_K$ and one prime
  $\pi_L \in \mathcal{O}_L$, so that the factorization into prime ideals in $\mathcal{O}_L$ comes
  down to
  \[ \pi_K \mathcal{O}_L = \left<\pi_L^e\right>. \]

  But for example, if $L$ and $K$ are number fields, then there are many prime
  ideals $\mathfrak{p} \subset \mathcal{O}_K$, and for each one we can consider the
  unique factorization
  \[ \tag{*} \mathfrak{p}\,\mathcal{O}_L = \mathfrak{P}_1^{e_1} \cdots \mathfrak{P}_s^{e_s} \]
  into prime ideals $\mathfrak{P}_i \subset \mathcal{O}_L$. We define for each
  $\mathfrak{P}_i$ the residue field degree to be
  $f_i \dfn [\mathcal{O}_L / \mathfrak{P}_i : \mathcal{O}_K / \mathfrak{p}]$.

  Recall that the \term{norm} $N (\mathfrak{a})$ of an ideal
  $\mathfrak{a} \subseteq \mathcal{O}_L$ is defined to be the ideal
  $N (\mathfrak{a}) \subseteq \mathcal{O}_K$ generated by $N_{K/L} (x)$ for all
  $x \in \mathfrak{a}$.

  \begin{itemize}
  \item For a prime ideal $\mathfrak{P}_i \subset \mathcal{O}_L$ one has
    $N (\mathfrak{P}_i) = \mathfrak{p}^{f_i}$, where
    $\mathfrak{p} = \mathcal{O}_K\cap\mathfrak{P}_i$ and
    $f_i \dfn [\mathcal{O}_L/\mathfrak{P}_i : \mathcal{O}_K/\mathfrak{p}]$ as above.

  \item The norm is multiplicative:
    $N (\mathfrak{A}\,\mathfrak{B}) = N (\mathfrak{A}) \cdot N (\mathfrak{B})$.
  \end{itemize}

  From this we see that taking norms in (*) leads to
  \[ \mathfrak{p}^{[L:K]} = \mathfrak{p}^{e_1 \, f_1} \cdots \mathfrak{p}^{e_s \, f_s}. \]
  Hence the identity similar to the one from \refref{theorem}{theorem:efLK} has
  form
  \[ \sum_i e_i\,f_i = [L : K]. \]
  Essentially the same formula will appear below in
  \refref{theorem}{theorem:local-degrees-global-degree}.
\end{remark}

\section{Unramified and totally ramified extensions}

In this section to simplify things we assume that the fields are complete with
respect to a \emph{discrete} valuation. In this case
$[L:K] = e_{L/K}\cdot f_{L/K}$.

\begin{definition}
  Let $L/K$ be a finite extension of complete fields.

  \begin{itemize}
  \item $L/K$ is \term{unramified} if $e_{L/K} = 1$, and so $[L:K] = f_{L/K}$.

  \item $L/K$ is \term{totally ramified} if $f_{L/K} = 1$, and so
    $[L:K] = e_{L/K}$.

  \item $L/K$ is \term{tamely ramified} if $\fchar F_K$ does not divide
    $e_{L/K}$. Otherwise we say that $L/K$ is \term{wild}.
  \end{itemize}
\end{definition}

\begin{proposition}
  Assume $F_L/F_K$ is a separable extension. Given $L/K$ as above, there exists
  an intermediate field $K \subset L_0 \subset L$ such that $L_0 / K$ is
  unramified and $L / L_0$ is totally ramified. (This $L_0$ is actually unique.)

  \begin{proof}
    Since $F_L/F_K$ is separable, we have $F_L = F_K (\overline{\theta})$ for
    some $\overline{\theta} \in F_L$. Let $\overline{p} (T) \in F_K [T]$ be the
    minimal (monic) polynomial of $\overline{\theta}$ over $F_K$. Let
    $p (T) \in \mathcal{O}_K [T]$ be a monic lifting of $\overline{p}$. The degree of $p$
    is $f_{L/K}$, and it is irreducible over $K$.

    Let $\theta_0 \in \mathcal{O}_L$ be a lifting of $\overline{\theta} \in F_L$. We have
    $p (\theta_0) \equiv 0 \pmod{I_L}$ and
    $p^\prime (\theta_0) \not\equiv 0 \pmod{I_L}$ (because $\overline{p}$ is
    separable, $\overline{p}^\prime (\theta) \ne 0$). Now apply Hensel's
    lemma that says that there exists $\theta \in \mathcal{O}_L$ such that
    $p (\theta) = 0$ and $\theta \equiv \overline{\theta} \pmod{I_L}$.

    Take $L_0 \dfn K (\theta)$. We have $F_{L_0} = F_L$ and so
    $f_{L_0/K} = f_{L/K}$. As for the ramification index,
    $[L_0 : K] = \deg p = f_{L/K}$, so $e_{L_0/K} = 1$.

    $f_{L/L_0} = 1$, so $L/L_0$ is totally ramified.
  \end{proof}
\end{proposition}

Using the Hensel's lemma in the same way as above, we get the following
characterization of unramified extensions, assuming $F_K$ is a perfect field.

\begin{theorem}
  Let $K$ be a complete local field. Assume its residue field $F_K$ is
  perfect. There is 1-1 correspondence between finite extensions $F_L/F_K$ and
  finite unramified extensions $L/K$.

  \[ \xymatrix{
      \mathcal{O}_K\ar@{^(->}[r]\ar[d] & \mathcal{O}_L\ar[d] \\
      F_K\ar@{^(->}[r] & F_L
    } \]

  \begin{proof}
    Assume we have an unramified extension $L / K$. Then we have
    $F_L \dfn \mathcal{O}_L / (\pi_K)$ and $F_K \dfn \mathcal{O}_K / (\pi_K)$ and an extension
    $F_L / F_K$.

    \vspace{1em}

    In the other direction, assume we have an extension $F_L/F_K$. Since $F_K$
    is perfect by the assumption, $F_L = F_K (\overline{\theta})$ for some
    $\overline{\theta} \in F_L$. Let $\overline{p} (X) \in F_K [X]$ be the
    minimal polynomial of $\overline{\theta}$. Consider a lift
    $p (X) \in \mathcal{O}_K [X]$. It must be irreducible since $\overline{p}$ is
    irreducible. By Hensel's lemma, there exist a \emph{unique}
    $\theta \in \mathcal{O}_L$ such that $p (\theta) = 0$ and
    $\theta \equiv \overline{\theta} \pmod{\pi_K}$. Now take
    $L \dfn K (\theta)$. We have
    $[L : K] = \deg p = \deg \overline{p} = [F_L : F_K]$, so $L/K$ is
    unramified.
  \end{proof}
\end{theorem}

\begin{example}\label{example:unramified-extensions-of-Qp}
  The field of $p$-adic numbers $\QQ_p$ has $\FF_p$ as its residue field. By the
  theorem above, unramified extensions of $\QQ_p$ correspond to finite
  extensions of $\FF_p$. But the latter field has exactly one extension
  $\FF_{p^n} / \FF_p$ for each degree $n$, thus there is a \emph{unique}
  unramified extension $L_n/\QQ_p$ of any given degree $n$.

  It is $L_n = \QQ_p (\zeta_{p^n-1})$, obtained by adjoining $(p^n - 1)$-roots
  of unity. It is a cyclic Galois extension and its Galois group
  $\Gal (L_n / \QQ_p)$ is generated by the Frobenius automorphism $\phi_n$ which
  induces the usual Frobenius on $\FF_{p^n} / \FF_p$:

  \[ \phi_n (x) \equiv x^{p^n} \pmod{p} \quad \text{for all }x \in \mathcal{O}_{L_n}. \qedhere \]
\end{example}

\begin{example}
  Let $F$ be a perfect field. Unramified extensions of $F (\!(T)\!)$ are
  isomorphic to $\widetilde{F} (\!(T)\!)$ where $\widetilde{F}$ is an extension
  of $F$.
\end{example}

\begin{theorem}
  Let $L/K$ be a totally ramified extension of a discrete complete local
  field. Then $e = e_{L/K} = [L:K]$, and there exists an
  \term{Eisenstein polynomial}
  $$p (T) = T^e + a_{e-1} T^{e-1} + \cdots + a_1 T + a_0, \quad
  \text{where }\nu_{\pi_K} (a_0) = 1, ~ \nu_{\pi_K} (a_i) \ge 1 \text{ for } i = 1, \ldots, e-1,$$
  such that $L$ is generated by a root of $p (T)$.

  \begin{proof}[Proof]
    We have $L = K (\pi_L)$. Let $\widetilde{L}$ be a finite Galois extension of
    $K$ containing $L$. Let $\pi_L^{(1)}, \ldots, \pi_L^{(e)} \in \widetilde{L}$
    be the conjugates of $\pi_L$ over $K$.

    \begin{claim}
      If $\alpha, \beta \in \overline{K}$ are conjugate over $K$, then
      $|\alpha| = |\beta|$.
    \end{claim}

    Indeed, let $\widetilde{L}$ be a finite Galois extension of $K$ containing
    $\alpha$ and $\beta$. Then there exists an automorphism
    \begin{align*}
      \sigma\colon \widetilde{L} & \to \widetilde{L},\\
      \alpha & \mapsto \beta,
    \end{align*}
    fixing $K$ (that is, $\left.\sigma\right|_K = id$). Since $|\cdot|$ extends
    uniquely to $\widetilde{L}$, this $\sigma$ must preserve the absolute value.

    \vspace{1em}

    So $|\pi_L^{(i)}| = |\pi_L|$. Take $p (T)$ to be the minimal monic
    polynomial of $\pi_L / K$. We have
    $a_0 = \pm \pi_L^{(1)} \cdots \pi_L^{(e)}$, so
    $|a_0| = |\pi_L|^e = |\pi_K|$. Similarly the other $a_i$'s are symmetric
    functions of $\pi_L^{(1)}, \ldots, \pi_L^{(e)}$:
    \begin{align*}
      a_0 & = (-1)^e \, \pi_L^{(1)} \, \pi_L^{(2)} \cdots \pi_L^{(e)},\\
      a_1 & = (-1)^{e-1} \, (\pi_L^{(1)} \, \pi_L^{(2)} \cdots \pi_L^{(e-1)} +
            \pi_L^{(1)} \, \pi_L^{(2)} \cdots \pi_L^{(e-2)}\,\pi_L^{(e)} +
            \cdots +
            \pi_L^{(2)} \, \pi_L^{(3)} \cdots \pi_L^{(e)}), \\
          & \vdots \\
      a_{e-3} & = -(\pi_L^{(1)}\,\pi_L^{(2)}\,\pi_L^{(3)} +
                \pi_L^{(1)}\,\pi_L^{(2)}\,\pi_L^{(4)} + \cdots +
                \pi_L^{(e-2)}\,\pi_L^{(e-1)}\,\pi_L^{(e)}), \\
      a_{e-2} & = \pi_L^{(1)}\,\pi_L^{(2)} + \pi_L^{(1)}\,\pi_L^{(3)} + \cdots +
                \pi_L^{(1)}\,\pi_L^{(e)} +
                \pi_L^{(2)}\,\pi_L^{(3)} + \cdots +
                \alpha_{e-1}\,\alpha_e, \\
      a_{e-1} & = -(\pi_L^{(1)} + \pi_L^{(2)} + \cdots + \pi_L^{(e)}).
    \end{align*}

    We have indeed $\nu_{\pi_K} (a_0) = 1$ and $\nu_{\pi_K} (a_i) \ge 1$ for
    $i = 1, \ldots, e-1$.
  \end{proof}
\end{theorem}

\begin{remark}
  Actually, an extension $L/K$ of discrete complete local fields is totally
  ramified \emph{if and only if} $L = K (\theta)$ with $\theta$ being a root of
  an Eisenstein polynomial.
\end{remark}

\begin{proposition}
  Let $L/K$ be a totally ramified tame extension of a discrete complete local
  field. Then there exists a primitive element $\pi_K$ of $K$ such that
  $\pi_L^e = \pi_K$ where $e = e_{L/K} = [L:K]$. (That is, $\pi_L^e = \pi_K$ for
  these elements, not only $(\pi_L)^e = (\pi_K)$ for the ideals.)

  \begin{proof}
    For $\pi_K$ and $\pi_L$ we have $\pi_L^e = \pi_K \, \eta$ for some
    $\eta \in \mathcal{O}_L^\times$. Since the extension is totally ramified,
    $F_L = F_K$. So there exists $\theta \in \mathcal{O}_K^\times$ such that
    $\eta \equiv \theta \pmod{\pi_L}$. Replacing $\pi_K$ with $\pi_K\,\theta$
    and $\eta$ with $\eta\,\theta^{-1}$, we may assume
    $\eta \equiv 1 \pmod{\pi_L}$.

    \begin{claim}
      If $\fchar F_L \nmid m$, then every $\alpha \in \mathcal{O}_L$ satisfying
      $\alpha \equiv 1 \pmod{I_L}$ is an $m$-th power.
    \end{claim}

    \noindent (Indeed, we can apply Hensel to the polynomial
    $f (X) = X^m - \alpha$ and $\alpha_0 = 1$; by the assumption
    $f^\prime (\alpha_0) = m \not\equiv 0 \pmod{I_m}$.)

    \vspace{1em}

    The claim can be applied since $L/K$ is tame. So $\eta$ is an $e$-th root,
    $\eta = \epsilon^e$ for some $\epsilon \in \mathcal{O}_L^\times$. Replacing $\pi_L$
    with $\pi_L\,\epsilon^{-1}$, we obtain $\pi_L^e = \pi_K$.
  \end{proof}
\end{proposition}

\begin{lemma}\label{lemma:fk-multiplicative}
  Assume we have finite extensions of complete local fields
  $K \subset L \subset M$.

  \[ \xymatrix{
      M\ar@{-}[d]_{e_{M/L}, f_{M/L}} \ar@/^1.5em/@{-}[dd]^{e_{M/K}, f_{M/K}} \\
      L\ar@{-}[d]_{e_{L/K}, f_{L/K}} \\
      K
    } \]

  Then
  \begin{align*}
    f_{M/K} & = f_{L/K} \cdot f_{M/L},\\
    e_{M/K} & = e_{L/K} \cdot e_{M/L}.
  \end{align*}

  In particular, $M/K$ is unramified (totally ramified) iff both $M/L$ and $L/K$
  are unramified (totally ramified).

  \begin{proof}
    By definition $e_{L/K} \dfn [\Gamma_L : \Gamma_K]$. We have a chain of
    subgroups $\Gamma_K \le \Gamma_L \le \Gamma_M$, and
    $$[\Gamma_M : \Gamma_K] = [\Gamma_M : \Gamma_L] \cdot [\Gamma_L : \Gamma_K].$$

    Now $f_{L/K} \dfn [F_L : F_K]$. We have field extensions
    $F_K \subset F_L \subset F_M$, and
    \[ [F_M : F_K] = [F_M : F_L] \cdot [F_L : F_K]. \qedhere \]
  \end{proof}
\end{lemma}

\begin{lemma}\label{lemma:compositum-unramified}
  Let $L/K$ be an unramified extension and let $K_1/K$ be a finite
  extension. Assume $F_L/F_K$ is separable. Then the compositum $LK_1 / K_1$ is
  unramified.

  \[ \xymatrix{
      & L \, K_1\ar@{-}[ddl]_{\underline{\mathrm{unram.}}}\ar@{-}[dr] \\
      & & L\ar@{-}[ddl]^{\mathrm{unram.}} \\
      K_1\ar@{-}[dr] & & \\
      & K
    } \]

  \begin{proof}
    Since $F_L / F_K$ is a finite separable extension, we have
    $F_L = F_K (\overline{\theta})$ for some $\overline{\theta} \in
    F_L$. Consider its lifting $\theta \in \mathcal{O}_L$ and its minimal polynomial
    $p (X) \in \mathcal{O}_K [X]$. Reduce this polynomial modulo $\pi_K$: consider
    $\overline{p} (X) \dfn p (X) \mod \pi_K \in F_K [X]$. Now we have, under our
    assumption that $[L:K] = [F_L:F_K]$,

    \[ [F_L : F_K] \le \deg \overline{p} = \deg {p} =
      [K (\theta) : K] \le [L : K] = [F_L : F_K]. \]

    Hence $L = K (\theta)$ and $\overline{p} (X)$ is the minimal polynomial of
    $\overline{\theta}$ over $F_K$. Thus $L K_1 = K_1 (\theta)$.

    Let $q (x) \in \mathcal{O}_{K_1} [X]$ be the minimal polynomial of $\theta$ over
    $K_1$ and let $\overline{q} (X) \dfn q (X) \pmod \pi_K \in F_{K_1}
    [X]$. This reduced modulo $\pi_K$ polynomial $\overline{q} (X)$ is separable
    as a factor of $\overline{p} (X)$, and so it is irreducible over $F_{K_1}$,
    because otherwise $q (X)$ would be reducible by Hensel's lemma. Now
    \[ [F_{L K_1} : F_{K_1}] \le [L K_1 : K_1] = \deg q =
      \deg \overline{q} = [F_{K_1} (\overline{\theta}) : K_1] =
      [F_{L K_1} : F_{K_1}]. \]
    So $[L K_1 : K_1] = [F_{L K_1} : F_{K_1}]$.
  \end{proof}
\end{lemma}

\vspace{1em}

From these lemmas we have the following.

\begin{proposition}
  Let $L_1/K$ and $L_2/K$ be two unramified extensions. Then their compositum
  $L_1\,L_2$ is unramified as well.

  \[ \xymatrix{
      & L_1 \, L_2\ar@{-}[ddl]\ar@{-}[dr] \\
      & & L_2\ar@{-}[ddl]^{\mathrm{unram.}} \\
      L_1\ar@{-}[dr]_{\mathrm{unram.}} & & \\
      & K
    } \]

  \begin{proof}
    Indeed, the extension $L_1\,L_2 / L_1$ is unramified as well by
    \refref{lemma}{lemma:compositum-unramified}, and so $L_1\,L_2 / K$ is
    unramified by \refref{lemma}{lemma:fk-multiplicative}.
  \end{proof}
\end{proposition}

So there exists a unique \term{maximal unramified extension $K^\mathrm{unr}$} of
a field, given by the compositum of all finite unramified subextensions of
$K^\mathrm{alg}/K$.

Similarly, if $L/K$ is a finite extension, then, taking the compositum of all
its unramified subextensions, we obtain the maximal unramified subextension
$L_0/K$.

\begin{example}
  Let $K = F (\!(T)\!)$ where $F$ is a perfect field. Then the maximal
  unramified extension $K^\mathrm{unr}$ is smaller than
  $F^\mathrm{alg} (\!(T)\!)$: it is given by series whose coefficients lie in a
  finite extension of $F$:
  $$K^\mathrm{unr} = \{ x (T) = \sum_{n \ge 0} a_n \, T^n \in F^\mathrm{alg} (\!(T)\!) \mid [F (a_0, a_1, \ldots) : F] < \infty \}.$$

  This is not a complete field: it is easy to give a Cauchy sequence $(x_n (T))$
  not converging to an element of $K^\mathrm{unr}$; e.g. one can take
  $$x_n (T) \dfn \sum_{0 \le k \le n} \sqrt{k} \, T^k.$$

  If we consider the completion of $K^\mathrm{unr}$, then we obtain
  $F^\mathrm{alg} (\!(T)\!)$.
\end{example}

\begin{example}
  The maximal unramified extension of $\QQ_p$ is obtained by adjoining all roots
  of unity $\zeta_n$ of order $n$ prime to $p$ (see
  \refref{example}{example:unramified-extensions-of-Qp} above; note that
  $(p,n) = 1$ implies $p^{\phi (n)} - 1\equiv 0 \pmod{n}$).
\end{example}

\section{Absolute values on incomplete fields}
\label{section:absolute-values-embeddings}

We have mentioned before (p. \pageref{complete-abs-extension}) that for an
extension of complete fields $L/K$ an absolute value on $K$ uniquely extends to
$L$. Now we drop the assumption that $K$ is complete. Suppose it is a field with
an absolute value $|\cdot|_v$ and $L/K$ is a finite extension. How $|\cdot|_v$
extends to $L$?

\vspace{1em}

For an absolute value $|\cdot|_v$ let $K_v$ be the completion of $K$ with
respect to $|\cdot|_v$ and let $\overline{K_v}$ be an algebraic closure of this
completion. Now $|\cdot|_v$ extends uniquely on $K_v$, and then on
$\overline{K_v}$. Denote $|\cdot|_{\overline{v}}$ the corresponding absolute
value on $\overline{K_v}$ (but be careful: $\overline{K_v}$ is \emph{not}
complete with respect to $|\cdot|_{\overline{v}}$).

Now for a finite extension $L/K$ we can choose an embedding
$\sigma\colon L \to \overline{K_v}$ and using this define an absolute value on
$L$:
$$|x|_w \dfn |\sigma (x)|_{\overline{v}}.$$

One can consider the completion $L_w$ of $L$ with respect to $w$. There is a
(continuous) embedding $\sigma\colon L_w \to \overline{K_v}$ induced by
$\sigma$:
\begin{align*}
  L_w & \hookrightarrow \overline{K_v}, \\
  \lim x_n \text{ w.r.t. } |\cdot|_w & \mapsto \lim \sigma (x_n) \text{ w.r.t. } |\cdot|_{\overline{v}}.
\end{align*}

Extending an absolute value $|\cdot|_v$ to $L$ corresponds to choosing an
embedding $L \hookrightarrow \overline{K_v}$ because of the following
commutative diagram:
\[ \xymatrix{
    L\ar@{^(->}[r] & L_w \ar@{^(->}[r]^{\sigma} & \overline{K_v} \\
    K \ar@{^(->}[r]\ar@{^(->}[u] & K_v\ar@{^(->}[u]\ar@{_(->}[ur]
  } \]

For $x \in L_w$ one must have $|x|_w = |\sigma (x)|_{\overline{v}}$.

\begin{example}
  The main example is given by the absolute values on number fields.

  Let $K = \QQ$ and let $L = \QQ (\alpha)$ where $\alpha$ is a root of
  polynomial $T^2 - 2$. Consider the usual archimedian absolute value
  $|\cdot|_\infty$ on $\QQ$. It extends uniquely to $\mathbb{C}$. There are two
  embeddings of $L$ in $\mathbb{C}$, given by two roots of $T^2 - 2$:
  \begin{align*}
    \sigma_{1,2}\colon L & \to \mathbb{C}, \\
    \sigma_1\colon \alpha & \mapsto + \sqrt{2}, \\
    \sigma_2\colon \alpha & \mapsto - \sqrt{2}.
  \end{align*}

  And this gives rise to two distinct absolute values
  $$|x|_{w_1} \dfn |\sigma_1 (x)|_\infty, \quad |x|_{w_2} \dfn |\sigma_2 (x)|_\infty.$$

  They indeed differ: for the element $x = 1 + \alpha$ one has
  $|x|_{w_1} = 1 + \sqrt{2}$ and $|x|_{w_2} = \sqrt{2} - 1$.

  \vspace{1em}

  Now let $\alpha$ be a root of $T^2 + 1$. Then the embeddings are
  $$\sigma_{1,2}\colon \alpha \mapsto \pm i.$$

  But $\sigma_1$ and $\sigma_2$ give rise to the same absolute value, because
  they are conjugate by the action of $\Gal (\mathbb{C}/\mathbb{R})$!
\end{example}

Now let $L/K$ be a field extension of degree $n = [L:K]$. Then there are $n$
distinct embeddings
$$\sigma_i\colon L \hookrightarrow \overline{K_v},$$
leaving $K$ fixed.

Each $\sigma_i$ gives rise to an extension of $|\cdot|_v$ to $L$, and every
extension of an absolute value is obtained this way. So we see that there are
\emph{at most} $n$ extensions of an absolute value on $K$. However, the last
example shows that distinct embeddings $L \hookrightarrow \overline{K_v}$ can
give rise to the same absolute value.

\begin{theorem}
  Let $\sigma_1, \ldots, \sigma_n$ be embeddings
  $L \hookrightarrow \overline{K_v}$ fixing $K$. Consider the following
  equivalence relation: $\sigma_i \sim \sigma_j$ if there is
  $\tau \in \Gal (\overline{K_v}/K_v)$ such that $\sigma_j = \tau\circ\sigma_i$.

  \[ \xymatrix{
      L\ar@{^(->}[r]^{\sigma_i}\ar@{_(->}@/_1.5em/[rr]_{\sigma_j} & \overline{K_v}\ar[r]^{\tau} & \overline{K_v}
    } \]

  There is one-to-one correspondence between extensions of $|\cdot|_v$ to $L$
  and equivalence classes of embeddings
  $\sigma_i\colon L \hookrightarrow \overline{K_v}$.

  \begin{proof}
    It is clear that equivalent embeddings give rise to the same absolute
    values. Indeed,
    $|\sigma (x)|_{\overline{v}} = |\tau\sigma (x)|_{\overline{v}}$ since
    conjugate elements have the same absolute value.

    \vspace{1em}

    Now consider two embeddings $\sigma_i, \sigma_j\colon L\to \overline{K_v}$
    such that
    $|\sigma_i (\cdot)|_{\overline{v}} = |\sigma_j (\cdot)|_{\overline{v}}$. We
    want to show that $\sigma_i$ and $\sigma_j$ are conjugate. Consider the
    isomorphism $\tau\colon \sigma_i (L) \to \sigma_j (L)$ given by
    $\tau \dfn \sigma_j\circ \sigma_i^{-1}$. We extend this to an isomorphism
    $\tau\colon \sigma_i (L) \cdot K_v \to \sigma_j (L) \cdot K_v$, and then to
    $\overline{\tau}\colon \overline{K_v} \to \overline{K_v}$ leaving $K_v$
    fixed.

    \[ \xymatrix{
        \overline{K_v}\ar@{-->}[r]^{\overline{\tau}} & \overline{K_v} \\
        \sigma_i (L)\cdot K_v\ar@{-->}[r]^\tau\ar@{^(->}[u] & \sigma_j (L)\cdot K_v\ar@{^(->}[u] \\
        \sigma_i (L)\ar[r]^\tau_\isom\ar@{^(->}[u] & \sigma_j (L)\ar@{^(->}[u] \\
        L\ar[u]^\isom\ar@/^3em/[uuu]^{\sigma_i}\ar@{=}[r] & L\ar[u]_\isom\ar@/_3em/[uuu]_{\sigma_j}
      } \]

    $\sigma_i (L)$ is dense in $\sigma_i (L)\cdot K_v$, so every element
    $x \in \sigma_i (L)\cdot K_v$ can be written as a limit
    $$x = \lim_{n\to\infty} \sigma_i (x_n)$$
    for some sequence $(x_n)$ which belongs to a finite subextension of $L$.
    Now since
    $|\sigma_i (\cdot)|_{\overline{v}} = |\sigma_j (\cdot)|_{\overline{v}}$, the
    sequence
    $$\lim_{n\to\infty} \sigma_j (x_n) = \lim_{n\to \infty} \tau (\sigma_i (x_n))$$
    converges to some element $\tau (x)$ in $\sigma_j (L)\cdot K_v$. This
    correspondence gives a well-defined isomorphism
    \begin{align*}
      \tau\colon \sigma_i (L)\cdot K_v & \to \sigma_j (L)\cdot K_v,\\
      x & \mapsto \tau (x)
    \end{align*}
    (we check that it does not depend on the choice of the sequence $(x_n)$),
    which leaves $K_v$ fixed. This extends to an automorphism
    $\overline{\tau} \in \Gal (\overline{K_v} / K_v)$, and
    $\sigma_j = \overline{\tau}\circ \sigma_i$.
  \end{proof}
\end{theorem}

\vspace{1em}

Let $L/K$ be a separable extension, so $L = K(\alpha)$. Let $f (T)$ be the
minimal polynomial of $\alpha$, having roots $\alpha_1, \ldots, \alpha_n$ in
$\overline{K_v}$. Then there are $n$ embeddings
\begin{align*}
  \sigma_i\colon L & \to \overline{K_v},\\
  \alpha & \mapsto \alpha_i.
\end{align*}

Now pairwise nonequivalent embeddings correspond to roots $\alpha_i$ that are
pairwise nonconjugate over $K_v$. This means that over $K_v$ the minimal
polynomial factors into irreducible polynomials
$$f (T) = f_1 (T) \cdots f_s (T),$$
where $\alpha_i$ is a root of $f_i$. So picking roots of
$f_1 (T), \ldots, f_s (T)$, we obtain different extensions of the absolute value
$|\cdot|_{w_1}, \ldots, |\cdot|_{w_s}$. One has
$\deg f_i = [K_v (\alpha_i) : K_v]$.

\begin{theorem}\label{theorem:local-degrees-global-degree}
  Let $L/K$ be a finite separable extension and let $|\cdot|_v$ be an absolute
  value on $K$. Let $|\cdot|_{w_1}, \ldots, |\cdot|_{w_s}$ be extensions of
  $|\cdot|_v$ to $L$. Then

  \[ \sum_{1 \le i \le s} [K_v (\alpha_i) : K_v] = [L : K]. \]
\end{theorem}

Indeed,
\[ \sum_{1 \le i \le s} [K_v (\alpha_i) : K_v] = \sum_{1 \le i \le s} \deg f_i = \deg f. \]

So \emph{the sum of local degrees equals the global degree}. This is a principle
occurring in many areas of mathematics! See the remark on
p. \pageref{remark:local-degrees-global-degree-number-fields} for an example in
the number field case.

\pagebreak

\part{Skolem--Mahler--Lech theorem}

In \refref{\S}{section:skolem-mahler-lech} we are going to see another
interesting theorem which is proved using $p$-adic numbers. We will need to work
with expressions like ``$\lambda^n$'', but in the $p$-adic setting, where both
$\lambda$ and $n$ are $p$-adic numbers. To make sense of this, we can introduce
exponential and logarithm and put
$\text{``}\lambda^n\text{''} = \exp (n\,\log\lambda)$. As usual
(for $p = \infty$) these can be defined using the well-known power series, but
we need some work to establish convergency and basic properties.

\section{Nonarchimedian logarithm and exponential}

Now let $K$ be a complete nonarchimedian local field of characteristic $0$ (we
will manipulate with power series having $n$ or $n!$ in denominator, so this
restriction is vital). Let $F_K$ be its residue field, having characteristic
$\fchar F_K = p > 0$.

We have the minimal subfield $\QQ \subset K$, and since $K$ is complete with
$\fchar F_K = p$, the absolute value on $K$ restricted to $\QQ$ is $p$-adic,
thus $K$ contains $\QQ_p$. We normalize the absolute value to coincide with the
standard $p$-adic absolute value on $\QQ_p$, i.e. $|p|_v = |p|_p = \frac{1}{p}$.

In the subsequent proofs we will need an upper bound on the $p$-adic valuation
$\nu_p (n!)$ of a factorial. First, it is easy to see that
\[ \tag{*} \nu_p (n!) =
  \left\lfloor\frac{n}{p}\right\rfloor +
  \left\lfloor\frac{n}{p^2}\right\rfloor +
  \left\lfloor\frac{n}{p^3}\right\rfloor + \cdots \]

This is better to demonstrate by a concrete example. Suppose we want to compute
$\nu_2 (10!)$. Then we should count all even numbers $2, 4, 6, 8, 10$, two
numbers $4, 8$ divisible by $2^2$, and number $8$ divisible by $2^3$, so totally
$\nu_2 (10!) = 5 + 2 + 1 = 8$.

\begin{example}
  Let us calculate how many zeros there are at the end of the decimal expansion
  of $100!$, which is a huge number.

  \[ \nu_5 (100!) =
    \underbrace{\left\lfloor\frac{100}{5}\right\rfloor}_{20} +
    \underbrace{\left\lfloor\frac{100}{5^2}\right\rfloor}_4 = 24. \]

  \[ \nu_2 (100!) =
    \underbrace{\left\lfloor\frac{100}{2}\right\rfloor}_{50} +
    \underbrace{\left\lfloor\frac{100}{2^2}\right\rfloor}_{25} +
    \underbrace{\left\lfloor\frac{100}{2^3}\right\rfloor}_{12} +
    \underbrace{\left\lfloor\frac{100}{2^4}\right\rfloor}_6 +
    \underbrace{\left\lfloor\frac{100}{2^5}\right\rfloor}_3 +
    \underbrace{\left\lfloor\frac{100}{2^6}\right\rfloor}_1 = 97. \]

  So we conclude that there are $\min \{ \nu_5 (100!), \nu_2 (100!) \} = 24$
  zeros at the end.
\end{example}

The sum (*) appears to be infinite, but of course it ends with zero terms, since
we take $\lfloor\cdot\rfloor$. Looking at the corresponding infinite sum, we
obtain a strict upper bound
$$\nu_p (n!) < n \, \left(\frac{1}{p} + \frac{1}{p^2} + \cdots\right) = \frac{n}{p-1}.$$

The same inequality for absolute values looks like
$$|n!|_p > \rho_p^n, \quad \text{where } \rho_p = p^{-\frac{1}{p-1}}.$$

We will need a similar bound (with non-strict inequality).

\begin{lemma}
  $$\nu_p (n!) \le \frac{n-1}{p-1}.$$
  That is, $|n!|_p \ge \rho_p^{n-1}$.

  \begin{proof}
    For $n = 2$ we obviously have $\nu_2 (2!) = 1$ and $\nu_p (2!) = 0$ for
    $p > 2$, so the lemma holds.

    \noindent\underline{If $p \nmid n$, then $ \nu_p (n) = 0$} and by induction
    $ \nu_p (n!) = \nu_p ((n-1)!) \le \frac{n-1}{p-1}$.

    \vspace{1em}

    \noindent\underline{If $p \mid n$ but $p^2 \nmid n$, then $ \nu_p (n) = 1$}.
    Observe that
    $$n! = (n-p)! \cdot \underbrace{(n-p+1) \cdots (n-1) }_{\text{not divisible by }p}\cdot n,$$
    so we get (using $\nu_p ((n-p)!) < \frac{n-p}{p-1}$)
    $$\nu_p (n!) =  \nu_p ((n-p)!) + 1 \le \frac{n-p}{p-1} + 1 = \frac{n-1}{p-1}.$$

    \vspace{1em}

    \noindent\underline{If $ \nu_p (n) = 2$}, then
    $$n! = (n-p^2)! \cdot \underbrace{(n-p^2+1) \cdots (n-1) \cdot n}.$$
    The multipliers $(n-p^2+1)$, $(n-p^2+2)$, $\ldots$, $n-1$, $n$ in the
    ``tail'' modulo $p^2$ give $1$, $2$, $\ldots$, $p^2 - 1$, $0$. One has
    $$\nu_p (n!) =  \nu_p ((n-p^2)!) + (p-1) + 2 \le \frac{n-p^2}{p-1} + p + 1 = \frac{n-1}{p-1}.$$

    \vspace{1em}

    \noindent . . . . .

    \vspace{1em}

    \noindent\underline{Along the same lines, for $ \nu_p (n) = k$} one gets
    \[ \nu_p (n!) =
      \nu_p ((n-p^k)!) + p^{k-1} + p^{k-2} + \cdots + p + 1 \le
      \frac{n - p^k}{p-1} + \frac{p^k - 1}{p - 1} =
      \frac{n-1}{p-1}. \qedhere \]
  \end{proof}
\end{lemma}

\begin{remark}
  \label{remark:factorial-and-sum-of-digits}
  One can also show the following: if $n$ has $p$-adic expansion
  $a_0 + a_1\,p + a_2\,p^2 + \cdots + a_k\,p^k$, then
  $$\nu_p (n!) = \frac{n - (a_0 + \cdots + a_k)}{p-1}.$$

  Since among $a_0, \ldots, a_k$ at least one is nonzero, this gives the bound
  that we just proved.
\end{remark}

\begin{definition}
  The \term{exponential} of $z \in K$ is given by the power series
  $$\exp (z) \dfn \sum_{n \ge 0} \frac{z^n}{n!}.$$
\end{definition}

For $|z|_p < \rho_p$ this series converges, since in this case
$$\left|\frac{z^n}{n!}\right| < \left(\frac{|z|}{\rho_p}\right)^n \xrightarrow{n\to\infty} 0.$$
So we consider the exponential on the disk $D (0, \rho_p)$ centered in $0$
having radius $\rho_p$. Observe that $D (0, \rho_p)$ is a group under addition,
since $|z_1| < \rho_p$ and $|z_2| < \rho_p$ implies $|z_1+z_2| < \rho_p$.

The usual properties of exponential hold---because they are proved by formal
manipulations with power series. For instance,
$$\exp (z_1) \cdot \exp (z_2) = \exp (z_1+z_2) \quad \text{for }z_1, z_2 \in D (0,\rho_p).$$
Indeed,
\begin{align*}
  \exp (z_1) \cdot \exp (z_2) & = \left(\sum_{k \ge 0} \frac{z_1^k}{k!}\right) \cdot \left(\sum_{\ell \ge 0} \frac{z_2^\ell}{\ell!}\right)\\
                              & = \sum_{n \ge 0} \sum_{k+\ell = n} \frac{n!}{n!} \frac{z_1^k}{k!} \frac{z_2^\ell}{\ell!} \\
                              & = \sum_{n \ge 0} \frac{1}{n!} \sum_{k \ge 0} {n \choose k} \, z_1^k \, z_2^{n-k} \\
                              & = \sum_{n \ge 0} \frac{(z_1+z_2)^n}{n!} = \exp (z_1+z_2).
\end{align*}

In particular, $\exp (-z) = \exp (z)^{-1}$, and we have a group homomorphism
$$\exp\colon (D (0,\rho_p), +) \to K^\times.$$

\begin{lemma}
  For $z \in D (0,\rho_p)$ one has $|\exp (z) - 1|_p = |z|_p$.

  \begin{proof}
    Consider
    \[ \tag{*} \exp (z) - 1 = z + \sum_{n \ge 2} \frac{z^n}{n!}. \]

    We claim that each sum term has $p$-adic absolute value less than
    $|z|_p$. Indeed,
    \[ \left|\frac{z^n}{n!}\right|_p =
      |z|_p \cdot \left|\frac{z^{n-1}}{n!}\right|_p \le
      |z|_p \cdot \left(\frac{|z|_p}{\rho_p}\right)^{n-1} < |z|_p \]
    (where we use the bound $|n!|_p \ge \rho_p^{n-1}$ proved above). Now taking
    absolute values of the left hand side and the right hand side of (*), we are
    done.
  \end{proof}
\end{lemma}

From this we see that
$$\exp (z) = 1 \iff z = 0 \quad \text{for } z\in D (0,\rho_p),$$
so the exponential is a monomorphism
$(D (0,\rho_p),+) \hookrightarrow K^\times$. Moreover, the inequality
$$|\exp (z) - 1|_p = |z|_p < \rho_p$$
means that the image of exponential is in $D (1,\rho_p)$, and the latter is a
group under multiplication: if $|z_1 - 1|_p < \rho_p$ and
$|z_2 - 1|_p < \rho_p$, then $|z_1 z_2 - 1|_p < \rho_p$ and
$|z_1^{-1} - 1| < \rho_p$.

So we can look at the exponential as a group homomorphism
$$\exp\colon (D (0,\rho_p), +) \to (D (1,\rho_p), \cdot).$$

Our goal is to show that this is actually an isomorphism, that is, to find the
inverse to the exponential. But as we know, the inverse is the logarithm!

\begin{definition}
  For $z\in K$ the \term{logarithm} is given by the power series
  $$\log (z) \dfn \sum_{n \ge 1} (-1)^{n-1} \, \frac{(z-1)^n}{n}.$$
\end{definition}

This series converges for $|z - 1|_p < 1$. To see this, recall some analysis.

\begin{proposition}
  For a $p$-adic power series $\sum_{n \ge 0} \alpha_n\,z^n$ the \term{radius of
    convergence} is given by
  $$r\dfn \frac{1}{\limsup |\alpha_n|_p^{1/n}}.$$

  \begin{enumerate}
  \item The series converges if $|z|_p < r$.

  \item The series diverges if $|z|_p > r$.

  \item If the series converges (diverges) for some $z_0$ with $|z_0|_p = r$,
    then it converges (diverges) for all $z$ with $|z|_p = r$.
  \end{enumerate}

  \begin{proof}
    This is because one has
    \[ |\alpha_n \, z^n|_p = |\alpha_n|_p \cdot |z|_p^n \ge
      \left(\frac{|z|_p}{r}\right)^n. \qedhere \]
  \end{proof}
\end{proposition}

\begin{example}
  Let's compute the radius of convergence for the power series
  \[ \exp (z) \dfn \sum_{n \ge 0} \frac{z^n}{n!}, \quad
    \log (z + 1) \dfn \sum_{n \ge 1} (-1)^{n-1} \, \frac{z^n}{n}. \]

  For the exponential we get
  \[ \limsup \left|\frac{1}{n!}\right|^{1/n}_p =
    \limsup \left(p^{\frac{n - s(n)}{p-1}}\right)^{1/n}, \]
  where $s (n)$ is the sum of $p$-adic digits of $n$
  (\refref{remark}{remark:factorial-and-sum-of-digits} above), so
  \[ \limsup \left|\frac{1}{n!}\right|^{1/n}_p =
    \limsup p^{\frac{1 - s(n)/n}{p-1}} = p^{\frac{1}{p-1}}, \]
  and the radius of convergence for the exponential is
  $p^{-\frac{1}{p-1}} \rdfn \rho_p$.

  \vspace{1em}

  For the logarithm
  $$\limsup \left|\frac{1}{n}\right|^{1/n}_p = \limsup p^{\nu_p (n)/n} = 1,$$
  so the radius of convergence is $1$.
\end{example}

Our $p$-adic logarithm has the expected properties, e.g.
$$\log (z_1\,z_2) = \log (z_1) + \log (z_2).$$

The series converges on $D (1,1)$; however, defined on this domain, the
logarithm has a nontrivial kernel.

\begin{example}
  Let $p = 2$. Then $-1 \in D (1,1)$ since $|-1-1|_p = \frac{1}{2}$. Now
  $$\log (-1) + \log (-1) = \log ((-1)\cdot(-1)) = \log 1 = 0,$$
  thus $\log (-1) = 0$. Similarly, if $\zeta_p \in \overline{\QQ_p}$ is a
  $p$-th root of unity, then $\log \zeta_p = 0$.
\end{example}

To fix the issue, we look at the logarithm on the disk $D (1, \rho_p)$.

\begin{proposition}
  If $|z-1|_p < \rho_p$, then $|\log z|_p = |z-1|_p$. In particular,
  $\log z = 0$ iff $z = 1$ on $D (1, \rho_p)$.
\end{proposition}

\noindent (Actually, $|\zeta_p - 1|_p = \rho_p$, so the proposition cannot be
improved.)

\begin{lemma}
  If $0 < |z|_p < \rho_p$, then $\left|\frac{z^n}{n}\right|_p < |z|_p$ for
  $n \ge 2$.
\end{lemma}

This lemma implies immediately the proposition, because one can take absolute
values of the equation
$$\log z = (z-1) + \sum_{n \ge 2} (-1)^{n-1} \, \frac{(z-1)^n}{n}.$$

\begin{proof}[Proof of the lemma]
  Assume $1 < n < p$. Then $|n|_p = 1$ and
  $$\left|\frac{z^n}{n}\right|_p = |z|_p^n < |z|_p.$$

  Now assume $n \ge p$. Then
  $$n^{\frac{1}{n-1}} \le p^{\frac{1}{p-1}}.$$

  Next (using $|n|_p \ge n^{-1}$)
  \[ \left|\frac{z^n}{n}\right|_p =
    |z|_p \cdot \left|\frac{z^{n-1}}{n}\right|_p \le |z|_p \cdot n \cdot |z|_p^{n-1} <
    |z|_p \, \left(n^{\frac{1}{{n-1}}} \, \rho_p\right)^{n-1} =
    |z|_p \, \left(\frac{n^{\frac{1}{n-1}}}{p^{\frac{1}{p-1}}}\right)^{n-1} \le
    |z|_p. \qedhere \]
\end{proof}

Further, by manipulations with power series we can check that
\begin{align*}
  \log \exp z & = z, \quad \text{for }|z|_p < \rho_p,\\
  \exp \log z & = z, \quad \text{for }|z - 1|_p < \rho_p.
\end{align*}

Thus we finally obtained a group isomorphism
$$\xymatrix{D (0,\rho_p)\ar@<+0.2em>[r]^\exp & D (1, \rho_p)\ar@<+0.2em>[l]^\log}$$

If $\fchar F_K = 0$, then one can define $\exp (z)$ for $|z| < 1$ and $\log (z)$
for $|z - 1| < 1$, giving an isomorphism $D (0,1) \isom D (1,1)$.

\section{Skolem--Mahler--Lech theorem}
\label{section:skolem-mahler-lech}

We are going to discuss certain properties of the so-called ``linear
recurrences''.

\begin{definition}
  A sequence of complex numbers $(u_n)_{n \in \ZZ}$, $u_n \in \mathbb{C}$ is
  called a \term{linear recurrence} of order $m$ if there exist numbers
  $\alpha_0, \ldots, \alpha_m \in \mathbb{C}$, where $\alpha_0, \alpha_m \ne 0$,
  such that for all $n \in \ZZ$

  \[ \alpha_0\,u_n + \alpha_1\,u_{n+1} + \cdots + \alpha_m\,u_{n+m} = 0. \]
\end{definition}

\begin{example}
  Probably the most famous example are the \term{Fibonacci numbers}. They are
  defined by a linear relation $u_n + u_{n+1} - u_{n+2} = 0$ and we set
  $u_0 \dfn 0$, $u_1 \dfn 1$.

  \begin{center}
    \begin{tabular}{x{0.65cm}x{0.65cm}x{0.65cm}x{0.65cm}x{0.65cm}x{0.65cm}x{0.65cm}x{0.65cm}x{0.65cm}x{0.65cm}x{0.65cm}x{0.65cm}x{0.65cm}}
      $\cdots$ & $u_{-5}$ & $u_{-4}$ & $u_{-3}$ & $u_{-2}$ & $u_{-1}$ & $u_0$ & $u_1$ & $u_2$ & $u_3$ & $u_4$ & $u_5$ & $\cdots$ \tabularnewline\hline
      $\cdots$ & $5$ & $-3$ & $2$ & $-1$ & $1$ & $0$ & $1$ & $1$ & $2$ & $3$ & $5$ & $\cdots$
    \end{tabular}
  \end{center}
\end{example}

For a linear recurrence $(u_n)$ we are interested in the set
$\{ n \in \ZZ \mid u_n = 0 \}$. We will say that it is the \term{solution} of
the equation $u_n = 0$ (with respect to $n$). In the case of Fibonacci numbers,
this is just $\{ 0 \}$. But of course this can be an infinite set as well.

\begin{example}
  A linear recurrence given by $u_{n+2} - u_n = 0$ and $u_0 \dfn 0$,
  $u_1 \dfn 1$ is the sequence

  \[ u_n = \left\{\begin{array}{ll}
                    0, & n \text{ even},\\
                    1, & n \text{ odd}.
                  \end{array}\right. \]

  In this case the solution is $2\ZZ$. Similarly, for any
  $N = 1, 2, 3, \ldots$ and $a \in \ZZ$, the set $a + N \ZZ$ can occur as a
  solution.
\end{example}

If $(u_n)$ and $(v_n)$ are linear recurrences, then $(u_n\,v_n)$ and
$(u_n + v_n)$ are linear recurrences as well. If $A$ is the solution of $(u_n)$
and $B$ is the solution of $(v_n)$, then $A \cup B$ is the solution of
$(u_n v_n)$.

\begin{remark}\label{remark:linear-recurrences-generating-functions}
  The following are equivalent:
  \begin{enumerate}
  \item[(1)] $(u_n)$ is a linear recurrence, i.e. it is given by relations
    $\alpha_0\,u_n + \alpha_1\,u_{n+1} + \cdots + \alpha_m\,u_{n+m} = 0$.

  \item[(2)] $u_n = \sum_{1 \le i \le s} p_i (n) \, \lambda_i^n$ for some
    numbers $\lambda_i \in \mathbb{C}$ and polynomials $p_i \in \mathbb{C} [X]$.

  \item[(3)] The generating function $\sum_{n \ge 0} u_n \, X^n$ is rational,
    i.e. equal to $\frac{p (X)}{q (X)}$ for some $p, q \in \mathbb{C} [X]$.
  \end{enumerate}

  In particular, the implication $(1) \Rightarrow (2)$ will be seen below. From
  (2) it is clear why for linear recurrences $(u_n)$ and $(v_n)$ the product
  $(u_n\,v_n)$ is again a linear recurrence. Observe that for (3) this gives an
  interesting property: if $\sum_{n \ge 0} u_n \, X^n$ and
  $\sum_{n \ge 0} v_n \, X^n$ are rational generating functions, then their
  ``Hadamard product'' $\sum_{n \ge 0} u_n\,v_n \, X^n$ is rational as well.
\end{remark}

From the example above we see that a linear recurrence can give a solution which
is a finite union of ``residue classes'' $a + N \ZZ$. Also some finite set
trivially can be a solution. Is it possible to have something more
sophisticated? For instance, can there be a linear recurrence having as its
solution the squares $1, 4, 9, 16, 25, \ldots$, or the primes
$2, 3, 5, 7, 11, \ldots$? The answer is \emph{no}.

\begin{theorem}[Skolem--Mahler--Lech]
  Let $(u_n)$ be a linear recurrence. Then there exists $N \in \ZZ_{\ge 1}$ and
  $S \subseteq \{ 0, 1, \ldots, N-1 \}$ (possibly $S = \emptyset$) and a finite
  set $T \subset \ZZ$ such that
  $$u_n = 0 \iff n\in T \cup (S + N \ZZ).$$
\end{theorem}

The theorem is named after a Norwegian mathematician Thoralf Skolem (who gave a
proof for linear recurrences over $\QQ$; 1933), a German mathematician Kurt
Mahler (who gave a proof for $\overline{\QQ}$; 1935), and a Swedish
mathematician Christer Lech (who gave a proof for any field of characteristic
$0$). For historical matters see \emph{Christer Lech, A note on recurring
  series, Arkiv f\"or Matematik 2 (1953), issue 5, 417--421},
\url{http://dx.doi.org/10.1007/BF02590997}

We are going to see a very interesting proof which uses $p$-adic analysis.
We start with some general facts about linear recurrences.

\begin{example}
  Recall that for the Fibonacci sequence we have the formulas giving the $n$-th
  term explicitly:
  \[ u_n = \frac{\alpha^n - \beta^n}{\sqrt{5}}, \quad
    \alpha \dfn \frac{1 + \sqrt{5}}{2}, ~
    \beta \dfn \frac{1 - \sqrt{5}}{2}. \qedhere \]
\end{example}

We can write down such a formula for any linear recurrence.

\vspace{1em}

Fix $\alpha_0, \ldots, \alpha_m \in \mathbb{C}$ and let
$$U \dfn \{ (u_n)_{n \in \ZZ} \mid \alpha_0 \, u_n + \cdots + \alpha_m \, u_{n+m} = 0 \}.$$

This is a $\mathbb{C}$-vector space of dimension $m$, since each sequence is
completely determined by $u_0, \ldots, u_{m-1}$. We are interested in a nice
basis for $U$.

Consider the polynomial
$\chi (T) = \alpha_m T^m + \cdots + \alpha_1 T + \alpha_0$. If $\lambda$ is a
root of $\chi (T)$, then $(\lambda^n)_{n\in \ZZ} \in U$, because

\[ \alpha_m \, \lambda^{n+m} + \alpha_{m-1}\,\lambda^{n+m-1} + \cdots + \alpha_0 =
  \lambda^n \, \chi (\lambda) = 0. \]

If $\chi (T)$ has $m$ \emph{distinct} roots $\lambda_1, \ldots, \lambda_m$, then
$\{(\lambda_{i}^{n})\}_{1\leq i\leq m}$ forms a basis of $U$. Assume now that
$\lambda$ is a \emph{multiple} root of $\chi (T)$, i.e.
$\chi (\lambda) = \chi^\prime (\lambda) = 0$. Then the polynomial
$T^n \, \chi (T)$ also has $\lambda$ as a multiple root, so
$(T^n \, \chi (T))^\prime_{T = \lambda} = 0$.

\[ \alpha_m \, (n+m) \, \lambda^{n+m-1} + \alpha_{m-1}\,(n+m-1)\,\lambda^{n+m-2} + \cdots + \alpha_0\,n\,\lambda^{n-1} = 0. \]

So $(n\,\lambda^{n-1}) \in U$, and also $(n\,\lambda^n) \in U$. If $\lambda$ is
a root of order $\ge 3$, then $(n^2\,\lambda^n) \in U$, and so on. If $\lambda$
is a root of order $\mu$, then $(n^k\,\lambda^n) \in U$ for
$k = 0, 1, \ldots, \mu-1$. Thus when $\chi (T)$ has roots
$\lambda_1, \ldots, \lambda_s$ of order $\mu_1, \ldots, \mu_s$ (with
$\mu_1 + \cdots + \mu_s = m$), there is a basis of $U$ given by
$(n^k \, \lambda_i^n)_{0 \le k \le \mu_i - 1}^{1 \le i \le s}$.

\begin{theorem}
  Let $(u_n)$ be a linear recurrence of order $m$. Then there exist numbers
  $\lambda_1, \ldots, \lambda_s$ and polynomials $p_1 (T), \ldots, p_s (T)$ with
  $\sum_{1 \le i \le s} (\deg p_i + 1) \le m$ such that

  \[ u_n = p_1 (n) \, \lambda_1^n + \cdots + p_s (n) \, \lambda_s^n. \]
\end{theorem}

From now on we are going to work with recurrences of this form. So the fact that
is equivalent to the Skolem--Mahler--Lech theorem is the following.

\emph{Let $p_1 (T), \ldots, p_s (T) \in \mathbb{C} [T]$ be some polynomials and
  let $\lambda_1, \ldots, \lambda_s \in \mathbb{C}^\times$ be pairwise distinct
  numbers. Then there exists $N \in \ZZ_{\ge 1}$ and
  $S \subset \{ 0, 1, \ldots, N-1 \}$ together with a finite set $T \subset \ZZ$
  such that}
\[ p_1 (n) \, \lambda_1^n + \cdots + p_s (n) \, \lambda_s^n = 0 \iff n \in T \cup (S + N\ZZ). \]

We will prove this under an additional assumption that
$p_s (T) \in \overline{\QQ} [T]$ and
$\lambda_1, \ldots, \lambda_s \in \overline{\QQ}^\times$. The general case can
be reduced to this, but we are not going to discuss the reduction.

\vspace{1em}

Under our assumption, there is some number field $K$ such that
$p_i (T) \in K [T]$ and $\lambda_i \in K^\times$. The rough idea of the proof is
that one can consider the equation
$$u (n) \dfn p_1 (n) \, \lambda_1^n + \cdots + p_s (n) \, \lambda_s^n = 0,$$
but treating $u (n)$ as an analytic function on $\ZZ_p$, not as a function on
$\ZZ$. For this one should make sense of taking exponents ``$\lambda_i^n$''.
Of course ``$\lambda_i^n = \exp (n \, \log \lambda_i)$'', and we have seen what
is the exponential and logarithm in the nonarchimedian setting. However, $\log$
is defined only on the disk $D (1, \rho_p)$, and this is a problem one has to
fix.

\vspace{1em}

Let us make it precise what an analytic function is.

\begin{definition}
  Let $K$ be a complete nonarchimedian field. A function
  $f\colon D (a, r) \to K$ on some disk of radius $r$ with center in $a$ is
  called \term{analytic} if
  $$f (z) = \sum_{k \ge 0} \alpha_k \, (z - a)^k,$$
  where the series converges for all $z \in D (a, r)$.
\end{definition}

We need the following property of analytic functions:

\begin{proposition}
  Assume that $f$ is not identically zero. Then the set of zeros of $f$ is
  discrete, in the sense that if $f (z_0) = 0$, then $f (z) \ne 0$ in a
  punctured neighborhood of $z_0$.
\end{proposition}

Using the compactness of $\ZZ_p$, we obtain from this the following.

\begin{corollary}
  Let $f$ be an analytic function on $\ZZ_p$, not identically zero. Then it has
  at most finitely many zeros.
\end{corollary}

Now we go back to the Skolem--Mahler--Lech theorem. We have a function
$u (n) \dfn p_1 (n) \, \lambda_1^n + \cdots + p_s (n) \, \lambda_s^n$ with
$\lambda_1, \ldots, \lambda_s \in K^\times$ and
$p_1 (T), \ldots, p_s (T) \in K [T]$. There exists a nonarchimedian absolute
value $|\cdot|_v$ on $K$ such that

\[ |\lambda_1|_v = \cdots = |\lambda_s|_v = 1. \]

This $v$ extends the $p$-adic absolute value on $\QQ$. The completion $K_v$ with
respect to $|\cdot|_v$ is a finite extension of $\QQ_p$. We want
$\log \lambda_i$ to be defined, and for this we need
$|\lambda_i - 1|_v < \rho_p = p^{-\frac{1}{p-1}}$.

Let $\mathfrak{p}_v$ be the prime ideal of $\mathcal{O}_{K_v}$. Then
$|\lambda - 1|_v < \rho_p$ is equivalent to
$\lambda \equiv 1 \pmod{\mathfrak{p}_v^m}$ for some $m \in \ZZ_{\ge 1}$, i.e. to
the fact that the image of $\lambda$ in the finite ring
$\mathcal{O}_{K_v} / \mathfrak{p}_v^m$ is $1$. Since $|\lambda|_v = 1$, we have
$\lambda \in \mathcal{O}_{K_v}^\times$. By the Fermat's little theorem,
\[ \lambda^N \equiv 1 \pmod{\mathfrak{p}_v^m}, \quad
  \text{where } N = \# (\mathcal{O}_{K_v} / \mathfrak{p}_v^m)^\times. \]

So $\lambda_1^N, \ldots, \lambda_s^N$ lie in the disk $D (1, \rho_p)$. For each
number $r \in \{ 0, 1, \ldots, N-1 \}$ we can put
\[ u_r (z) \dfn \sum_{1 \le i \le s} p_i (r + Nz) \, \lambda_i^r \, \exp (z \, \log \lambda_i^N). \]

This is well-defined for $z \in \ZZ_p$. If $n \equiv r \pmod{N}$, then
$n = r + N k$ such that $u (n) = u_r (k)$.

\begin{align*}
  u_r (k) & = \sum_{1 \le i \le s} p_i (r + Nk) \, \lambda_i^r \, \exp (k \, \log \lambda_i^N) \\
          & = \sum_{1 \le i \le s} p_i (n) \, \lambda_i^r \, \exp (\log \lambda_i^{Nk})\\
          & = \sum_{1 \le i \le s} p_i (n) \, \lambda_i^r \, \lambda_i^{N k}\\
          & = \sum_{1 \le i \le s} p_i (n) \, \lambda_i^n = u (n).
\end{align*}

Now fix $r$. There are two cases.

\begin{enumerate}
\item $u_r (z)$ is identically $0$. Then $u (n) = 0$ for $n \equiv r \pmod
  {N}$. This corresponds to $r \in S$ in the theorem.

\item $u_r (z)$ is not identically $0$. Then $u (n) = 0$ for finitely many
  $n \equiv r \pmod{N}$. This corresponds to the finite set $T$ in the theorem.
\end{enumerate}

So these considerations finish our proof of the Skolem--Mahler--Lech theorem. An
interesting feature of it is that we use properties of analytic nonarchimedian
functions to conclude that $T$ is some finite set, but we do not construct $T$
explicitly. All the proofs known thus far are not effective in this sense, apart
from some particular cases.

\pagebreak

\part{Sprind\v{z}uk's theorem}

\section{Statement of Sprind\v{z}uk's theorem}

We are going to discuss a theorem of a Belarusian mathematician
V.\,G.~Sprind\v{z}uk (1936--1987), which is related to the following classical
result.

\begin{theorem}[Hilbert's irreducibility theorem]
  Let $F (X,T) \in \QQ [X,T]$ be a polynomial irreducible over $\QQ$. Then there
  exist infinitely many integers $\tau \in \ZZ$ such that
  $F (X,\tau) \in \QQ [X]$ is irreducible.
\end{theorem}

\begin{example}
  Consider a polynomial $F (X,T) = X^2 - T$. The polynomial $F (X,\tau)$ is
  irreducible iff $\tau$ is not a square. So the theorem says there are
  infinitely many nonsquares (which is not surprising).
\end{example}

But in fact, a stronger result holds. Consider the set
$$H_F \dfn \{ \tau \in \ZZ \mid F (X,\tau) \text{ is irreducible} \}.$$

It is not just infinite, but has density $1$. That is,
$$\frac{\# (H_F \cap [-x, x])}{2\cdot x} \xrightarrow{x\to\infty} 1;$$
for instance, a big random number is almost never a square. It is harder to
show but still true is that $\# (H_F \cap [0, x]) = x + O (x^{1/2})$.

\vspace{1em}

Our ultimate goal is to prove the following fact:

\begin{theorem}[Sprind\v{z}uk's irreducibility theorem]
  Let $F (X,T) \in \QQ [X,T]$ be a polynomial irreducible over $\QQ$. Further
  assume that
  \begin{enumerate}
  \item $F (0,0) = 0$, so that $F$ has no free term.

  \item $F^\prime_X (0,0) \ne 0$, so that some term is linear in $X$.
  \end{enumerate}
  Then for all but finitely many primes $p$ the polynomial $F (X,p)$ is
  irreducible over $\QQ$.
\end{theorem}

One can refine the statement above and replace primes $p$ with prime powers
$p^k$, so that $F (X, p^k)$ is irreducible for all but finitely many prime
powers $p^k$. Further, one can show that $F (X, \frac{1}{n})$ is irreducible for
all but finitely many $n \in \ZZ$. We put this together and restate the theorem.

\begin{theorem}[Sprind\v{z}uk's irreducibility theorem II]
  Let $F (X,T) \in \QQ [X,T]$ be a polynomial irreducible over $\QQ$. Assume
  $F (0,0) = 0$ and $F^\prime_X (0,0) \ne 0$.

  Consider the set
  \[ \Omega \dfn
    \{ p^k \mid p \text{ is prime, } k = 1, 2, 3, \ldots \} \cup
    \{ \frac{1}{n} \mid n = 2, 3, 4, \ldots \}. \]
  Then $F (X,\alpha) \in \QQ [X]$ is irreducible over $\QQ$ for all but finitely
  many $\alpha \in \Omega$.
\end{theorem}

Observe that the elements of $\Omega$ satisfy the following property: for
$\alpha \in \Omega$ one has $|\alpha|_v < 1$ exactly for one place
$v \in M_\QQ = \{ 2, 3, 5, \ldots, \infty \}$ (possibly the infinite
one). Denote
$$S_\alpha \dfn \{ v\in M_\QQ \,\mid\, |\alpha|_v < 1 \}.$$
For $\alpha = p^k$ we have $S_\alpha = \{ p \}$, and for $\alpha = \frac{1}{n}$
we have $S_\alpha = \{ \infty \}$.

\begin{example}
  Consider $\alpha = -\frac{12}{5}$. Then $S_\alpha = \{ 2, 3 \}$.

  For $\alpha = -\frac{5}{12}$ one has $S_\alpha = \{ 5, \infty \}$.

  For $\alpha = \frac{3}{2}$ one has $S_\alpha = \{ 3 \}$---in particular, we
  see that $\{ \alpha \,\mid\, |S_\alpha| = 1 \} \supsetneq \Omega$.
\end{example}

\vspace{1em}

A more general result due to Sprind\v{z}uk is the following:

\begin{theorem}[Sprind\v{z}uk's decomposition theorem]\label{theorem:sprindzuk-decomposition}
  Let $F (X,T) \in \QQ [X,T]$ be a polynomial irreducible over $\QQ$. Assume
  $F (0,0) = 0$ and $F^\prime_X (0,0) \ne 0$. Let $\epsilon > 0$. For
  $\alpha \in \ZZ$ write down the factorization of $F (X,\alpha) \in \QQ [X]$
  into irreducible polynomials:
  $$F (X,\alpha) = f_1 (X) \cdots f_r (X).$$
  Then for all but finitely many $\alpha \in \ZZ$ one can write
  $\alpha = \alpha_1 \cdots \alpha_r$ with $\alpha_i$ pairwise relatively prime
  such that
  $$\left| \frac{\log |\alpha_i|}{\log |\alpha|} - \frac{\deg f_i}{\deg_X F} \right| < \epsilon.$$
\end{theorem}

In particular, when $\alpha = p^k$ is a prime power, this implies the
Sprind\v{z}uk's irreducibility theorem. We are going to discuss only the latter,
but the decomposition theorem is proved similarly. Later on we will give a more
general statement of the decomposition theorem where $\alpha$ is a rational
number, not an integer (see \refref{\S}{section:Sprindzuk-decomposition}).

We will use \term{heights}, which are a vital tool in Diophantine geometry. Now
we make a long detour to define heights and establish their basic properties.

\section{Heights on number fields}

Informally, a ``height'' of an algebraic number is a measure of its
complexity. We want it to satisfy the following properties.

\begin{enumerate}
\item[(1)] Height $H (\alpha)$ of an algebraic number
  $\alpha \in \overline{\QQ}$ is a nonnegative real number.

\item[(2)] Heights behave well with respect to addition and multiplication. That
  is, $H (\alpha + \beta)$ and $H (\alpha\,\beta)$ can be reasonably estimated
  in terms of $H (\alpha)$ and $H (\beta)$.

\item[(3)] The \term{Northcott's property} (discreteness) holds: there are
  finitely many algebraic numbers of bounded height and bounded degree.
\end{enumerate}

For $\alpha \in \ZZ$ taking $H (\alpha) \dfn |\alpha|$, the usual absolute
value, gives such a ``height''. However, on $\QQ$ this does not satisfy the last
property (3). For instance, the number $\frac{2014}{2013}$ is ``complicated'',
but its absolute value is small. This suggests that on rational numbers a right
notion of height is the following.

\begin{definition}
  Let $\alpha \in \QQ$ where $\alpha = \frac{a}{b}$ with $a, b \in \ZZ$
  relatively prime. Then the \term{height} of $\alpha$ is given by
  $H (\alpha) \dfn \max \{ |\alpha|, |\beta| \}$.
\end{definition}

In particular, for $\alpha \in \ZZ$ we have
$H (\alpha) = \max \{ |\alpha|, 1 \}$.

This behaves well for products and sums, in the sense that there are bounds
\begin{align*}
  H (\alpha\,\beta) & \le H (\alpha) \, H (\beta),\\
  H (\alpha + \beta) & \le 2 \, H (\alpha) \, H (\beta).
\end{align*}

We want to extend the notion of height to algebraic numbers
$\alpha \in \overline{\QQ}$. The first idea that comes to mind is that for
$\alpha$ one should consider its primitive minimal polynomial
$f (X) \in \ZZ [X]$:
$$f (X) = a_n X^n + a_{n-1} X^{n-1} + \cdots + a_1 X + a_0, \quad \text{where } (a_0, \ldots, a_n) = 1.$$
And one can put
$\badH\!\! (\alpha) \dfn \max \{ |\alpha_0|, \ldots, |\alpha_n| \}$. It is
possible to study this height $\badH$ and show nontrivial results about it,
however it is difficult to estimate $\badH\!\! (\alpha\,\beta)$ and
$\badH\!\! (\alpha + \beta)$ in terms of $\badH\!\! (\alpha)$ and
$\badH\!\! (\beta)$. So this idea is wrong (that is why it is ``$\badH$'' and
not ``$H$'').

\vspace{1em}

The second idea comes from the following observation: if $\alpha \in \QQ$, then
$$H (\alpha) = \prod_{v\in M_\QQ} \max \{ 1, |\alpha|_v \},$$
where $M_\QQ$ are the usual absolute values (normalized by $|p|_p = 1/p$).

\begin{example}
  For $\alpha = -\frac{12}{5}$ the absolute values are
  \[ |\alpha|_v =
    \left\{\begin{array}{cl}
             \cfrac{1}{4}, & v = 2,\\
             \\
             \cfrac{1}{3}, & v = 3,\\
             \\
             5, & v = 5, \\
             \\
             \cfrac{12}{5}, & v = \infty, \\
             \\
             1, & \text{otherwise}.
           \end{array}\right. \]

  Now $\prod_{v\in M_\QQ} \max \{ 1, |\alpha|_v \} = 12$, which is the height of
  $\alpha$.
\end{example}

In general, for $\alpha = \frac{a}{b}$ one has
$$\prod_{\substack{ v\in M_\QQ \\ v \ne \infty }} \max \{ 1, |\alpha|_v \} = |b|.$$

And $\max \{ 1, |\alpha|_\infty \} = \max \{ 1, \frac{|a|}{|b|} \}$, so
$$\prod_{v\in M_\QQ} \max \{ 1, |\alpha|_v \} = \max \{ |b|, |a| \} = H (\alpha).$$

Now let $K$ be a number field and $M_K$ be the set of places on $K$. We assume
that the places are normalized such that on $\QQ$ they give the standard
$p$-adic absolute values. Recall that for $\alpha \in \QQ^\times$ one has the
product formula
$$\prod_{v \in M_\QQ} |\alpha|_v = 1.$$

For an arbitrary number field the product formula for $\alpha \in K^\times$
is\label{product-formula-K}
$$\prod_{v \in M_K} |\alpha|_v^{d_v} = 1, \quad \text{where } d_v \dfn [K_v : \QQ_v].$$

This can be immediately verified for $\alpha \in \QQ^\times$. In this case for
$p \in M_\QQ$ one has several places $v \in M_K$ coming from $p$, and
\[ \prod_{\substack{v \in M_K \\ v \mid p}} |\alpha|_v^{d_p} =
  |\alpha|_p^{\sum_{v\mid p} d_v} = |\alpha|_p^{[K:\QQ]}. \]

So finally
\[ \prod_{v \in M_K} |\alpha|_v^{d_v} =
  \left( \prod_{p\in M_\QQ} |\alpha|_p \right)^{[K:\QQ]} = 1 \]
by the usual product formula for $\QQ$.

In general for $\alpha \in K$ we have an embedding $K \hookrightarrow K_v$ and
the corresponding absolute value is given by
$$|\alpha|_v \dfn |N_{K_v/\QQ_v} (\alpha)|_p^{1/d_v}.$$

So $|\alpha|_v^{d_v} = |N_{K_v/\QQ_v} (\alpha)|_p$. We have
\[ \prod_{v \mid p} |\alpha|_v^{d_v} =
  \prod_{v \mid p} |N_{K_v / \QQ_v} (\alpha)|_p =
  |N_{K/\QQ} (\alpha)|_p, \]
since the product of \emph{local norms} $N_{K_v / \QQ_v}$ gives the
\emph{global norm} $N_{K/\QQ}$.

Thus everything reduces to the usual product formula for $\QQ$:
$$\prod_{v \in M_K} |\alpha|_v^{d_v} = \prod_{p\in M_\QQ} |N_{K/\QQ} (\alpha)|_p = 1.$$

\begin{remark}
  Sometimes one normalizes the absolute values by local degrees $d_v$ putting
  $\|x\|_v \dfn |x|_v^{d_v}$, so that the product formula reads
  $\prod_{v\in M_K} \|\alpha\|_v = 1$. We do not use this normalization, so be
  careful reading other books and articles.
\end{remark}

Now the product formula for number fields suggests the following definition.

\begin{definition}
  Let $K$ be a fixed number field. The \term{height} of a number $\alpha \in K$
  is
  $$H_K (\alpha) \dfn \prod_{v\in M_K} \max \{ 1, |\alpha|_v \}^{d_v}.$$

  Taking logarithms, we get the \term{logarithmic height}
  $$h_K (\alpha) \dfn \sum_{v\in M_K} d_v \, \log^+ |\alpha|_v,$$
  where $\log^+ x \dfn \max \{ 0, \log x \}$. We assume $\log^+ 0 \dfn 0$.
\end{definition}

The whole point of taking logarithms is just that it is easier to write sums
instead of products in various inequalities involving heights. In what follows
we will mostly use ``$h$'' instead of ``$H$''.

The last definition of $H_K$ and $h_K$ depends on $K$, so we should correct it
to define heights on the whole $\overline{\QQ}$.

\begin{proposition}
  Let $L/K$ be a finite extension and $\alpha\in K$. Then
  $h_L (\alpha) = [L:K] \cdot h_K (\alpha)$, and correspondingly
  $H_L (\alpha) = H_K (\alpha)^{[L:K]}$.

  \begin{proof}
    Consider a place $w \in M_L$ coming from $v \in M_K$. We have
    $|\alpha|_w = |\alpha|_v$, and
    $$d_w = [L_v : \QQ_v] = [L_w : K_v] \cdot \underbrace{[K_v : \QQ_v]}_{d_v}.$$

    Now
    \[ \sum_{w \mid v} d_w \, \log^+ |\alpha|_w =
      \sum_{w \mid v} [L_w : K_v] \cdot d_v \, \log^+ |\alpha|_v =
      [L : K] \cdot d_v \, \log^+ |\alpha|_v, \]
    since $\sum_{w \mid v} [L_w : K_v] = [L : K]$. And finally,
    \[ \sum_{w \in M_L} d_w \, \log^+ |\alpha|_w =
      [L : K] \cdot \sum_{v \in M_K} d_v \, \log^+ |\alpha|_v =
      [L : K] \cdot h_K (\alpha). \qedhere \]
  \end{proof}
\end{proposition}

So the right definition of height is the following.

\begin{definition}
  Let $\alpha \in \overline{\QQ}$ be an algebraic number. Then its \term{height}
  (\term{logarithmic height}) is given by
  \begin{align*}
    H (\alpha) & \dfn H_K (\alpha)^{1/[K:\QQ]},\\
    h (\alpha) & \dfn \frac{1}{[K : \QQ]} \, h_K (\alpha),
  \end{align*}
  where $K$ is some number field containing $\alpha$.
\end{definition}

The definition is correct thanks to the last proposition. Indeed, if
$\alpha \in K_1$ and $\alpha \in K_2$, then there is $L$ containing both $K_1$
and $K_2$ and
\[ h_L (\alpha) = [L : K_1] \cdot h_{K_1} (\alpha) = [L : K_2] \cdot h_{K_2} (\alpha). \]

\[ \xymatrix@R=0.6em@C=0.6em{
    & \overline{\QQ}\ar@{-}[d] \\
    & L\ar@{-}[dr]\ar@{-}[dl] \\
    K_1\ar@{-}[dr] & & K_2\ar@{-}[dl] \\
    & \QQ (\alpha)\ar@{-}[d] \\
    & \QQ
  } \]

\[ \frac{h_{K_1} (\alpha)}{[K_1 : \QQ]} =
  \frac{h_L (\alpha)}{[L : \QQ]} =
  \frac{h_{K_2} (\alpha)}{[K_2 : \QQ]}. \]

So we finally have a right height function
$h\colon \overline{\QQ} \to \mathbb{R}_{\ge 0}$.

\section{Projective and affine heights}

Let $K$ be a field. We have the affine space $\mathbb{A}^n (K)$ with coordinates
$\{ (\alpha_1, \ldots, \alpha_n) \mid \alpha_i \in K \}$ and the projective
space $\mathbb{P}^n (K)$ with projective coordinates
$(\alpha_0 : \alpha_1 : \cdots : \alpha_n)$, where
\[ (\alpha_0 : \alpha_1 : \cdots : \alpha_n) \sim
  (\lambda\,\alpha_0 : \lambda\,\alpha_1 : \cdots : \lambda\,\alpha_n)
  \quad \text{for }\lambda \in K^\times. \]

\begin{definition}
  The \term{projective height} of a point
  $\underline{\alpha} = (\alpha_0 : \alpha_1 : \cdots : \alpha_n) \in
  \mathbb{P}^n (\overline{\QQ})$ is given by
  \[ h_\mathbb{P} (\underline{\alpha}) \dfn
    \frac{1}{[K : \QQ]} \, \sum_{v \in M_K} d_v \, \log |\underline{\alpha}|_v, \]
  where
  $|\underline{\alpha}|_v \dfn \max \{ |\alpha_0|_v, \ldots, |\alpha_n|_v \}$,
  and $K$ is some number field containing $\alpha_1, \ldots, \alpha_n$.
\end{definition}

\noindent (We write $\log$ instead of $\log^+$ since the point
``$(0 : 0 : \cdots : 0)$'' is not in $\mathbb{P}^n$.)

This does not depend on the field $K$ and it is well-defined on
$\mathbb{P}^n (\overline{\QQ})$, i.e.
$h_\mathbb{P} (\underline{\alpha}) = h_\mathbb{P} (\lambda \, \underline{\alpha})$
for $\lambda \in \overline{\QQ}^\times$, since

\[ h_\mathbb{P} (\lambda\,\underline{\alpha}) =
  h_\mathbb{P} (\underline{\alpha}) +
  \frac{1}{[K:\QQ]} \, \underbrace{\sum_{v\in M_K} d_v \, \log |\lambda|_v}_{= \log \prod |\lambda|_v^{d_v} = 0}. \]

\begin{definition}
  For a point
  $\underline{\alpha} = (\alpha_1, \ldots, \alpha_n) \in \mathbb{A}^n
  (\overline{\QQ})$ the \term{affine height} $h_\mathbb{A}$ is given via the
  embedding
  \begin{align*}
    \mathbb{A}^n (\overline{\QQ}) & \hookrightarrow \mathbb{P}^n (\overline{\QQ}), \\
    (\alpha_1, \ldots, \alpha_n) & \mapsto (1 : \alpha_1 : \cdots : \alpha_n).
  \end{align*}

  In other words,
  \[ h_\mathbb{A} (\underline{\alpha}) =
    h_\mathbb{P} (1 : \alpha_1 : \cdots : \alpha_n) =
    \frac{1}{[K:\QQ]} \, \sum_{v\in M_K} d_v \, \log^+ |\underline{\alpha}|_v. \]
\end{definition}

Finally, we will need a notion of projective and affine height for a polynomial
with coefficients in a number field.

\begin{definition}
  For a polynomial
  $F (X_1, \ldots, X_n) = \sum_{i_i,\ldots,i_n} a_{i_1,\ldots,i_n} \, X_1^{i_1}\cdots X_n^{i_n} \in K [X_1, \ldots, X_n]$
  we put
  \begin{align*}
    h_\mathbb{P} (F) & \dfn h_\mathbb{P} (a_{i_1,\ldots,i_n})_{i_i,\ldots,i_n}, \\
    h_\mathbb{A} (F) & \dfn h_\mathbb{A} (a_{i_1,\ldots,i_n})_{i_i,\ldots,i_n}.
  \end{align*}
\end{definition}

For $\lambda \in K^\times$ one has
$h_\mathbb{P} (\lambda\,F) = h_\mathbb{P} (F)$. There is an inequality
$h_\mathbb{P} (F) \le h_\mathbb{A} (F)$, and one has
$h_\mathbb{P} (F) = h_\mathbb{A} (F)$ when one of the coefficients of $F$ equals
$1$.

\section{Properties of heights}

Now we summarize and prove some basic properties of the height of an algebraic
number $h (\alpha)$ defined above:
\[ h (\alpha) \dfn \frac{1}{[K : \QQ]} \, h_K (\alpha) =
  \frac{1}{[K : \QQ]} \, \sum_{v \in M_K} d_v \, \log^+ |\alpha|_v. \]

\begin{enumerate}
\item[(1)] $h (\alpha) \ge 0$ for any $\alpha \in \overline{\QQ}$.

\item[(2)] $h (\alpha_1 \cdots \alpha_m) \le h (\alpha_1) + \cdots + h (\alpha_m)$.

\item[(3)] $h (\alpha_1 + \cdots + \alpha_m) \le h (\alpha_1) + \cdots + h (\alpha_m) + \log m$.

\item[(4)] $h (\alpha^n) = |n| \cdot h (\alpha)$. In particular,
  $h (\alpha^{-1}) = h (\alpha)$ for $\alpha \ne 0$.

\item[(5)] If $\alpha$ and $\beta$ are conjugate over $\QQ$, then
  $h (\alpha) = h (\beta)$.

\item[(6)] The \term{Northcott's property}: for fixed constant $C > 0$ and fixed
  degree $d = 1, 2, 3, \ldots$ the set
  $$\{ \alpha \mid h (\alpha) < C \text{ and } [\QQ (\alpha) : \QQ] < d \}$$
  is finite.

\item[(7)] The \term{first Kronecker's theorem}: $h (\alpha) = 0$ iff
  $\alpha = 0$ or $\alpha$ is a root of unity.
\end{enumerate}

We begin with the first, easier properties. The property (1) is obvious.

\vspace{1em}

For the estimate (2), write
\[ |\alpha_1 \cdots \alpha_m|_v = |\alpha_1|_v \cdots |\alpha_m|_v \le
  \max \{ 1, |\alpha_1|_v \} \cdots \max \{ 1, |\alpha_m|_v \}. \]

Taking logarithms, we get
$$\log^+ |\alpha_1\cdots\alpha_m|_v \le \log^+ |\alpha_1|_v + \cdots + \log^+ |\alpha_m|_v,$$
which implies (2). \qed

\vspace{1em}

Similarly we show (3), but one should distinguish archimedian and nonarchimedian
absolute values:
\begin{align*}
  |\alpha_1 + \cdots + \alpha_m|_v & \le \left\{ \begin{array}{ll}
                                                   \max \{ |\alpha_1|_v, \ldots, |\alpha_m|_v \}, & v \text{ nonarchimedian}\\
                                                   m \cdot \max \{ |\alpha_1|_v, \ldots, |\alpha_m|_v \}, & v \text{ archimedian}
                                                 \end{array} \right\} \\
  \\
                                   & \le \left\{ \begin{array}{ll}
                                                   \max \{ 1, |\alpha_1|_v \} \cdots \max \{1, |\alpha_m|_v \}, & v \text{ nonarchimedian}\\
                                                   m \cdot \max \{ 1, |\alpha_1|_v \} \cdots \max \{1, |\alpha_m|_v \}, & v \text{ archimedian}
                                                 \end{array} \right\}
\end{align*}

Taking logarithms,
\[ \log^+ |\alpha_1 + \cdots + \alpha_m| \le
  \log^+ |\alpha_1| + \cdots + \log^+ |\alpha_m|
  + \left\{ \begin{array}{ll}
              0, & v \text{ nonarchimedian}\\
              \log m, & v \text{ archimedian}
            \end{array} \right\} \]

Thus
\[ h (\alpha_1 + \cdots + \alpha_m) \le
  h (\alpha_1) + \cdots + h (\alpha_m) +
  \frac{1}{[K:\QQ]} \, \sum_{v \mid \infty} d_v \log m =
  h (\alpha_1) + \cdots + h (\alpha_m) + \log m, \]
since $\sum_{v \mid \infty} d_v = [K : \QQ]$. \qed

\vspace{1em}

Now for (4) observe that $h (\alpha^n) = |n|\cdot h (\alpha)$ for $n > 0$ since
$\max \{ 1, |\alpha^n|_v \} = \max \{ 1, |\alpha|_v \}^n$.

The key case is (4) for $n = -1$. We have
$\log^+ |\alpha^{-1}|_v = -\log^- |\alpha|_v$ where
$\log^- x \dfn \min \{ 0, \log x \}$. Now
\[ h (\alpha^{-1}) - h (\alpha) =
  \frac{1}{[K:\QQ]} \, \left(\sum_{v\in M_K} d_v \, \log^+ |\alpha|_v + \sum_{v\in M_K} \log^- |\alpha|_v\right) =
  \frac{1}{[K:\QQ]} \, \sum_{v\in M_K} d_v \, \log |\alpha|_v = 0 \]
by the product formula.

If $n < -1$, then from what we have proved,
$h (\alpha^{-n}) = h ((\alpha^{-1})^n) = |n| \cdot h (\alpha^{-1}) = |n| \cdot h (\alpha)$. \qed

\vspace{1em}

Now we show (5). Suppose $\alpha$ and $\beta$ are conjugate. That is, let
$K/\QQ$ be a Galois extension containing both $\alpha$ and $\beta$ and let
$\sigma \in \Gal (K/\QQ)$ be such that $\sigma (\alpha) = \beta$.

The Galois group $\Gal (K/\QQ)$ acts on the set of places $M_K$. Each
$\sigma \in \Gal (K / \QQ)$ induces a permutation
\begin{align*}
  M_K & \to M_K, \\
  v & \mapsto v^\sigma,
\end{align*}
where we define $|x|_{v^\sigma} \dfn |\sigma (x)|_v$. On $\QQ$ the
absolute value $|\cdot|_{v^\sigma}$ coincides with $|\cdot|_v$. The inverse map
is given by $v \mapsto v^{\sigma^{-1}}$. We have
\[ h (\beta) = \frac{1}{[K:\QQ]} \, \sum_{v\in M_K} d_v \, \log^+ |\beta|_v =
  \frac{1}{[K:\QQ]} \, \sum_{v\in M_K} d_v \, \log^+ |\alpha|_{v^\sigma} =
  \frac{1}{[K : \QQ]} \, \sum_{v\in M_K} d_v \, \log^+ |\alpha|_v = h (\alpha), \]
using the fact that $\Gal (K / \QQ)$ just permutes the places, and that
$d_v = d_{v^\sigma}$. \qed

\vspace{1em}

\begin{example}
  Consider $K = \QQ (\gamma)$ where $\gamma$ is a root of $X^2 - 2$. There are
  two real embeddings of $K$, and so there are two extensions of
  $|\cdot|_\infty$ from $\QQ$ to $K$:
  \begin{align*}
    K & \hookrightarrow \mathbb{R},\\
    v_+\colon \gamma & \mapsto +\sqrt{2},\\
    v_-\colon \gamma & \mapsto -\sqrt{2}.
  \end{align*}

  Consider two conjugate numbers $\alpha = 1 + \gamma$ and
  $\beta = 1 - \gamma$. One has
  \[ h (\alpha) = \frac{1}{2} \, (\log^+ |\alpha|_{v^+} + \log^+ |\alpha|_{v^-}) =
    \frac{1}{2} \, (\log^+ |1 + \sqrt{2}| + \underbrace{\log^+ |1-\sqrt{2}|}_{=0}) =
    \frac{1}{2} \log |1 + \sqrt{2}|.  \]

  \[ h (\beta) = \frac{1}{2} \, (\log^+ |\beta|_{v^+} + \log^+ |\beta|_{v^-}) =
    \frac{1}{2} \, (\underbrace{\log^+ |1 - \sqrt{2}|}_{=0} + \log^+ |1+\sqrt{2}|) =
    \frac{1}{2} \log |1 + \sqrt{2}|. \qedhere \]
\end{example}

\vspace{1em}

Now we are going to show the Northcott's property (6). For this it is enough to
show that for a fixed $C > 0$ and a fixed degree $d$ the set
$$A \dfn \{ \alpha\in\overline{\QQ} \mid h (\alpha) < C, ~ [\QQ (\alpha) : \QQ] = d \}$$
is finite. We already know that this is the case when $d = 1$.

Let $\alpha \in A$. Consider the minimal polynomial $f (X) \in \QQ [X]$ of
$\alpha$:
$$f (X) = X^d + a_{d-1} X^{d-1} + \cdots + a_1 X + a_0.$$

Let $\alpha_1 = \alpha, \ldots, \alpha_d$ be the conjugates of $\alpha$ (that
is, the roots of $f$) and write down the Vieta's formulas:
\begin{align*}
  a_0 & = (-1)^d \, \alpha_1 \, \alpha_2 \cdots \alpha_d,\\
  a_1 & = (-1)^{d-1} \, (\alpha_1 \, \alpha_2 \cdots \alpha_{d-1} + \alpha_1 \, \alpha_2 \cdots \alpha_{d-2}\,\alpha_d + \ldots + \alpha_2 \, \alpha_3 \cdots \alpha_d), \\
      & \vdots \\
  a_{d-3} & = -(\alpha_1\,\alpha_2\,\alpha_3 + \alpha_1\,\alpha_2\,\alpha_4 + \cdots + \alpha_{d-2}\,\alpha_{d-1}\,\alpha_d), \\
  a_{d-2} & = \alpha_1\,\alpha_2 + \alpha_1\,\alpha_3 + \cdots + \alpha_1\,\alpha_d + \alpha_2\,\alpha_3 + \cdots + \alpha_{d-1}\,\alpha_d, \\
  a_{d-1} & = -(\alpha_1 + \alpha_2 + \cdots + \alpha_d).
\end{align*}

Since $\alpha_1,\ldots,\alpha_d$ are conjugate, we have
$$h (\alpha_1) = h (\alpha_2) = \cdots = h (\alpha_d) < C,$$
and from these identities and the properties (2) and (3)

\begin{align*}
  h (a_0) & \le C^d,\\
  h (a_1) & \le d\,C^{d-1} + \log d, \\
          & \vdots \\
  h (a_{d-3}) & \le {d \choose 3} \, C^3 + \log {d \choose 3}, \\
  h (a_{d-2}) & \le {d \choose 2} \, C^2 + \log {d \choose 2}, \\
  h (a_{d-1}) & \le d\,C + \log d.
\end{align*}

Thus the heights of the coefficients $a_0, a_1, \ldots, a_{d-1} \in \QQ$ are
bounded in terms of $C$ and $d$, which means there are finitely many choices for
$a_0, \ldots, a_d$, hence finitely many choices for $f (X)$ and finitely many
choices for $\alpha$. \qed

\vspace{1em}

Finally we show the first Kronecker's theorem (7). If $\alpha = 0$, then
$h (\alpha) = 0$. If $\alpha^n = 1$ for some $n$, then
\[ 0 = h (1) = h (\alpha^n) = |n|\cdot h (\alpha). \]

In the other direction, assume that $h (\alpha^n) = 0$ for some $n$. Consider
the numbers $1, \alpha, \alpha^2, \alpha^3, \ldots$ Their degree
$[\QQ (\alpha^k) : \QQ]$ is bounded by $[\QQ (\alpha) : \QQ] = d$ and their
height is bounded since $h (\alpha^n) = 0$. So in this sequence there are
finitely many numbers, and there are some $k$ and $\ell$ such that
$\alpha^k = \alpha^\ell$, which implies that $\alpha = 0$ or $\alpha$ is a root
of unity. \qed

\vspace{1em}

We are done with proving the properties (1)--(7) and now we discuss some related
results. There is also the \term{second Kronecker's theorem}, related to the
first theorem.

\begin{theorem}[Second Kronecker's theorem]
  For each $d$ there exists a constant $C (d) > 0$, such that for any
  $\alpha \in \overline{\QQ}^\times$ which is not a root of unity,
  $[\QQ (\alpha) : \QQ] \le d$ implies $h (\alpha) \ge C (d)$.

  \begin{proof}
    Consider the set
    \[ A \dfn \{ \beta \in \overline{\QQ} \mid [\QQ (\beta) : \QQ] \le d, ~ h (\beta) \le 1 \}. \]

    It is finite, having $\Theta_d \dfn |A|$ elements. Consider a sequence
    \[ 1, \alpha, \alpha^2, \ldots, \alpha^{\Theta_d}. \]

    These numbers are pairwise distinct, since $\alpha \ne 0$ and $\alpha$ is
    not a root of unity by our assumption. But there are $\Theta_d + 1$ numbers,
    so there is some $k \le \Theta_d$ such that $\alpha^k \notin A$, so that
    $h (\alpha^k) > 1$ and $h (\alpha) > \frac{1}{k} \ge
    \frac{1}{\Theta_d}$. Now put $C (d) \dfn \frac{1}{\Theta_d}$ and we are
    done.
  \end{proof}
\end{theorem}

The estimate for $C (d)$ produced in the proof above is very poor. The
\term{Lehmer's conjecture} states that $C (d) = \frac{C}{d}$ where $C$ is some
universal constant. The smallest known candidate to be $C$ is the largest real
root of a polynomial
\[ X^{10}+X^9-X^7-X^6-X^5-X^4-X^3+X+1. \]

This root is $\approx 1.176280818\dots$ A special feature of this example is
that the minimal polynomial of $\alpha$, which is given above, is
palindromic. An algebraic number $\alpha$ is called \term{reciprocal} if
$\alpha$ and $\alpha^{-1}$ are conjugate over $\QQ$ (which means the minimal
polynomial of $\alpha$ is palindromic). One result towards the Lehmer's
conjecture is the following.

\begin{theorem}[Chris Smyth, 1971]
  If $\alpha$ is nonreciprocal and $[\QQ (\alpha) : \QQ] = d$, then
  $h (\alpha) \ge \log \theta/d$ where $\theta \approx 1.324717957\dots$ is the
  real root of $X^3 - X - 1$, and it is the best possible estimate (for
  nonreciprocal numbers).
\end{theorem}

As for reciprocal numbers, the conjecture still remains open, and the best know
result is due to Dobrowolski (1978):

\[ h (\alpha) \ge \frac{C}{d} \, \left(\frac{\log \log d}{\log d}\right)^3. \]

In some practical applications one can neglect the multiplier
$\left(\frac{\log \log d}{\log d}\right)^3$, although it seems to be difficult
to remove it or at least improve.

\vspace{1em}

Let $\alpha \in \QQ^\times$ be a rational number $\alpha = \frac{a}{b}$ with
$(a,b) = 1$. Then $|\alpha| \ge \frac{1}{b}$ and
$b \le H (\alpha) = e^{h (\alpha)}$. So we have the so-called
\term{Liouville's inequality}
\[ |\alpha| \ge e^{- h (\alpha)}. \]

This easy observation generalizes to any number field $K$ and any absolute value
$|\cdot|_v$.

\begin{proposition}
  Let $K$ be a number field. Let $v \in M_K$. Then for $\alpha \in K$ one has

  \[ |\alpha|_v^{d_v} \ge e^{- [K : \QQ] \cdot h (\alpha)}. \]

  More generally, for a set of places $S \subset M_K$ one has
  $$\prod_{v\in S} |\alpha|_v^{d_v} \ge e^{- [K : \QQ] \cdot h (\alpha)}.$$

  \begin{proof}
    We have the product formula
    $$\prod_{v\in M_K} |\alpha|_v^{d_v} = 1.$$

    So if we take a product outside some subset $S \subset M_K$, there is an
    inequality
    \[ \prod_{v \in M_K\setminus S} |\alpha|_v^{d_v} \le
      \prod_{v\in M_K\setminus S} \max \{ 1, |\alpha|_v \}^{d_v} \le
      \prod_{v\in M_K} \max \{ 1, |\alpha|_v \}^{d_v} =
      H_K (\alpha) = e^{[K : \QQ] \cdot h(\alpha)}. \]

    Now
    \[ \prod_{v\in S} |\alpha|_v^{d_v} =
      \left(\prod_{v\in M_K\setminus S} |\alpha|_v^{d_v}\right)^{-1} \ge
      e^{-[K : \QQ] \cdot h(\alpha)}. \qedhere \]
  \end{proof}
\end{proposition}

Finally, we want to show a relationship between the height $h (\alpha)$ of an
algebraic number $\alpha \in \overline{\QQ}$ and the height of a polynomial
$f \in \overline{\QQ} [X]$ having $\alpha$ as its root; and also with the
heights of the values of the polynomial.

\begin{lemma}
  Let $f (X) = a_n X^n + \cdots + a_1 X + a_0 \in K [X]$ be a polynomial and
  $|\cdot|_v$ be an absolute value on $K$. Set
  $|f|_v \dfn \max \{ |a_0|_v, \ldots, |a_n|_v \}$. Let $\alpha$ be a root of
  $f (X)$. Then

  \[ |\alpha|_v \le
    \left\{\begin{array}{rl}
             \frac{|f|_v}{|a_n|_v}, & v \text{ nonarchimedian},\\
             2 \, \frac{|f|_v}{|a_n|_v}, & v \text{ archimedian}.
           \end{array}\right.\]

  \begin{proof}
    To simplify the notation, we write just $|\cdot|$ instead of $|\cdot|_v$.

    Since $|f|$ is by definition the maximum of $|a_i|$, we have
    $\frac{|f|}{|a_n|} \ge 1$. If $|\alpha| < 1$, then
    $$|\alpha| < \frac{|f|}{|a_n|} \le 2\,\frac{|f|}{|a_n|},$$
    and we are done.

    \vspace{1em}

    Now for $|\alpha| \ge 1$ we consider the expression
    $$\alpha^n = - \sum_{0 \le i \le n-1} \frac{a_i}{a_n} \alpha^i.$$

    We take the absolute values $|\cdot|$ and estimate the right hand side. In
    the nonarchimedian case
    $$|\alpha|^n = \left|\sum_{0 \le i \le n-1} \frac{a_i}{a_n} \, \alpha^i\right| \le \frac{|f|}{|a_n|} \, |\alpha|^{n-1},$$
    thus $|\alpha| \le \frac{|f|}{|a_n|}$. (In the bound we indeed used that $|\alpha| \ge 1$.)

    \vspace{1em}

    In the archimedian case we do the same estimates, but we have to use the
    triangle inequality. Observe that we can assume $|\alpha| > 2$, otherwise
    the claimed inequality is trivially true.

    \begin{align*}
      |\alpha|^n = \left|\sum_{0 \le i \le n-1} \frac{a_i}{a_n} \, \alpha^i\right| & \le \sum_{0 \le i \le n-1} \frac{|a_i|}{|a_n|} \, |\alpha|^i\\
                                                                                   & = |\alpha^{n-1}| \, \sum_{0 \le i \le n-1} \frac{|a_i|}{|a_n|} \, |\alpha|^{i-(n-1)} \\
                                                                                   & \le |\alpha^{n-1}| \, \frac{|f|}{|a_n|} \, \left(1 + \frac{1}{|\alpha|} + \frac{1}{|\alpha|^2} + \cdots + \frac{1}{|\alpha|^{n-1}}\right) \\
                                                                                   & \le |\alpha^{n-1}| \, \frac{|f|}{|a_n|} \, \left(1 + \frac{1}{2} + \frac{1}{4} + \frac{1}{8} + \cdots\right) \\
                                                                                   & \le 2 \, |\alpha^{n-1}| \, \frac{|f|}{|a_n|}.
    \end{align*}
    (Note the interesting trick we used; a simple-minded application of the
    triangle inequality gives immediately $|\alpha| \le n \, \frac{|f|}{|a_n|}$,
    but we were able to replace ``$n$'' with ``$2$''.)
  \end{proof}
\end{lemma}

\begin{proposition}\label{proposition:root-height}
  Let $f (X) \in \overline{\QQ} [X]$ be a nonzero polynomial and
  $\alpha \in \overline{\QQ}$ be its root. Then
  $h (\alpha) \le h_\mathbb{P} (f) + \log 2$.

  \begin{proof}
    Let $f (X) = a_n X^n + a_{n-1} X^{n-1} + \cdots + a_1 X + a_0$. We have

    \[ |\alpha|_v \le
      \left\{\begin{array}{ll}
               \frac{|f|_v}{|a_n|_v}, & v \text{ nonarchimedian},\\
               2\,\frac{|f|_v}{|a_n|_v}, & v \text{ archimedian}.
             \end{array}\right. \]

    Thus
    \[ \log^+ |\alpha|_v \le \log \frac{|f|_v}{|a_n|_v} +
      \left\{\begin{array}{ll}
               0, & v \text{ nonarchimedian},\\
               \log 2, & v \text{ archimedian}.
             \end{array}\right\} \]

    And so
    \[ h (\alpha) \le h_\mathbb{P} \left(\frac{f}{a_n}\right) + \log 2 =
      h_\mathbb{P} (f) + \log 2. \qedhere \]
  \end{proof}
\end{proposition}

\begin{remark}
  A stronger estimate can be proven. If $\alpha_1, \ldots, \alpha_n$ are all
  roots of $f$ then
  \[ \left| h_\mathbb{P} (f) - \sum_{1 \le i \le n} h (\alpha_i) \right| \le c (n) \]
  for some constant $c (n)$ depending on $n$.
\end{remark}

\begin{proposition}
  Let $f (X) \in \overline{\QQ} [X]$ be a nonzero polynomial of degree $m$ and
  let $\alpha \in \overline{\QQ}$. Then
  \[ h (f(\alpha)) \le m\, h (\alpha) + h_\mathbb{A} (f) + \log (m+1). \]

  \begin{proof}
    Let $f (X) = a_m X^m + a_{m-1} X^{m-1} + \cdots + a_1 X + a_0$. We have

    \[ |f (\alpha)|_v \le \max \{ |a_0|_v, \ldots, |a_m|_v \} \cdot
      \left\{\begin{array}{ll}
               1, & v \text{ nonarchimedian},\\
               m+1, & v \text{ archimedian}.
             \end{array}\right\} \]

    So
    \[ \max \{ 1, |f (\alpha)|_v \} \le \max \{ 1, |a_0|_v, \ldots, |a_m|_v \} \cdot
      \left\{\begin{array}{ll}
               1, & v \text{ nonarchimedian},\\
               m+1, & v \text{ archimedian}.
             \end{array}\right\} \]

    \[ h (f (\alpha)) \le h_\mathbb{A} (f) + m\,h (\alpha) + \log (m+1). \qedhere \]
  \end{proof}
\end{proposition}

Similarly one can show the following.

\begin{proposition}\label{proposition:twovar-polynomial-value-height}
  Let $F (X,T) \in \overline{\QQ} [X,T]$ be a polynomial of degrees
  $\deg_X F = n$, $\deg_T F = m$. Let $\alpha, \beta \in \overline{\QQ}$. Then
  \[ h (F (\beta,\alpha)) \le m \, h (\beta) + n \, h (\alpha) + h_\mathbb{A} (F) + \log ((m+1)\cdot (n+1)). \]
\end{proposition}

Finally, we show another bound for polynomials in two variables.

\begin{proposition}\label{proposition:beta-alpha-roots-height}
  Let $F (X,T) \in \overline{\QQ} [X,T]$ be a polynomial of degrees
  $\deg_T F = m$, $\deg_X F = n$. Let $\alpha, \beta \in \overline{\QQ}$ be such
  that $F (\beta,\alpha) = 0$ and $F (X, \alpha)$ is not identically zero. Then
  \[ h (\beta) \le m \, h (\alpha) + h_\mathbb{P} (F) + \log 2 \, (m+1). \]

  \begin{proof}
    Put $f (X) \dfn F (X, \alpha)$. It is a polynomial in one variable having
    $\beta$ as its root. So $h (\beta) \le h_\mathbb{P} (f) + \log 2$ by
    \refref{proposition}{proposition:root-height}. It remains to show a bound on
    $h_\mathbb{P} (f)$.

    Let $F (X,T) = g_n (T)\,X^n + \cdots + g_1 (T)\,X + g_0 (T)$ for some
    $g_0, \ldots, g_n \in \overline{\QQ} [T]$. Then
    $f (X) = g_n (\alpha)\,X^n + \cdots + g_1 (\alpha)\,X + g_0 (\alpha)$. Let
    $K$ be a number field containing $\alpha$ and let $v \in M_K$ be a place on
    $K$. Consider $g_i (T) = a_m\,T^m + \cdots + a_1\,T + a_0$ one of the
    polynomials $g_0, \ldots, g_n$.

    \[ |g (\alpha)|_v \le \max \{ 1, |\alpha|_v \}^m \cdot |g|_v \cdot
      \left\{\begin{array}{ll}
               1, & v \text{ nonarchimedian}, \\
               m+1, & v \text{ archimedian}.
             \end{array}\right\} \]

    Since $|g|_v \le |F|_v$, we get
    \[ h_\mathbb{P} (f) \le
      \frac{1}{[K : \QQ]} \sum_{v \in M_k} d_v \, \log^+ |f|_v \le
      m \, h (\alpha) + h_\mathbb{P} (F) + \log (m+1). \]

    Now substituting this in the bound
    $h (\beta) \le h_\mathbb{P} (f) + \log 2$, we get the desired result.
  \end{proof}
\end{proposition}

\begin{remark}
  The proposition above does not give the optimal bound. One can show that
  $$\frac{h (\alpha)}{n} \approx \frac{h (\beta)}{m},$$
  where $m = \deg_T F$, $n = \deg_X F$, and $\approx$ is a ``quasi-equivalence
  of heights'' (the difference of heights is ``small''; we omit the details).
\end{remark}

\section{Eisenstein's theorem about algebraic power series}

Let $x (T) \in \overline{\QQ} [\![T]\!]$ be a formal power series

\[ x(T) = a_0 + a_1\,T + a_2\,T^2 + \cdots, \quad a_i \in \overline{\QQ}. \]

We say that $x (T)$ is \term{algebraic} if it is algebraic over $\QQ (T)$; that
is, there is some polynomial $F (X, T) \in \overline{\QQ} [X,T]$ such that
$F (x (T), T) = 0$ in the ring $\overline{\QQ} [\![T]\!]$:
\[ F (x (T), T) = g_0 (T) + g_1 (T) \, x (T) + \cdots + g_{N-1} (T) \, x^{N-1} (T) + g_N (T) \, x^N (T) = 0, \quad
  \text{for some }g_i (T) \in \overline{\QQ} [T]. \]

If $x (T)$ is an algebraic power series, then it lies in a finite extension of
$\QQ (\!(T)\!)$, so the residue field of $\QQ (\!(T)\!)\,(x (T))$ is finite over
$\QQ$. This means that the coefficients $a_i$ belong to some number field $K$.

\begin{example}
  $x (T) = 1 + \sqrt{2} \, T + \sqrt{3} \, T^2 + \sqrt{4} \, T^3 + \cdots$ is
  not an algebraic power series, since the coefficients do not lie in a finite
  extension of $\QQ$.
\end{example}

\begin{example}
  Consider a power series

  \[ x(T) = \frac{1}{2-T} = \frac{1}{2} \cdot \frac{1}{1 - T/2} =
    \frac{1}{2} \, \sum_{k \ge 0} \frac{T^k}{2^k}. \]

  This is not just algebraic, but rational. In the denominators we have powers
  of $2$.
\end{example}

\begin{example}
  Now consider a power series
  \[ x(T) = (1 + T)^{1/2} = \sum_{k \ge 0} { 1/2 \choose k } \, T^k. \]

  Compute the binomial coefficients
  \[ {1/2 \choose k} \dfn \frac{\frac{1}{2} \cdot (\frac{1}{2} - 1) \cdot (\frac{1}{2} - 2) \cdots (\frac{1}{2} - k+1)}{k!}. \]

  \[ \begin{array}{rccccccccccc}
       k: & 0 & ~1 & ~~2 & ~~3 & ~~4 & ~~5 & ~~6 & ~~7 & ~~8 & ~~9 & \cdots \\
       \hline
       {1/2 \choose k}: & 1 & +\frac{1}{2} & -\frac{1}{2^3} & +\frac{1}{2^4} & -\frac{5}{2^7} & +\frac{7}{2^8} & -\frac{21}{2^{10}} & +\frac{33}{2^{11}} & -\frac{429}{2^{15}} & +\frac{715}{2^{16}} & \cdots
     \end{array} \]

  The key observation one makes from looking at the denominators is that
  $4^k\cdot {1/2 \choose k}$ is always an integer (try to prove this). This is
  a general property of algebraic power series.
\end{example}

\begin{theorem}[Eisenstein]\label{theorem:eisenstein-1}
  Let $x (T) = \sum_{k \ge 0} a_k\,T^k$ be an algebraic power series with
  $a_i \in K$. Then there exists an integer $c \in \mathcal{O}_K$ such that
  $c^k \, a_k \in \mathcal{O}_K$.
\end{theorem}

This means that the denominators in an algebraic power series must have a very
special ``exponential'' form.

\begin{example}
  Consider the logarithm power series
  \[ \log (1+T) = \sum_{k \ge 1} (-1)^{k-1} \, \frac{T^k}{k}. \]

  The denominators are not powers of some integer, so it is not an
  \emph{algebraic} power series. Similarly the exponent
  $$\exp (T) = \sum_{k \ge 0} \frac{T^k}{k!}$$
  is not an algebraic power series.
\end{example}

Let us give another statement of \refref{theorem}{theorem:eisenstein-1}. It says
that for any nonarchimedian place $v \in M_K$ one has
$|a_k|_v \le (|c|_v^{-1})^k$. So the following holds.

\begin{theorem}[Esenstein-2]\label{theorem:eisenstein-2}
  Let $x (T) = \sum_{k \ge 0} a_k\,T^k$ be an algebraic power series with
  $a_i \in K$. Then for any place $v \in M_K$ there exists a number
  $A_v \in \mathbb{R}$, $A_v \ge 1$, such that $|a_k|_v \le A_v^k$, and
  $A_v = 1$ for all but finitely many $v$.
\end{theorem}

\begin{remark}
  To see why \refref{theorem}{theorem:eisenstein-2} is equivalent to
  \refref{theorem}{theorem:eisenstein-1}, recall what are the absolute values on
  a number field. For every $x \in K$ we can look at the \emph{fractional} ideal
  factorization
  $$x \mathcal{O}_K = \prod_{\substack{\mathfrak{p} \subset \mathcal{O}_K \\ \text{nonzero prime}}} \mathfrak{p}^{\nu_\mathfrak{p} (x)},$$
  and by definition the number $\nu_\mathfrak{p} (x) \in \ZZ$ is the
  \emph{valuation} of $x$ at $\mathfrak{p}$. It defines in turn an absolute
  value $|x|_\mathfrak{p} \dfn \rho^{\nu_\mathfrak{p} (x)}$. Any nonarchimedian
  absolute value on $K$ is equivalent to some $|\cdot|_\mathfrak{p}$ (and the
  archimedian absolute values come from embeddings
  $K \hookrightarrow \mathbb{C}$, as we saw in
  \refref{\S}{section:absolute-values-embeddings}).

  Further,
  \[ \mathcal{O}_{K,\mathfrak{p}} = \{ x\in K \,\mid\, |x|_\mathfrak{p} \le 1 \}, \]

  \[ \mathcal{O}_K = \bigcap_{\substack{\mathfrak{p} \subset \mathcal{O}_K \\ \text{nonzero prime}}} \mathcal{O}_{K,\mathfrak{p}} =
    \{ x\in K \,\mid\, |x|_\mathfrak{p} \le 1 \text{ for all } \mathfrak{p} \subseteq \mathcal{O}_K \}. \]

  Thus, assuming that $|a_k|_v \le 1$ for all but finitely many finite places
  $v\in M_K$ and $|a_k|_v \le A_v^k$ for \emph{finitely many} $v$, we can find
  $c \in \mathcal{O}_K$ with small enough absolute values with respect to each of these
  $v$ (take a product of big powers of corresponding primes):
  \[ |c|_v \le \frac{1}{A_v} \quad \text{so that} \quad |c^k \, a_k|_v = |c|_v^k \cdot |a_k|_v \le 1. \]
\end{remark}

Note that if the place $v \in M_K$ is infinite, then we can consider $x (T)$ as
an analytic function. It is regular at $0$ (having no poles and no
ramifications), so it converges in some disk centered at $0$. This means that
the absolute values $|a_k|_v$ grow at most exponentially. So in the statement
above by ``any place $v \in M_K$'' we really mean archimedian places as well.

\begin{corollary}
  For each $v$ the power series $x (T)$ converges $v$-adically in \emph{some}
  disk, and for all but finitely many $v$ it converges in the unit disk.
\end{corollary}

Observe that while Eisenstein's theorem implies this convergence property,
there is no implication the other way round: for instance, the logarithm
converges, but it contradicts Eisenstein's theorem.

\section{Proof of Eisenstein's theorem}

\noindent\textbf{Theorem}. \emph{Let
  $x (T) = \sum\limits_{n \ge 0} a_n\,T^n \in K [\![T]\!]$ be a formal power
  series with coefficients in a number field $K$ and suppose there is a nonzero
  polynomial $F (X,T) \in K [X,T]$}
\[ F (X,T) \dfn g_0 (T) + g_1 (T) \, X + \cdots + g_{N-1} (T) \, X^{N-1} + g_N (T) \, X^N \in K [X,T], \quad
  g_0 (T), \ldots, g_N (T) \in K [T] \]
\emph{such that}
\[ \tag{1} F (x(T),T) = g_0 (T) + g_1 (T) \, x (T) + \cdots + g_{N-1} (T) \, x^{N-1} (T) + g_N (T) \, x^N (T) = 0. \]
\emph{Then there are algebraic integers $u,v \in \mathcal{O}_K$, $u \ne 0$, $v \ne 0$
  such that $u \, v^n \, a_n \in \mathcal{O}_K$ for all $n$.}

\vspace{1em}

\noindent\emph{Proof}\footnote{\emph{J. W. S. Cassels, Local Fields (London Mathematical Society Student Texts N. 3, 1986)}, p. 28--30.}.
We add another formal variable $Y$ and compute
\[ \tag{2} F (X + Y, T) = F (X,T) + F_1 (X,T)\,Y + \cdots + F_N (X,T)\,Y^N, \]
where $F_j (X,T) \in K [X,T]$ are some polynomials. To simplify the
notation we write $F_j (X)$ for $F_j (X,T)$.

Without loss of generality we may assume that $F_1 (x(T)) \ne 0$, since
otherwise we could operate with $F_1 (X)$ instead of $F (X)$.

Consider the power series $F_1 (x(T)) \in K [\![T]\!]$. Let $m$ be its
valuation:
\[ m \dfn \nu (F_1 (x(T))) \dfn \{ n \mid n\text{-th coefficient of }F_1 (x(T))\text{ is } \ne 0 \}. \]

Now we separate $x (T)$ in two parts: the lower terms $u (T) \in K [T]$ of
degree $\le m+1$ and the ``tail'' $v (T) \in K [\![T]\!]$:
\[ \tag{3} x(T) = (\underbrace{a_0 + \cdots + a_m\,T^m + a_{m+1}\,T^{m+1}}_{\rdfn u (T)}) +
  T^{m+1}\,(\underbrace{a_{m+2}\,T + a_{m+3}\,T^2 + \cdots}_{\rdfn v(T)}) \]

It is enough to show that the tail $v (T)$ satisfies the claimed property for
coefficients.

\vspace{1em}

By (1), (2), (3) we have
\[ 0 = F (x(T)) = F (u(T) + T^{m+1}\,v(T)) = F (u (T)) + T^{m+1}\,F_1 (u(T))\cdot v(T) +
  \sum_{j\ge 2} T^{(m+1)\,j} \, F_j (u(T)) \cdot v(T)^j, \]
where $F (u (T)), F_1 (u (T)), F_j (u (T)) \in K [T]$ are certain
polynomials. All the summands except for perhaps the first are divisible by
$T^{2m+1}$ by our choice of $m$, and so $F (u (T))$ should be divisible by
$T^{2m+1}$ as well (in $K [T]$). Dividing the identity by $T^{2m+1}$, we obtain
\[ \tag{4} 0 = f (T) + f_1 (T)\,v (T) + f_2 (T)\,v (T)^2 + \cdots + f_N (T)\,v (T)^N, \]
where $f (T), f_1 (T), \ldots, f_N (T) \in K [T]$ are some polynomials, and by
our choice of $m$ their free terms are
$$\ell \dfn f_1 (0) \ne 0 \text{ and }f_j (0) = 0 \text{ for } j > 1.$$

After multiplying (4) by certain algebraic integer, we may assume that
$f, f_1, \ldots, f_N \in \mathcal{O}_K [T]$.

Observe that by its construction, in the power series
$v (T) = \sum\limits_{n \ge 1} b_n \, T^n$ (where $b_n = a_{n+m+1}$) the
constant term is $0$. We want to show that $\ell^n \, b_n \in \mathcal{O}_K$.

We look at the coefficients of $T^n$ in (4):

\begin{align*}
  0 = f (T) + f_1 (T)\cdot\left(\sum_{n \ge 1} b_n \, T^n\right) +
  f_2 (T)\cdot\left(\sum_{n\ge 1} \left(\sum_{n_1 + n_2 = n} b_{n_1}\,b_{n_2}\right) \, T^n\right) + \cdots +\\
  f_N (T)\cdot\left(\sum_{n\ge 1} \left(\sum_{n_1 + \cdots + n_N = n} b_{n_1}\cdots b_{n_N}\right) \, T^n\right).
\end{align*}

Using the fact that the free term of $f_1 (T)$ is $\ell$ and it is $0$ for
$f_2 (T), \ldots, f_N (T)$, we can express $\ell\,b_n$ as the sum of terms of
the type $c \prod\limits_{i < n} b_i^{k_i}$, where $c \in \mathcal{O}_K$. Now
$\ell^n \, b_n \in \mathcal{O}_K$ follows by induction.

\section{Proof of the Sprind\v{z}uk's theorem}

Now we go back to the Sprind\v{z}uk's theorem to prove it. Recall that for
$\alpha \in \QQ^\times$ we defined the set
$S_\alpha \dfn \{ v \in M_\QQ \,\mid\, |\alpha|_v < 1 \}$ and
\[ \Omega \dfn \{ p^k \mid p \text{ is prime}, ~ k = 1, 2, 3, \ldots \} \cup
  \{ \frac{1}{n} \mid n \in \ZZ\setminus\{0\} \} \subset
  \{ \alpha \in \QQ^\times \,\mid\, |S_\alpha| = 1 \}. \]

Let $F (X,T) \in \QQ [X,T]$ be an irreducible polynomial over $\QQ$ satisfying
$F (0,0) = 0$ and $F^\prime_X (0,0) \ne 0$. Then we want to conclude that for
all but finitely many $\alpha \in \Omega$ the polynomial
$F (X, \alpha) \in \QQ [X]$ is irreducible over $\QQ$.

\begin{claim}
  There exists a unique power series $x (T) \in \QQ [\![T]\!]$ such that
  $x (0) = 0$ (there is no free term) and $F (x(T),T) = 0$.
\end{claim}

This actually follows from the Hensel's lemma. We apply it to a polynomial
$f (X) \dfn F (X,T) \in \QQ [\![T]\!] [X]$ with coefficients in a complete ring
$\QQ [\![T]\!]$. One has $f (0) \equiv 0 \pmod{(T)}$ since $F (0,0) = 0$, and
$f^\prime (0) \not\equiv 0 \pmod{(T)}$ since $F^\prime_X (0,0) \ne 0$. So the
conditions of the Hensel's lemma are satisfied, and there is unique
$x (T) \in \QQ [\![T]\!]$, as we want.

To this power series $x (T) = a_1\,T + a_2\,T^2 + a_3\,T^3 + \cdots$ we apply
Eisenstein's theorem: for any place $v \in M_\QQ$ there exists a number
$A_v \ge 1$ (and $A_v = 1$ for all but finitely many $v$) such that
$|a_k|_v \le A_v^k$.

\begin{claim}
  At all but finitely many $T = \alpha \in \Omega$ the series $x (T)$ absolutely
  converges $v$-adically for $v \in S_\alpha$.

  \begin{proof}
    $x (\alpha) = \sum_{k \ge 0} a_k\,\alpha^k$ converges whenever
    $|\alpha|_v < \frac{1}{A_v}$:
    \[ |a_k \, \alpha^k|_v =
      |a_k|_v \cdot |\alpha|^k_v \le A_v^k \cdot |\alpha|_v^k <
      (A_v \cdot |\alpha|_v)^k \xrightarrow{k\to\infty} 0. \]

    Assume that $|\alpha|_v \ge \frac{1}{A_v}$. Then we can bound the height of
    $\alpha$ by
    \[ h (\alpha) = h (\alpha^{-1}) =
      \sum_{v\in M_K} \log^+ |\alpha|^{-1}_v \le
      \sum_{v\in M_K} \log^+ A_v. \]

    Now for all but finitely many $v\in M_K$ one has $A_v = 1$, so the sum on
    the right hand side is finite. Moreover, the numbers $A_v$ depend only on
    the polynomial $F (X,T)$ and not on $\alpha$, so by the Northcott's property
    there are only finitely many $\alpha$ such that $|\alpha|_v \ge A_v$.
  \end{proof}
\end{claim}

Let $\beta$ denote the $v$-adic sum of $x (T)$ at $T = \alpha$ for
$v \in S_\alpha$. Since $F (x(T),T) = 0$, we get $F (\beta,\alpha) = 0$ (using
the absolute convergence), so $\beta$ is a root of $F (X, \alpha)$, and it is
actually an algebraic number. We may assume
$\deg_X F (X, \alpha) = \deg_X F = n$---this degree goes down when $\alpha$
satisfies some algebraic equations, so it is enough to disregard finitely many
$\alpha$. Now $F (X,\alpha)$ is irreducible over $\QQ$ iff
$[\QQ (\beta) : \QQ] = n$.

So for $K \dfn \QQ (\beta)$ we look at the degree $d \dfn [K : \QQ]$. We will
show that $d = n$ for all but finitely many $\alpha$, and it will establish the
Sprind\v{z}uk's theorem.

\vspace{1em}

The idea is to construct an \term{auxiliary polynomial} $G (X,T) \in \QQ [X,T]$
such that $\gamma = G (\beta,\alpha)$ is ``very small'' $v$-adically. More
precisely, we want the following properties:
\begin{itemize}
\item $G (X,T)$ is not identically $0$.

\item $\deg_X G \le n-1$, where $n \dfn \deg_X F$.

\item $\deg_T G \le N$, where $N$ is some fixed big integer (later on we will
  set it), much bigger than $m$ and $n$.

\item $G (x(T), T)$ has a high order zero at $0$.
\end{itemize}

The coefficients of $G (x(T), T)$ are linear combinations of coefficients of
$G$, so vanishing of $G (x(T), T)$ at $0$ of order $\mu$ is equivalent to $\mu$
linear equations imposed on the coefficients of $G$.

To find $G$ with order of vanishing at least $\mu$, we must have
$\mu < n \, (N+1)$, where $N$ is the maximal degree of $g_i$'s in
\[ G (X,T) = g_{n-1} (T)\,X^{n-1} + \cdots + g_1 (T)\,X + g_0 (T). \]

So each $g_i$ gives $N+1$ coefficients.

To simplify the formulas, we may take $\mu = N\,n$. So by ``vanishing of high
order'' we will mean order at least $N\,n$:
\[ G (x(T),T) = y(T) = b_{N\,n} \, t^{N\,n} + \text{higher order terms}. \]

Let $\gamma \dfn G (\beta,\alpha)$ be the $v$-adic sum of $y (T)$ at
$T = \alpha$. For all but finitely many $\alpha$ we have $\gamma \ne 0$. Indeed,
if $\gamma = 0$, then $F (\beta,\alpha) = 0$ and $G (\beta,\alpha) = 0$. But
these two polynomials have no common factor in $\QQ [X,T]$, and so they have
only finitely many common roots ($F$ is irreducible by our assumption, and
$F \nmid G$ since $\deg_X G \le n-1$ and $\deg_X F = n$).

\begin{proposition}[Baby algebraic geometry]
  Let $K$ be a field. Let $F (X,T), G (X,T) \in K [X,T]$ be two
  polynomials. Assume that $F$ and $G$ have no common factor. Then the system of
  equations $F (x,t) = G (x,t) = 0$ has only finitely many solutions in
  $(x,t) \in K^2$.
\end{proposition}

Now by Eisenstein's theorem, for all $v \in M_\QQ$ there exists $B_v \ge 1$ (and
$B_v = 1$ for all but finitely many $v$) such that $|b_k|_v \le
B_v^k$. \underline{If $v$ is nonarchimedian and $B_v = 1$}, then $|b_k|_v \le 1$
and
$$|y (\alpha)|_v \le |\alpha|_v^{N\,n}.$$

\underline{If $v$ is nonarchimedian and $B_v > 1$}, then we may assume
$|\alpha|_v < B_v^{-1}$ by disposing finitely many $\alpha$ (by the Northcott's
property as above). After that one has
\[ |b_k \, \alpha^k|_v \le
  (B_v \cdot |\alpha|_v)^k \le
  (B_v \cdot |\alpha|_v)^{N\,n} \le
  C \cdot |\alpha|_v^{N\,n}, \]
where $C$ is some constant depending on $F$ and $G$, but not on $\alpha$.

\underline{If $v$ is archimedian}, then we may assume $|\alpha|_v < (2\,B_v)^{-1}$.

\[ |b_k \, \alpha^k|_v \le (B_v \cdot |\alpha|_v)^k \le \frac{1}{2}. \]

\[ |y (\alpha)|_v \le \sum_{k \ge n N} (B_v \cdot |\alpha|_v)^k =
  (B_v \cdot |\alpha|_v)^{N\,n} \, \frac{1}{1 - B_v \cdot |\alpha|_v} \le
  2 \, (B_v \cdot |\alpha|_v)^{N\,n} \le
  C_v \cdot |\alpha|_v^{N\,n}. \]

Here $C_v = 1$ for all but finitely many $v$ and it is some constant depending
on $F$ and $G$. So we have an upper bound for $\gamma \dfn G (\beta,\alpha)$
$\beta$ (\refref{proposition}{proposition:twovar-polynomial-value-height}):
\[ |\gamma|_v \le C_v \cdot |\alpha|_v^{N\,n}. \]

We have also a lower bound given by the Liouville's inequality
\[ |\gamma|_v \ge e^{-d \, h (\gamma)}. \]

We want to get a contradiction from
$e^{-d \, h (\gamma)} \le |\gamma|_v \le C_v \cdot |\alpha|_v^{N\,n}$. For this
we write $h (\gamma)$ in terms of $\alpha$. We use the bound
$$h (\gamma) \le h (\alpha) \, N + h (\beta) \, (n+1) + C,$$
where $C$ is a constant depending only on $G$. The upper bound
$|\gamma|_v \le C_v \cdot |\alpha|_v^{N\,n}$ can be written as
$|\gamma|_v \le C\, e^{-N\,n\,h(\alpha)}$ where $C$ is a constant depending on
$F$ and $G$. If we forget for a while about the term ``$h (\beta) \, (n+1)$''
above, then the bounds indeed give a contradiction if $d < n$:
$$e^{-d \, N \, h (\alpha)} < C \, e^{-n \, N \, h (\alpha)}.$$

Now we take care of the term ``$h (\beta) \, (n+1)$''. Since
$F (\alpha,\beta) = 0$, we have $h (\beta) \le m \, h (\alpha) + O_\beta (1)$,
where $O_\beta (1)$ is something does not depending on $\beta$
(\refref{proposition}{proposition:beta-alpha-roots-height}). Now
$$h (\gamma) \le (N + m \, (n-1)) \, h (\alpha) + C,$$
where $C$ is a constant depending only on $F$ and $G$.

So we get
$$|\gamma|_v \ge C \, e^{-d \, (N + m\,n) \, h (\alpha)}.$$

The inequalities become
\[ C_1 \, e^{-n\,N\,h(\alpha)} \ge |\gamma|_v \ge
  C_2 \, e^{-d \, (N + m\,n) \, h (\alpha)}. \]

To obtain a contradiction for $d < n$ and big enough $h (\alpha)$, we need
$d \, (N + m\,n) < n\,N$. If we take $N = m\,n^2$, we are done, in this case
$(n-1) \, (N + m\,n) < n\,N$.

This finishes our proof of the Sprind\v{z}uk's theorem. \qed

\vspace{1em}

A typical Diophantine approximation proof splits into the following steps:

\begin{enumerate}
\item[(1)] Constructing an auxiliary function with high vanishing order at some
  ``anchor points'' (in our case it was $0$).

\item[(2)] An analytic step: evaluating the auxiliary function at a point near
  one of the anchor points (in our case $\alpha$ was $v$-adically close to $0$)
  and showing that this value $\gamma$ is very small.

\item[(3)] Showing that the value $\gamma$ is not zero. Usually it is the
  hardest part.

\item[(4)] Using Liouville-type inequalities to show that $\gamma$ cannot be too
  small, contradicting (2).
\end{enumerate}

\section{Sprind\v{z}uk's decomposition theorem}
\label{section:Sprindzuk-decomposition}

Now we go back to \refref{theorem}{theorem:sprindzuk-decomposition}. Recall its
statement. \emph{Let $F (X,T) \in \QQ [X,T]$ be a polynomial irreducible over
  $\QQ$. Assume $F (0,0) = 0$ and $F^\prime_X (0,0) \ne 0$. Let $\epsilon >
  0$. For $\alpha \in \QQ$ write down the factorization of
  $F (X,\alpha) \in \QQ [X]$ into irreducible polynomials:}
\[ F (X,\alpha) = f_1 (X) \cdots f_r (X). \]

\emph{Then for all but finitely many $\alpha \in \ZZ$ one can write
  $\alpha = \alpha_1 \cdots \alpha_r$ with $\alpha_i$ pairwise relatively prime
  such that}
\[ \left| \frac{\log |\alpha_i|}{\log |\alpha|} - \frac{\deg f_i}{\deg_X F} \right| < \epsilon. \]

\vspace{1em}

We want to generalize it for $\alpha \in \QQ$. Of course $\log |\alpha|$ should
be replaced with the height
$$h (\alpha) = h (\alpha^{-1}) = \sum_{v\in S_\alpha} \log |\alpha^{-1}|_v,$$
where $S_\alpha \dfn \{ v\in M_\QQ \,\mid\, |\alpha|_v < 1 \}$. Factorization
``$\alpha = \alpha_1 \cdots \alpha_r$'' does not make sense anymore if
$\alpha \in \QQ$. The right generalization is the following:

\begin{theorem}
  Let $F (X,T)$ be as above. For all but finitely many $\alpha \in \QQ$ there
  exists a partition (depending on $\epsilon$)
  \[ S_\alpha = T_1 \cup \cdots \cup T_s, ~
    T_i\cap T_j = \emptyset \text{ for } i\ne j
    \quad \text{and} \quad
    n = d_1 + \cdots + d_s, \]
  such that for each $i$
  $$\left| \frac{\sum_{v\in T_i} \log |\alpha^{-1}|_v}{h (\alpha)} - \frac{d_i}{n} \right| < \epsilon.$$
\end{theorem}

The proof goes among the same lines. It is sufficient to show that for all but
finitely many $\alpha$ there exists a partition such that
\[ \frac{\sum_{v\in T_i} \log |\alpha^{-1}|_v}{h (\alpha)} \ge \frac{d_i}{n} - \epsilon. \]

Indeed, that is because
$\sum_{1 \le i \le s} \frac{\sum_{v\in T_i} \log |\alpha^{-1}|_v}{h (\alpha)} = 1$
and $\sum_{1 \le i \le s} \frac{d_i}{n} = 1$.

For $v \in S_\alpha$ we define $v \in T_i$ if the $v$-adic sum $\beta$ of
$x (t)$ at $t = \alpha$ is a root of $g_i$. We have
$[\QQ (\beta) : \QQ] = d_i$. By the same argument with auxiliary functions, we
produce inequalities
\[ e^{-d_i \, (N + C(m,n))\,h (\alpha)} \le \prod_{v\in T_i} |\gamma|_v \le
  e^{-N \, \sum_{v \in T_i} \log |\alpha^{-1}|_v}. \]

For details see \emph{Yuri F. Bilu, David Masser, A Quick Proof of
  Sprind\v{z}uk's Decomposition Theorem},
\url{http://dx.doi.org/10.1007/978-3-540-32439-3_2}

\pagebreak

\section*{Conclusion}
\addcontentsline{toc}{section}{Conclusion}

During this course we used $p$-adic numbers to prove interesting theorems that
actually do not mention $p$-adic numbers in the original statements: the
Hasse--Minkowski theorem, the Skolem--Mahler--Lech theorem, and the
Sprind\v{z}uk's theorem. These three examples are of different kind.

The Hasse--Minkowski theorem is a local--global principle that connects
equations over $\ZZ$ with equations over $\ZZ_p$ for all $p$. We note that it is
valid for the case of quadrics, and studying \emph{obstructions} to the
local--global principle in the other cases is a topic of the ongoing research.

The Skolem--Mahler--Lech theorem was proved \emph{locally}---that is, by looking
at $\ZZ_p$ for \emph{only one} suitable $p$ and using certain properties from
$p$-adic analysis.

Finally, the Sprind\v{z}uk's theorem was proved using heights. It is another
kind of an argument, which is somewhat \emph{quantitative}: we claim that some
statement holds for all but finitely many numbers $\alpha$, and this actually
comes from some bound on $h (\alpha)$.

\end{document}
